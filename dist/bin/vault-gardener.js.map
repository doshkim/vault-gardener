{"version":3,"sources":["../../src/providers/spawn.ts","../../src/providers/claude.ts","../../src/providers/codex.ts","../../src/providers/gemini.ts","../../src/prompts/render.ts","../../src/config/schema.ts","../../src/config/loader.ts","../../src/config/index.ts","../../src/cli/config.ts","../../src/queue/index.ts","../../src/lock/index.ts","../../src/logging/index.ts","../../src/metrics/collector.ts","../../src/analysis/utils.ts","../../src/analysis/suggestions.ts","../../src/analysis/weekly-brief.ts","../../src/analysis/activity.ts","../../src/cli/digest.ts","../../src/cli/recover.ts","../../src/cli/index.ts","../../src/cli/init.ts","../../src/scanner/detect.ts","../../src/scanner/presets.ts","../../src/providers/detect.ts","../../src/cli/run.ts","../../src/preflight/index.ts","../../src/notify/index.ts","../../src/metrics/format.ts","../../src/reports/features.ts","../../src/reports/parser.ts","../../src/reports/store.ts","../../src/cli/start.ts","../../src/scheduler/daemon.ts","../../src/scheduler/launchd.ts","../../src/scheduler/systemd.ts","../../src/cli/stop.ts","../../src/cli/status.ts","../../bin/vault-gardener.ts"],"sourcesContent":["import { spawn } from 'node:child_process';\nimport { writeFile, mkdir } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport type { RunResult } from './types.js';\n\nexport const EXIT_CODE_MAP: Record<number, string> = {\n  0: 'Success',\n  1: 'General error',\n  124: 'Timeout',\n  137: 'Killed (OOM or SIGKILL)',\n  139: 'Segfault',\n};\n\nexport function mapExitCode(code: number | null, signal: string | null): string {\n  if (signal) return `Signal: ${signal}`;\n  if (code != null && code in EXIT_CODE_MAP) return EXIT_CODE_MAP[code];\n  if (code != null) return `Exit code: ${code}`;\n  return 'Unknown';\n}\n\nconst MAX_OUTPUT_BYTES = 10 * 1024; // 10 KB\n\n// Only pass safe environment variables to spawned provider processes.\n// Excludes secrets, credentials, and sensitive tokens from the LLM's environment.\nconst ENV_DENYLIST = new Set([\n  'AWS_SECRET_ACCESS_KEY', 'AWS_SESSION_TOKEN',\n  'GITHUB_TOKEN', 'GH_TOKEN', 'GITLAB_TOKEN',\n  'NPM_TOKEN', 'NODE_AUTH_TOKEN',\n  'DATABASE_URL', 'DB_PASSWORD', 'PGPASSWORD',\n  'REDIS_URL', 'REDIS_PASSWORD',\n  'SSH_AUTH_SOCK', 'SSH_AGENT_PID',\n  'DOCKER_AUTH_CONFIG',\n  'SLACK_TOKEN', 'SLACK_WEBHOOK_URL',\n  'OPENAI_API_KEY', 'ANTHROPIC_API_KEY',\n  'STRIPE_SECRET_KEY', 'STRIPE_API_KEY',\n  'SECRET_KEY', 'SECRET_KEY_BASE',\n  'ENCRYPTION_KEY', 'MASTER_KEY',\n]);\n\nexport function filterEnv(extra?: Record<string, string>): Record<string, string> {\n  const filtered: Record<string, string> = {};\n  for (const [key, val] of Object.entries(process.env)) {\n    if (val == null) continue;\n    if (ENV_DENYLIST.has(key)) continue;\n    // Also skip anything that looks like a secret\n    const upper = key.toUpperCase();\n    if (upper.includes('SECRET') || upper.includes('PASSWORD') || upper.includes('PRIVATE_KEY')) continue;\n    filtered[key] = val;\n  }\n  return { ...filtered, ...extra };\n}\n\n/** Check if a CLI tool exists on PATH. */\nexport async function isCommandAvailable(command: string): Promise<boolean> {\n  return new Promise((resolve) => {\n    const proc = spawn('which', [command], { stdio: 'ignore' });\n    proc.on('close', (code) => resolve(code === 0));\n    proc.on('error', () => resolve(false));\n  });\n}\n\n/** Spawn a CLI process and capture output with timeout support. */\nexport async function spawnProvider(\n  command: string,\n  args: string[],\n  opts: {\n    cwd: string;\n    timeout: number;\n    verbose?: boolean;\n    env?: Record<string, string>;\n    killGraceSeconds?: number;\n    gardenerDir?: string;\n  },\n): Promise<RunResult> {\n  const start = Date.now();\n  const killGrace = opts.killGraceSeconds ?? 5;\n\n  return new Promise((resolve, reject) => {\n    const proc = spawn(command, args, {\n      cwd: opts.cwd,\n      detached: true,\n      stdio: ['ignore', 'pipe', 'pipe'],\n      env: filterEnv(opts.env),\n    });\n\n    let outputBuf = '';\n    let killed = false;\n    let timedOut = false;\n\n    function appendOutput(chunk: string): void {\n      outputBuf += chunk;\n      // Cap to last MAX_OUTPUT_BYTES\n      if (outputBuf.length > MAX_OUTPUT_BYTES) {\n        outputBuf = outputBuf.slice(-MAX_OUTPUT_BYTES);\n      }\n    }\n\n    proc.stdout.on('data', (chunk: Buffer) => {\n      const str = chunk.toString('utf-8');\n      appendOutput(str);\n      if (opts.verbose) process.stdout.write(chunk);\n    });\n\n    proc.stderr.on('data', (chunk: Buffer) => {\n      const str = chunk.toString('utf-8');\n      appendOutput(str);\n      if (opts.verbose) process.stderr.write(chunk);\n    });\n\n    // Timeout handling with SIGKILL escalation\n    const timer = setTimeout(() => {\n      timedOut = true;\n      if (proc.pid && proc.pid > 0) {\n        try {\n          process.kill(-proc.pid, 'SIGTERM');\n        } catch {\n          // process may already be dead\n        }\n\n        setTimeout(() => {\n          if (!killed && proc.pid && proc.pid > 0) {\n            try {\n              process.kill(-proc.pid, 'SIGKILL');\n            } catch {\n              // already dead\n            }\n          }\n        }, killGrace * 1000);\n      }\n    }, opts.timeout * 1000);\n\n    proc.on('close', async (code, signal) => {\n      clearTimeout(timer);\n      killed = true;\n      const duration = Math.round((Date.now() - start) / 1000);\n\n      const reason = timedOut\n        ? `Timeout after ${opts.timeout}s`\n        : mapExitCode(code, signal);\n\n      const result: RunResult = {\n        output: outputBuf.trim(),\n        exitCode: timedOut ? 124 : (code ?? 1),\n        duration,\n        reason,\n      };\n\n      // Preserve last output to file\n      if (opts.gardenerDir && outputBuf.length > 0) {\n        try {\n          const logsDir = join(opts.gardenerDir, 'logs');\n          await mkdir(logsDir, { recursive: true });\n          await writeFile(join(logsDir, 'last-run-output.txt'), outputBuf.slice(-MAX_OUTPUT_BYTES), 'utf-8');\n        } catch {\n          // best effort\n        }\n      }\n\n      resolve(result);\n    });\n\n    proc.on('error', (err) => {\n      clearTimeout(timer);\n      killed = true;\n      const duration = Math.round((Date.now() - start) / 1000);\n\n      if (timedOut) {\n        resolve({\n          output: `Process timed out after ${opts.timeout}s`,\n          exitCode: 124,\n          duration,\n          reason: `Timeout after ${opts.timeout}s`,\n        });\n        return;\n      }\n\n      reject(err);\n    });\n  });\n}\n","import type { Provider, RunOptions, RunResult, ProviderConfig } from './types.js';\nimport { isCommandAvailable, spawnProvider } from './spawn.js';\n\nconst DEFAULT_CONFIG: ProviderConfig = {\n  power_model: 'opus',\n  fast_model: 'sonnet',\n  timeout: 600,\n  max_turns: 200,\n};\n\nexport function createClaudeProvider(config?: Partial<ProviderConfig>): Provider {\n  const cfg = { ...DEFAULT_CONFIG, ...config };\n\n  return {\n    name: 'claude',\n\n    async isAvailable(): Promise<boolean> {\n      return isCommandAvailable('claude');\n    },\n\n    async run(opts: RunOptions): Promise<RunResult> {\n      const prompt = [\n        `Read ${opts.contextFile} for vault context,`,\n        `then read ${opts.promptFile} and execute all steps.`,\n      ].join(' ');\n\n      const args = [\n        '--dangerously-skip-permissions',\n        '--model', opts.model || cfg.power_model,\n        '--max-turns', String(cfg.max_turns),\n        '-p', prompt,\n      ];\n\n      return spawnProvider('claude', args, {\n        cwd: opts.cwd,\n        timeout: opts.timeout || cfg.timeout,\n        verbose: opts.verbose,\n        gardenerDir: opts.gardenerDir,\n        // ANTHROPIC_API_KEY is on the env denylist (prevents leaking secrets to LLMs)\n        // but Claude CLI needs it for authentication â€” pass it explicitly\n        env: process.env.ANTHROPIC_API_KEY\n          ? { ANTHROPIC_API_KEY: process.env.ANTHROPIC_API_KEY }\n          : undefined,\n      });\n    },\n  };\n}\n","import type { Provider, RunOptions, RunResult, ProviderConfig } from './types.js';\nimport { isCommandAvailable, spawnProvider } from './spawn.js';\n\nconst DEFAULT_CONFIG: ProviderConfig = {\n  power_model: 'gpt-5.3-codex',\n  fast_model: 'gpt-5.3-codex-spark',\n  timeout: 600,\n};\n\nexport function createCodexProvider(config?: Partial<ProviderConfig>): Provider {\n  const cfg = { ...DEFAULT_CONFIG, ...config };\n\n  return {\n    name: 'codex',\n\n    async isAvailable(): Promise<boolean> {\n      return isCommandAvailable('codex');\n    },\n\n    async run(opts: RunOptions): Promise<RunResult> {\n      const prompt = [\n        `Read ${opts.contextFile} for vault context,`,\n        `then read ${opts.promptFile} and execute all steps.`,\n      ].join(' ');\n\n      const args = [\n        '--model', opts.model || cfg.power_model,\n        '--approval-mode', 'full-auto',\n        '-q', prompt,\n      ];\n\n      return spawnProvider('codex', args, {\n        cwd: opts.cwd,\n        timeout: opts.timeout || cfg.timeout,\n        verbose: opts.verbose,\n        gardenerDir: opts.gardenerDir,\n        // OPENAI_API_KEY is on the env denylist (prevents leaking secrets to LLMs)\n        // but Codex CLI needs it for authentication â€” pass it explicitly\n        env: process.env.OPENAI_API_KEY\n          ? { OPENAI_API_KEY: process.env.OPENAI_API_KEY }\n          : undefined,\n      });\n    },\n  };\n}\n","import { readFile } from 'node:fs/promises';\nimport type { Provider, RunOptions, RunResult, ProviderConfig } from './types.js';\nimport { isCommandAvailable, spawnProvider } from './spawn.js';\n\nconst DEFAULT_CONFIG: ProviderConfig = {\n  power_model: 'gemini-3.1-pro-preview',\n  fast_model: 'gemini-3-flash-preview',\n  timeout: 600,\n};\n\nexport function createGeminiProvider(config?: Partial<ProviderConfig>): Provider {\n  const cfg = { ...DEFAULT_CONFIG, ...config };\n\n  return {\n    name: 'gemini',\n\n    async isAvailable(): Promise<boolean> {\n      return isCommandAvailable('gemini');\n    },\n\n    async run(opts: RunOptions): Promise<RunResult> {\n      const contextContent = await readFile(opts.contextFile, 'utf-8');\n\n      const prompt = `Read ${opts.promptFile} and execute all steps.`;\n\n      const args = [\n        '-m', opts.model || cfg.power_model,\n        '-p', prompt,\n      ];\n\n      return spawnProvider('gemini', args, {\n        cwd: opts.cwd,\n        timeout: opts.timeout || cfg.timeout,\n        verbose: opts.verbose,\n        gardenerDir: opts.gardenerDir,\n        env: { GEMINI_SYSTEM_MD: contextContent },\n      });\n    },\n  };\n}\n","import Handlebars from 'handlebars';\nimport { writeFile, mkdir } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport type { GardenerConfig } from '../config/index.js';\n\n// ---------------------------------------------------------------------------\n// Handlebars helpers\n// ---------------------------------------------------------------------------\n\nHandlebars.registerHelper('eq', (a: unknown, b: unknown) => a === b);\n\n// ---------------------------------------------------------------------------\n// Embedded Handlebars templates\n// These are the source-of-truth templates that get rendered to .gardener/prompts/\n// at runtime. The .hbs files in src/prompts/templates/ are kept for reference\n// but the dist bundle uses these embedded strings.\n// ---------------------------------------------------------------------------\n\nconst TEMPLATES: Record<string, string> = {\n  context: `# Vault Context (Auto-Generated)\n\n> This file is auto-generated by vault-gardener from \\`.gardener/config.yaml\\`.\n> Do not edit manually â€” run \\`vault-gardener config regen\\` to regenerate.\n\n## Vault Structure\n\n{{#each folders}}\n{{@key}}: \\`{{this}}/\\`\n{{/each}}\n\n## Routing Rules\n\n### Step 1: Classify â€” episodic or entity?\n- **Episodic** (first-person, temporal markers, meetings, decisions) â†’ \\`{{folders.journal}}/\\` via Binder\n- **Entity/Reference** (resources, people, orgs, clips) â†’ direct to folder below\n\n### Step 2: Route entity/reference items:\n- Uncertain where it goes? â†’ \\`{{folders.inbox}}/\\`\n{{#if folders.projects}}- Has a deadline or deliverable? â†’ \\`{{folders.projects}}/\\`{{/if}}\n{{#if folders.roles}}- Ongoing role or responsibility? â†’ \\`{{folders.roles}}/\\`{{/if}}\n{{#if folders.resources}}- Reference/knowledge to retrieve later? â†’ \\`{{folders.resources}}/{topic-subfolder}/\\`{{/if}}\n{{#if folders.people}}- About a person? â†’ \\`{{folders.people}}/\\`{{/if}}\n{{#if folders.orgs}}- About an organization? â†’ \\`{{folders.orgs}}/\\`{{/if}}\n{{#if folders.playbooks}}- Repeatable process or SOP? â†’ \\`{{folders.playbooks}}/\\`{{/if}}\n{{#if folders.sources}}- External article, book, paper? â†’ \\`{{folders.sources}}/\\`{{/if}}\n{{#if folders.mocs}}- Index/hub note? â†’ \\`{{folders.mocs}}/\\`{{/if}}\n{{#if folders.archive}}- Done or no longer relevant? â†’ \\`{{folders.archive}}/\\`{{/if}}\n\n## Topic Taxonomy\n\n{{#each topics}}\n### {{@key}}\nKeywords: {{#each this}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}\n{{/each}}\n\n## Frontmatter Standards\n\n### Required Fields (all notes)\n{{#each frontmatter.required}}\n- \\`{{this}}\\`\n{{/each}}\n\n### Status Values\n{{#each frontmatter.statuses}}\n- \\`{{this}}\\`\n{{/each}}\n\n### Type Values\n{{#each frontmatter.types}}\n- \\`{{this}}\\`\n{{/each}}\n\n## Note Lifecycle\n\n\\`\\`\\`\nseed â†’ growing â†’ evergreen â†’ archived       (all notes)\nseed â†’ consolidated                          (event journals, after Store items processed)\n\\`\\`\\`\n\n| Status | Gardener behavior |\n|--------|-------------------|\n| **seed** | Maximum attention. Enriches content, fills frontmatter, adds links, organizes. |\n| **growing** | Active management. Adds links, updates beliefs, tracks goals. |\n| **evergreen** | Passive. Only adds back-links. Does NOT modify content. |\n| **archived** | Ignored. Gardener skips entirely. |\n| **consolidated** | Event journals only. All Store items processed. Gardener skips. |\n\n### What the gardener NEVER does:\n- Never deletes any note\n- Never auto-archives (only suggests)\n- Never demotes status\n- Never modifies evergreen content (only adds back-links in See Also)\n\n## File Naming\n\n| Type | Pattern | Example |\n|------|---------|---------|\n| People | \\`Firstname Lastname.md\\` | \\`Jane Smith.md\\` |\n| Organizations | \\`Name.md\\` | \\`Acme Corp.md\\` |\n| Resources/Topics | \\`Title Case.md\\` | \\`Machine Learning Basics.md\\` |\n| Projects | \\`Project - Name.md\\` | \\`Project - Website Redesign.md\\` |\n| Daily journals | \\`YYYY-MM-DD.md\\` | \\`2026-01-19.md\\` |\n| Event journals | \\`YYYY-MM-DD Kind - Title.md\\` | \\`2026-01-19 Insight - API Design.md\\` |\n| Meeting notes | \\`YYYY-MM-DD Meeting - Topic.md\\` | \\`2026-01-19 Meeting - Sprint Review.md\\` |\n\n## Formatting Conventions\n\n- Tags: kebab-case (\\`#machine-learning\\`)\n- Links: Always \\`[[WikiLinks]]\\`\n- Max 5 tags per note\n- Lead with key insight (inverted pyramid)\n\n{{#if features.persona}}\n## Gardener Persona\n\n**Active persona:** \\`{{persona}}\\`\n\n| Persona | Behavior |\n|---------|----------|\n| analytical | Facts and data. Minimal interpretation. Precise and structured. |\n| reflective | Questions and deeper meaning. Surfaces connections. Thoughtful commentary. |\n| coach | Prescriptive and action-oriented. Recommendations. Pushes for clarity. |\n\n{{/if}}\n## Batch Limits\n\n**Base limits** (adjusted by adaptive batch sizing based on vault size):\n\n{{#each limits}}\n- {{@key}}: {{this}}\n{{/each}}\n\n{{#if features.adaptive_batch_sizing}}\n**Adaptive sizing rules:**\n- Vault < 100 notes â†’ limits Ã— 2 (small vault, process more aggressively)\n- Vault 100-500 notes â†’ standard limits\n- Vault 500+ notes â†’ limits Ã· 2 (minimum 3) (large vault, be selective)\n{{/if}}\n\n## Memory & Changelog\n\n{{#if features.memory}}- **Memory file**: \\`.gardener/memory.md\\` â€” read at start of each phase, updated at end\n{{/if}}{{#if features.changelog}}- **Changelog**: \\`.gardener/changelog.md\\` â€” appended after each phase (last 50 entries)\n{{/if}}\n\n{{#if features.social_content}}\n## Social Media Platforms\n\n{{#if social_platforms}}Target platforms: {{#each social_platforms}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}{{/if}}\n\n{{/if}}\n## Protected Paths (NEVER touch)\n\n{{#each protected}}\n- \\`{{this}}/\\`\n{{/each}}\n\n## Concurrency Safety\n\nBefore modifying any file, check its modification time. If the file was\nmodified in the last 5 minutes, SKIP it â€” the user may be actively editing.`,\n\n  // ---------------------------------------------------------------------------\n  garden: `# Gardener â€” AI-Powered Vault Maintenance Pipeline\n\nRun the full vault gardener. Three phases execute in sequence:\n1. **Seed** â€” process inbox into journals and semantic folders\n2. **Nurture** â€” repair structure, consolidate knowledge, build links\n3. **Tend** â€” lifecycle management, organization, enrichment\n\n**No information is ever deleted** â€” only reorganized, enriched, and connected.\n\n{{#if features.persona}}\n## Persona\n\n{{#if (eq persona \"analytical\")}}You are an **analytical** gardener. Focus on facts, data, and minimal interpretation. Be precise, structured, and evidence-based. Avoid speculation.{{/if}}\n{{#if (eq persona \"reflective\")}}You are a **reflective** gardener. Ask questions, explore deeper meaning, and surface connections. Balance structure with thoughtful commentary.{{/if}}\n{{#if (eq persona \"coach\")}}You are a **coaching** gardener. Be prescriptive and action-oriented. Frame observations as recommendations. Push for clarity and commitment.{{/if}}\n\n{{/if}}\n{{#if features.memory}}\n## Memory\n\nRead \\`.gardener/memory.md\\` if it exists. This file contains context from previous runs:\n- What was done, what was deferred, running vault observations\n- Use this to avoid re-processing and to continue multi-run projects\n- Each phase will update memory with its results\n\n{{/if}}\n## Protected Paths\n\n**NEVER read, modify, or process files in these locations:**\n{{#each protected}}\n- \\`{{this}}/\\`\n{{/each}}\n\n## Concurrency Safety\n\nBefore modifying any file, check its modification time. If the file was\nmodified in the last 5 minutes, SKIP it â€” the user may be actively editing.\nLog skipped files with reason \"skipped: recently modified\".\n\n## Instructions\n\nFirst, read \\`.gardener/context.md\\` to understand vault structure and rules.\n\nThen execute the pipeline:\n\n### Phase 1: Seed\nRead \\`.gardener/prompts/seed.md\\` and execute all steps.\n\n### Phase 2: Nurture\nRead \\`.gardener/prompts/nurture.md\\` and execute all steps.\n\n### Phase 3: Tend\nRead \\`.gardener/prompts/tend.md\\` and execute all steps.\n\n## Run Report\n\nEach phase template includes instructions to write \\`.gardener/run-report.json\\`.\nThe **seed** phase creates the file. **Nurture** and **tend** read the existing file\nand append their phase to the \\`phases\\` array. The final file contains all three phases.\n\n## Output\n\nCombined summary from all three phases:\n- **Seed**: Inbox items triaged, journals created, salience tags applied, items routed, questions extracted, commitments tracked\n- **Nurture**: Structure repaired, beliefs consolidated, playbooks/MOCs generated, entity + semantic + transitive links added, tags normalized, knowledge gaps identified, co-mention networks updated\n- **Tend**: Stale notes reviewed, resources organized, notes enriched with context anchoring and summaries, journals generated with themes/attention/goals/social content`,\n\n  // ---------------------------------------------------------------------------\n  seed: `# Seed â€” Intake & Routing\n\nProcess inbox items into journals and semantic folders. Raw captures become\nstructured episodic and semantic memories.\n\n**No information is ever deleted** â€” only reorganized, enriched, and connected.\n\n{{#if features.persona}}\n## Persona\n\n{{#if (eq persona \"analytical\")}}You are an **analytical** gardener. Focus on facts, data, and minimal interpretation. Be precise, structured, and evidence-based. Avoid speculation.{{/if}}\n{{#if (eq persona \"reflective\")}}You are a **reflective** gardener. Ask questions, explore deeper meaning, and surface connections. Balance structure with thoughtful commentary.{{/if}}\n{{#if (eq persona \"coach\")}}You are a **coaching** gardener. Be prescriptive and action-oriented. Frame observations as recommendations. Push for clarity and commitment.{{/if}}\n\n{{/if}}\n{{#if features.memory}}\n## Memory\n\nRead \\`.gardener/memory.md\\` if it exists. This file contains context from previous runs â€”\nwhat was done, what was deferred, running observations about vault state. Use this to:\n- Avoid re-processing items handled in previous runs\n- Continue multi-run projects from where they left off\n- Make strategic decisions about what to prioritize this run\n\n{{/if}}\n## Safety\n\n- **Never delete** â€” only reorganize, enrich, connect\n- **Skip recently modified** â€” if file modified in last 5 min, skip it\n- **Never touch protected paths**: {{#each protected}}\\`{{this}}/\\` {{/each}}\n\n## Instructions\n\nRead \\`.gardener/context.md\\` for vault structure and routing rules.\n\n---\n\n## Step 0 â€” Document Cleanup\n\nRun cleanup on recently modified notes before other maintenance:\n\n1. **Find recent notes**: Identify all notes modified in the last 7 days\n   (skip protected paths)\n\n2. **Skip already clean**: Exclude notes with \\`status: evergreen\\`\n\n3. **Run cleanup phases** for each note:\n   - **Format**: Normalize whitespace, bullets, headings, dates\n   - **Structure**: Add missing sections for document type\n   - **Enrich**: Fill thin content (<100 words) with context\n   - **Cross-link**: Discover and add WikiLinks to related notes\n\n4. **Processing rules**:\n   - Skip protected paths\n   - Never reduce content, only add or restructure\n   - Preserve code blocks, WikiLinks, and embeds exactly\n\n---\n\n## Step 1 â€” Triage\n\nClassify each \\`{{folders.inbox}}/\\` item:\n\n**EPISODIC signals** (any match â†’ episodic):\n- First-person pronouns: \"I\", \"my\", \"we\", \"our\"\n- Temporal markers: \"today\", \"yesterday\", \"just now\", \"this morning\"\n- Frontmatter: \\`type: meeting\\`, \\`type: journal\\`\n- Contains \\`[decision]\\`, \\`[milestone]\\`, \\`[insight]\\`, \\`[met]\\` tags\n- Voice memo transcription\n\n**ENTITY/REFERENCE signals** (any match â†’ direct route):\n- Frontmatter: \\`type: resource\\`, \\`person\\`, \\`org\\`\n- Contains URL as primary content\n- Filename matches person/org naming patterns\n- Is a clipped article (\\`type: clip\\`, \\`source: url\\`)\n\n**AMBIGUOUS** â†’ default episodic\n\n- Episodic items â†’ **Step 1.1 (Binder)**\n- Entity/reference items â†’ **Step 1.3 (Route Remaining)**\n\n## Step 1.1 â€” Binder\n\nProcess episodic inbox items into journals.\n\n**Content maturity check:**\n- Structured (headings, links, checklists, or >50 words) â†’ process now\n- Bare capture (<50 words, no structure) â†’ skip if < 12h old\n- Has explicit routing tag â†’ process immediately\n\n### SMALL captures (< 50 words, single thought)\n\n1. Find or create \\`{{folders.journal}}/YYYY/{{journal.journal_subfolders.daily}}/YYYY-MM-DD.md\\`\n2. Append under \\`## Captures\\`:\n   \\`\\`\\`\n   - {content} â€” [[source-if-any]] ({HH:MM})\n   \\`\\`\\`\n3. Delete inbox file\n\n{{#if features.this_time_last_year}}\n### This Time Last Year (#29)\n\nWhen creating or updating a daily journal, look for journals from roughly one year ago.\nSearch \\`{{folders.journal}}/{YYYY-1}/{{journal.journal_subfolders.daily}}/\\` for any daily\nor event journals within Â±3 days of today's date last year (7-day window).\n\n**Search order** (pick the best single match):\n1. Exact date last year (\\`{YYYY-1}-MM-DD\\`)\n2. Same weekday in the nearest week (e.g., if today is Tuesday, find last year's nearest Tuesday)\n3. Any journal within the Â±3 day window, preferring the one with the most content\n\nIf found, add a callout at the top of the daily note (after frontmatter):\n\n\\`\\`\\`markdown\n> [!calendar] This Time Last Year\n> {2-3 sentence summary of that day's journal}\n> â€” [[{matched-date}]]\n\\`\\`\\`\n\nIf multiple journals exist in the window (e.g., a daily + event journals), summarize the\nmost interesting one and link to the others:\n\n\\`\\`\\`markdown\n> [!calendar] This Time Last Year\n> {2-3 sentence summary of the most notable entry}\n> â€” [[{matched-date}]] Â· also: [[{YYYY-1}-MM-DD Kind - Title]]\n\\`\\`\\`\n\nOnly add once per daily note. Skip if a \\`[!calendar] This Time Last Year\\` callout already exists.\n\n{{/if}}\n### LARGE captures (>= 50 words, OR has headings, OR contains [decision]/[milestone]/[insight])\n\n1. **Determine Kind** from content:\n   | Signal | Kind |\n   |--------|------|\n   | \"decided\", \"chose\", \"going with\" | Decision |\n   | \"realized\", \"learned\", \"turns out\" | Insight |\n   | \"shipped\", \"launched\", \"completed\" | Milestone |\n   | \"failed\", \"broke\", \"mistake\" | Failure |\n   | \"met\", \"talked\", \"called\" | Encounter |\n   | \"won\", \"closed\", \"landed\" | Win |\n   | Default | Observation |\n\n2. **Create event journal**: \\`{{folders.journal}}/YYYY/{{journal.journal_subfolders.daily}}/YYYY-MM-DD {Kind} - {Title}.md\\`\n3. **Apply frontmatter**:\n   \\`\\`\\`yaml\n   ---\n   created: YYYY-MM-DD\n   updated: YYYY-MM-DD\n   tags: [journal, {kind-lowercase}]\n   status: seed\n   type: journal\n   kind: {Kind}\n   ---\n   \\`\\`\\`\n   Sections: \\`## Context\\`, \\`## Takeaways\\`, \\`## Store\\`\n\n{{#if features.meeting_enhancement}}\n4. **Kind-specific enhancements:**\n\n   **Encounter (type: meeting):**\n   - Add \\`## Action Items\\` with checkboxes: \\`- [ ] {action} â€” @{owner} (due: {date})\\`\n   - Add \\`## Key Quotes\\` attributed to attendees\n   - Add \\`## Follow-up Required\\` with timeline\n   - Link to relevant \\`{{folders.people}}/\\` and \\`{{folders.orgs}}/\\` notes\n   - Update \\`last-contact\\` frontmatter on referenced person notes\n\n{{/if}}\n{{#if features.question_tracker}}\n5. **Extract questions** (#3 Question Tracker):\n   Scan journal content for substantive questions â€” \"I wonder...\", \"need to figure out...\",\n   sentences ending in \\`?\\` about decisions, strategy, or understanding.\n   **Filter:** Only track questions about decisions, strategy, understanding, or personal growth.\n   Ignore logistics, scheduling, and rhetorical questions.\n   Collect into \\`## Open Questions\\` section on the event journal.\n   Also append to the relevant MOC's \\`## Open Questions\\` section if a MOC exists for the topic.\n\n{{/if}}\n{{#if features.commitment_tracker}}\n6. **Extract commitments** (#24 Commitment Tracker):\n   Scan for commitments to people â€” \"I told {person} I'd...\", \"promised to...\",\n   \"need to send {person}...\", \"agreed to...\" with deadlines if mentioned.\n   Add to \\`## Commitments\\` section on the relevant person note in \\`{{folders.people}}/\\`:\n   \\`\\`\\`markdown\n   - [ ] {commitment} â€” from [[{journal-date}]] (due: {date-if-mentioned})\n   \\`\\`\\`\n   **Important:** Check the person note's existing commitments and open todo lists in the vault\n   to avoid duplicating items already tracked elsewhere.\n\n{{/if}}\n7. **Link from daily note** under \\`## Events\\`\n8. Delete inbox file\n\n## Step 1.2 â€” Salience Tagger\n\nScan journals modified in last 24h.\n\n**HIGH salience** â†’ add \\`#salient\\`:\n- Explicit tags: \\`#salient\\`, \\`#urgent\\`, \\`#painful\\`, \\`#win\\`\n- Risk language: \"risk\", \"threat\", \"red flag\", \"critical\"\n- Emotional markers: \"surprised\", \"shocked\", \"changed my mind\"\n- High stakes: \"$\", \"million\", \"funding\", \"fired\", \"hired\"\n\n**MEDIUM salience** â†’ add \\`#notable\\`:\n- \"interesting\", \"worth noting\", \"keep in mind\", \"opportunity\"\n\n**Idempotent:** skip if already tagged.\n\n## Step 1.3 â€” Route Remaining Inbox\n\nRoute entity/reference items to folders:\n\n{{#if folders.people}}- **People** â†’ \\`{{folders.people}}/\\`{{/if}}\n{{#if folders.orgs}}- **Orgs** â†’ \\`{{folders.orgs}}/\\`{{/if}}\n{{#if folders.projects}}- **Projects** â†’ \\`{{folders.projects}}/\\`{{/if}}\n{{#if folders.sources}}- **Sources** (articles, books, clips) â†’ \\`{{folders.sources}}/\\`{{/if}}\n{{#if folders.resources}}- **Concepts/Knowledge** â†’ \\`{{folders.resources}}/{topic-subfolder}/\\`{{/if}}\n{{#if folders.playbooks}}- **Playbooks** (how-tos, processes) â†’ \\`{{folders.playbooks}}/\\`{{/if}}\n\nFor each routed item:\n- Enrich with proper frontmatter\n- Add relevant links to existing notes\n- Move to destination\n\n## Step 1.4 â€” People Auto-Research\n\nDetect sparse people notes and enrich:\n\n1. Find sparse people notes in \\`{{folders.people}}/\\`:\n   - File size < 500 bytes, \\`status: seed\\`, NOT \\`auto-researched: true\\`\n   - NOT modified within last 7 days\n2. Batch limit: 3-5 notes per run\n3. Web search for job title, company, brief bio\n4. Update with attribution banner\n5. Safety: only fill empty sections, never overwrite\n\n---\n\n## Commit (if git available)\n\n\\`\\`\\`bash\ngit add -A && git commit -m \"vault-gardener seed: {date} ({count} items processed)\"\n\\`\\`\\`\n\n---\n\n{{#if features.changelog}}\n## Vault Changelog\n\nAppend a human-readable summary of this seed run to \\`.gardener/changelog.md\\`:\n\n\\`\\`\\`markdown\n### {YYYY-MM-DD HH:MM} â€” Seed\n- {1-line summary of what was processed}\n- Items: {count} triaged, {journals} journals created\n- Questions extracted: {count}\n- Commitments tracked: {count}\n\\`\\`\\`\n\nKeep only the last 50 entries in the changelog file.\n\n{{/if}}\n---\n\n{{#if features.memory}}\n## Memory Update\n\nUpdate \\`.gardener/memory.md\\` with seed phase results. Use YAML frontmatter + markdown:\n\n\\`\\`\\`markdown\n---\nlast_run: {ISO timestamp}\nlast_phase: seed\nitems_processed: {count}\nitems_deferred: {count}\n---\n## Seed Phase\n- Processed {count} inbox items\n- {any items deferred and why}\n- {observations about vault state relevant to next run}\n\\`\\`\\`\n\nMerge with existing memory content â€” don't overwrite nurture/tend sections.\n\n---\n\n{{/if}}\n## Run Report\n\nAfter completing all steps, write a JSON file to \\`.gardener/run-report.json\\`:\n\n\\\\\\`\\\\\\`\\\\\\`json\n{\n  \"version\": 1,\n  \"timestamp\": \"{ISO-8601 timestamp}\",\n  \"phases\": [{\n    \"phase\": \"seed\",\n    \"started\": true,\n    \"features\": [\n      { \"feature\": \"{key}\", \"status\": \"executed|skipped|error\", \"counts\": { ... }, \"reason\": \"{if skipped/error}\" }\n    ]\n  }],\n  \"summary\": \"{1-2 sentence summary of what was done}\",\n  \"warnings\": []\n}\n\\\\\\`\\\\\\`\\\\\\`\n\nReport these features (only report enabled features listed here):\n{{#if features.memory}}- \\`memory\\` â€” counts: \\`{ \"read\": 0|1, \"updated\": 0|1 }\\`\n{{/if}}{{#if features.changelog}}- \\`changelog\\` â€” counts: \\`{ \"entries_written\": 0|1 }\\`\n{{/if}}{{#if features.persona}}- \\`persona\\` â€” counts: \\`{ \"applied\": 0|1 }\\`\n{{/if}}{{#if features.this_time_last_year}}- \\`this_time_last_year\\` â€” counts: \\`{ \"lookbacks_added\": {n} }\\`\n{{/if}}{{#if features.meeting_enhancement}}- \\`meeting_enhancement\\` â€” counts: \\`{ \"meetings_enhanced\": {n} }\\`\n{{/if}}{{#if features.question_tracker}}- \\`question_tracker\\` â€” counts: \\`{ \"questions_extracted\": {n} }\\`\n{{/if}}{{#if features.commitment_tracker}}- \\`commitment_tracker\\` â€” counts: \\`{ \"commitments_tracked\": {n} }\\`\n{{/if}}\n\nAlso report core steps as features:\n- \\`cleanup\\` â€” counts: \\`{ \"files_cleaned\": {n} }\\`\n- \\`triage\\` â€” counts: \\`{ \"episodic\": {n}, \"entity\": {n} }\\`\n- \\`binder\\` â€” counts: \\`{ \"daily_captures\": {n}, \"event_journals\": {n} }\\`\n- \\`salience\\` â€” counts: \\`{ \"high\": {n}, \"medium\": {n} }\\`\n- \\`routing\\` â€” counts: \\`{ \"items_routed\": {n} }\\`\n\n**Rules:**\n- Report EVERY listed feature, even if skipped (use status \"skipped\" with a reason)\n- The \\`phase\\` field MUST be exactly one of: \\`\"seed\"\\`, \\`\"nurture\"\\`, or \\`\"tend\"\\` â€” no other values\n- Write valid JSON â€” no trailing commas, no comments\n- If \\`.gardener/run-report.json\\` already exists (multi-phase run), read it first and APPEND your phase to the \\`phases\\` array\n\n---\n\n## Output\n\nSummary:\n- **Cleanup**: {files} files cleaned\n- **Triage**: {episodic} episodic, {entity} entity items classified\n- **Journals**: {daily} daily captures, {event} event journals created\n- **Salience**: {high} high, {medium} medium tags applied\n- **Routing**: {routed} items routed to folders\n- **People**: {researched} people notes auto-researched\n- **Questions**: {count} substantive questions extracted\n- **Commitments**: {count} commitments tracked on person notes`,\n\n  // ---------------------------------------------------------------------------\n  nurture: `# Nurture â€” Structure & Knowledge Building\n\nRepair structure, consolidate episodic memories into semantic knowledge, and build\nthe knowledge graph. Structural integrity first, then belief updates, playbook\nextraction, MOC generation, and semantic linking.\n\n**No information is ever deleted** â€” only reorganized, enriched, and connected.\n\n{{#if features.persona}}\n## Persona\n\n{{#if (eq persona \"analytical\")}}You are an **analytical** gardener. Focus on facts, data, and minimal interpretation. Be precise, structured, and evidence-based. Avoid speculation.{{/if}}\n{{#if (eq persona \"reflective\")}}You are a **reflective** gardener. Ask questions, explore deeper meaning, and surface connections. Balance structure with thoughtful commentary.{{/if}}\n{{#if (eq persona \"coach\")}}You are a **coaching** gardener. Be prescriptive and action-oriented. Frame observations as recommendations. Push for clarity and commitment.{{/if}}\n\n{{/if}}\n{{#if features.memory}}\n## Memory\n\nRead \\`.gardener/memory.md\\` if it exists. Use previous run context to:\n- Avoid re-processing already-consolidated beliefs\n- Continue linking projects from where they left off\n- Prioritize areas flagged in previous runs\n\n{{/if}}\n## Safety\n\n- **Never delete** â€” only reorganize, enrich, connect\n- **Skip recently modified** â€” if file modified in last 5 min, skip it\n- **Never touch protected paths**: {{#each protected}}\\`{{this}}/\\` {{/each}}\n\n## Instructions\n\nRead \\`.gardener/context.md\\` for vault structure and rules.\n\n---\n\n## Step 1 â€” Structural Integrity Checks\n\n- **Root orphans**: Find \\`.md\\` files in vault root (not in any folder). Move to \\`{{folders.inbox}}/\\` for triage.\n- **Depth check**: Flag folders nested deeper than 3 levels.\n- **Duplicate detection**: Find notes with identical titles in different folders. Log for review.\n- **Broken WikiLinks**: Scan for \\`[[links]]\\` pointing to non-existent notes. Auto-fix close matches (case-insensitive). Log rest.\n- **Empty notes**: Find notes with only frontmatter and no body content, older than 7 days. Flag for review.\n\n## Step 1.1 â€” Frontmatter Compliance Sweep\n\nScan notes modified in the last 14 days. Verify required frontmatter:\n\n- **All notes**: {{#each frontmatter.required}}\\`{{this}}\\`{{#unless @last}}, {{/unless}}{{/each}}\n{{#if folders.projects}}- **Projects**: \\`deadline\\`, \\`outcome\\`, \\`priority\\`, \\`role\\`{{/if}}\n{{#if folders.roles}}- **Roles**: \\`role\\`, \\`cadence\\`{{/if}}\n{{#if folders.people}}- **People**: \\`relationship\\`, \\`company\\`, \\`last-contact\\`{{/if}}\n{{#if folders.orgs}}- **Orgs**: \\`org-type\\`, \\`industry\\`, \\`website\\`, \\`relationship\\`{{/if}}\n{{#if folders.resources}}- **Resources**: \\`source\\`, \\`author\\`, \\`rating\\`, \\`topic\\`{{/if}}\n\nFill missing fields with sensible defaults:\n- \\`created\\`/\\`updated\\` â†’ file dates\n- \\`status\\` â†’ \\`seed\\` if new\n- \\`type\\` â†’ infer from folder location\n- \\`tags\\` â†’ infer 1-3 from title/content\n\n{{#if features.tag_normalization}}\n## Step 1.3 â€” Tag Taxonomy Normalization\n\nScan tags across recently modified notes. Detect tags that should be merged:\n\n- **Synonyms**: \\`#machine-learning\\` and \\`#ml\\`, \\`#artificial-intelligence\\` and \\`#ai\\`\n- **Plural/singular**: \\`#projects\\` and \\`#project\\`\n- **Spelling variants**: \\`#behaviour\\` and \\`#behavior\\`\n- **Hierarchy candidates**: \\`#react\\` could be under \\`#frontend\\`\n\n**Actions:**\n- Report suggested merges in the run's output â€” **never auto-merge** (user should confirm)\n- If a clear canonical form exists (the one used more often), note it\n- Log suggestions to \\`## Tag Cleanup\\` section in \\`.gardener/changelog.md\\`\n\n---\n\n{{/if}}\n## Step 1.4 â€” Orphan Triage\n\nIdentify notes with no incoming links (orphans).\n\n- \\`status: seed\\` + >14 days + 0 incoming links â†’ add review comment, try to auto-link\n- \\`status: growing\\` + orphan â†’ add to \"Needs Attention\" list\n- \\`status: evergreen\\` + orphan â†’ attempt auto-link\n\n**Never auto-archive orphans.**\n\n---\n\n## Step 2 â€” Consolidator\n\nScan all journals with \\`## Store\\` sections.\n\n### Process checked items (\\`- [x] Update [[Target]] with {content}\\`)\n\n1. Open target note\n2. Find or create \\`## Beliefs (with receipts)\\` section\n3. Count supporting journals:\n   - 2+ journals â†’ \\`âœ… confirmed\\`\n   - 1 journal â†’ \\`ðŸŸ¡ emerging\\`\n   - Explicitly hypothesis â†’ \\`ðŸ§ª hypothesis\\`\n4. Append bullet: \\`- {marker} {belief} â€” evidence: [[Journal 1]], [[Journal 2]]\\`\n5. **Contradiction check:** If conflicting belief found, mark both \\`ðŸŸ¡ emerging\\` and add warning callout\n6. Mark Store checkbox as consolidated\n\n**Never delete beliefs.** Mark \\`â›” retracted\\` when outdated.\n\n**Batch limit:** Max {{limits.beliefs_per_run}} belief updates per run.\n\n{{#if features.co_mention_network}}\n## Step 2.0.1 â€” People Co-Mention Network\n\nFor each person note in \\`{{folders.people}}/\\` modified or referenced in the last 14 days:\n\n1. Scan recent journals for co-mentions â€” when two people appear in the same journal entry\n2. Build or update a \\`## Network\\` section on the person note:\n   \\`\\`\\`markdown\n   ## Network\n   Frequently mentioned alongside:\n   - [[Jane Smith]] (5 entries)\n   - [[Acme Corp]] (3 entries)\n   - [[Bob Johnson]] (2 entries)\n   \\`\\`\\`\n3. Only include co-mentions appearing in 2+ journal entries\n4. Update counts if section already exists (don't duplicate)\n\n{{/if}}\n{{#if features.commitment_tracker}}\n## Step 2.0.2 â€” Commitment Compliance\n\nFor each person note in \\`{{folders.people}}/\\`:\n1. Check \\`## Commitments\\` section for overdue items (past due date)\n2. Check open todo lists in the vault to avoid duplicating tracked items\n3. Flag overdue commitments in the run summary\n4. Cross-reference with recent journals â€” if a commitment was fulfilled, mark it:\n   \\`- [x] {commitment} â€” completed [[{journal-date}]]\\`\n\n{{/if}}\n---\n\n## Step 2.1 â€” Playbook Builder\n\nDetect procedural patterns across journals.\n\n**Triggers:**\n- 3+ journals share 2+ tags AND contain step-lists\n- OR note tagged \\`#playbook-candidate\\`\n\n**Actions:**\n- Create/update \\`{{folders.playbooks}}/{topic-slug}.md\\`\n- Sections: \\`## Trigger\\`, \\`## Steps\\`, \\`## Failure Modes\\`, \\`## Evidence\\`\n\n**Batch limit:** Max {{limits.playbooks_per_run}} playbooks per run.\n\n## Step 2.2 â€” Auto-MOC\n\nGenerate Maps of Content for frequently-mentioned entities.\n\n**Threshold (adaptive):**\n| Vault Notes | Base | Salient Override |\n|-------------|------|------------------|\n| < 100 | 5 | 3 |\n| 100-500 | 8 | 5 |\n| 500+ | 12 | 7 |\n\n**Actions:**\n- Create \\`{{folders.mocs}}/MOC - {Entity}.md\\`\n- Sections: \\`## Timeline\\`, \\`## Key Beliefs\\`, \\`## Related\\`, \\`## Open Questions\\`\n\n**Batch limit:** Max {{limits.mocs_per_run}} new MOCs per run.\n\n{{#if features.knowledge_gaps}}\n### Knowledge Gap Detection (#19)\n\nDuring MOC generation/update, identify subtopics that are frequently referenced or implied\nbut have no dedicated note in the vault:\n\n1. Scan MOC content and linked notes for entity/concept mentions without matching vault notes\n2. **Threshold:** Only flag gaps appearing in **5+ journal entries** (not just casual mentions)\n3. Add a \\`## Knowledge Gaps\\` section to the MOC:\n   \\`\\`\\`markdown\n   ## Knowledge Gaps\n   Frequently mentioned but no dedicated note:\n   - **transformer architecture** â€” mentioned in 7 journals, referenced by [[ML Basics]], [[GPT Notes]]\n   - **CAP theorem** â€” mentioned in 5 journals, referenced by [[Distributed Systems]]\n   \\`\\`\\`\n4. These are natural candidates for future learning or note creation\n{{/if}}\n\n---\n\n{{#if features.entity_auto_linking}}\n## Step 3 â€” Entity Mention Auto-Linking\n\nScan notes modified in the last 14 days for plain-text mentions of known entities\n(people, organizations, projects) that exist as vault notes but aren't WikiLinked.\n\n1. Build entity list from filenames in \\`{{folders.people}}/\\`, \\`{{folders.orgs}}/\\`, \\`{{folders.projects}}/\\`\n2. For each recently modified note, find plain-text mentions matching entity names (case-insensitive)\n3. Convert to WikiLinks: \\`I talked to John Smith\\` â†’ \\`I talked to [[John Smith]]\\`\n4. **Safety rules:**\n   - Only link names that **exactly match** an existing note filename (case-insensitive)\n   - Skip names shorter than 4 characters (too many false positives)\n   - Don't link inside code blocks, URLs, or existing WikiLinks\n   - Use contextual disambiguation: \"Apple\" the company vs the fruit â€” only link if context\n     matches the note's \\`type\\` frontmatter\n5. **Batch limit:** Max {{limits.links_per_run}} auto-links per run (shared with Step 3.1 below)\n\n{{/if}}\n---\n\n## Step 3.1 â€” Semantic Similarity Linking\n\nAnalyze notes modified in the last 14 days. Find related notes using:\n- **Tag overlap**: 2+ topic-specific tags shared (exclude structural tags)\n- **Title word overlap**: Significant shared words\n- **Topic match**: Same \\`topic\\` frontmatter\n- **Content keywords**: Top 5 keywords, find notes mentioning them\n\nFor each candidate pair with no existing link:\n- Add bidirectional WikiLinks in \\`## See Also\\` section\n{{#if features.backlink_context}}\n- **Include context sentence** (#10): Don't add bare links. Include the sentence that\n  establishes the connection:\n  \\`\\`\\`markdown\n  ## See Also\n  - [[Thinking in Systems]] â€” \"Applied the systems framework to the architecture decision\"\n    (from [[Journal 2026-02-15]])\n  - [[Conway's Law]] â€” shares tags #architecture, #org-design\n  \\`\\`\\`\n  Only add context for **newly-added links** (don't retroactively annotate existing links).\n{{/if}}\n\n**Limit:** Max {{limits.links_per_run}} new links per run (shared with Step 3 entity linking).\n\n{{#if features.transitive_links}}\n## Step 3.2 â€” Transitive Link Suggestions\n\nIf note A links to B and B links to C, but A does not link to C, and A and C share\ntags or keywords, suggest a direct link with the connection path annotated:\n\n\\`\\`\\`markdown\n## See Also\n- [[Conway's Law]] â€” transitive via [[Org Design]]: \"Your thoughts on hiring connect\n  to system design through organizational structure\"\n\\`\\`\\`\n\n**Scope limit:** Only analyze notes modified in the last 14 days, only 1 hop deep.\nPresent as suggestions in \\`## See Also\\` â€” clearly marked as transitive connections.\n\n{{/if}}\n---\n\n## Commit (if git available)\n\n\\`\\`\\`bash\ngit add -A && git commit -m \"vault-gardener nurture: {date} ({beliefs} beliefs, {links} links)\"\n\\`\\`\\`\n\n---\n\n{{#if features.changelog}}\n## Vault Changelog\n\nAppend a human-readable summary of this nurture run to \\`.gardener/changelog.md\\`:\n\n\\`\\`\\`markdown\n### {YYYY-MM-DD HH:MM} â€” Nurture\n- {1-line summary of structural work}\n- Beliefs: {consolidated} consolidated, {contradictions} contradictions found\n- Links: {count} new (entity: {entity}, semantic: {semantic}, transitive: {transitive})\n- Tags: {count} merge suggestions\n- Knowledge gaps: {count} identified\n\\`\\`\\`\n\nKeep only the last 50 entries in the changelog file.\n\n{{/if}}\n---\n\n{{#if features.memory}}\n## Memory Update\n\nUpdate \\`.gardener/memory.md\\` with nurture phase results:\n\n\\`\\`\\`markdown\n## Nurture Phase\n- Consolidated {count} beliefs, {remaining} Store items remaining\n- Added {count} links, {orphans} orphans still unlinked\n- Tag merge suggestions: {list}\n- {observations for next run}\n\\`\\`\\`\n\nMerge with existing memory â€” preserve seed/tend sections.\n\n---\n\n{{/if}}\n## Run Report\n\nAfter completing all steps, write a JSON file to \\`.gardener/run-report.json\\`:\n\n\\\\\\`\\\\\\`\\\\\\`json\n{\n  \"version\": 1,\n  \"timestamp\": \"{ISO-8601 timestamp}\",\n  \"phases\": [{\n    \"phase\": \"nurture\",\n    \"started\": true,\n    \"features\": [\n      { \"feature\": \"{key}\", \"status\": \"executed|skipped|error\", \"counts\": { ... }, \"reason\": \"{if skipped/error}\" }\n    ]\n  }],\n  \"summary\": \"{1-2 sentence summary of what was done}\",\n  \"warnings\": []\n}\n\\\\\\`\\\\\\`\\\\\\`\n\nReport these features (only report enabled features listed here):\n{{#if features.memory}}- \\`memory\\` â€” counts: \\`{ \"read\": 0|1, \"updated\": 0|1 }\\`\n{{/if}}{{#if features.changelog}}- \\`changelog\\` â€” counts: \\`{ \"entries_written\": 0|1 }\\`\n{{/if}}{{#if features.persona}}- \\`persona\\` â€” counts: \\`{ \"applied\": 0|1 }\\`\n{{/if}}{{#if features.tag_normalization}}- \\`tag_normalization\\` â€” counts: \\`{ \"merge_suggestions\": {n} }\\`\n{{/if}}{{#if features.co_mention_network}}- \\`co_mention_network\\` â€” counts: \\`{ \"networks_updated\": {n} }\\`\n{{/if}}{{#if features.knowledge_gaps}}- \\`knowledge_gaps\\` â€” counts: \\`{ \"gaps_identified\": {n} }\\`\n{{/if}}{{#if features.entity_auto_linking}}- \\`entity_auto_linking\\` â€” counts: \\`{ \"mentions_linked\": {n} }\\`\n{{/if}}{{#if features.backlink_context}}- \\`backlink_context\\` â€” counts: \\`{ \"contexts_added\": {n} }\\`\n{{/if}}{{#if features.transitive_links}}- \\`transitive_links\\` â€” counts: \\`{ \"links_suggested\": {n} }\\`\n{{/if}}{{#if features.commitment_tracker}}- \\`commitment_tracker\\` â€” counts: \\`{ \"commitments_reviewed\": {n}, \"overdue\": {n} }\\`\n{{/if}}\n\nAlso report core steps as features:\n- \\`structural_integrity\\` â€” counts: \\`{ \"orphans_moved\": {n}, \"duplicates_found\": {n}, \"broken_links_fixed\": {n} }\\`\n- \\`frontmatter_sweep\\` â€” counts: \\`{ \"notes_fixed\": {n}, \"fields_added\": {n} }\\`\n- \\`consolidator\\` â€” counts: \\`{ \"beliefs_consolidated\": {n}, \"contradictions\": {n} }\\`\n- \\`playbook_builder\\` â€” counts: \\`{ \"created\": {n}, \"updated\": {n} }\\`\n- \\`auto_moc\\` â€” counts: \\`{ \"created\": {n}, \"refreshed\": {n} }\\`\n- \\`semantic_linking\\` â€” counts: \\`{ \"links_added\": {n} }\\`\n\n**Rules:**\n- Report EVERY listed feature, even if skipped (use status \"skipped\" with a reason)\n- The \\`phase\\` field MUST be exactly one of: \\`\"seed\"\\`, \\`\"nurture\"\\`, or \\`\"tend\"\\` â€” no other values\n- Write valid JSON â€” no trailing commas, no comments\n- If \\`.gardener/run-report.json\\` already exists (multi-phase run), read it first and APPEND your phase to the \\`phases\\` array\n\n---\n\n## Output\n\nSummary:\n- **Structure**: {root} orphans moved, {dupes} duplicates found, {broken} links fixed\n- **Frontmatter**: {notes} notes fixed, {fields} fields added\n- **Tags**: {count} merge suggestions identified\n- **Orphans**: {linked} auto-linked, {flagged} flagged\n- **Beliefs**: {consolidated} beliefs consolidated, {contradictions} contradictions\n- **Playbooks**: {created} created, {updated} updated\n- **MOCs**: {created} new MOCs, {updated} refreshed, {gaps} knowledge gaps identified\n- **Entity links**: {count} plain-text mentions auto-linked\n- **Semantic links**: {count} new links with context sentences\n- **Transitive links**: {count} suggested\n- **People**: {networks} co-mention networks updated, {commitments} commitments reviewed`,\n\n  // ---------------------------------------------------------------------------\n  tend: `# Tend â€” Lifecycle & Enrichment\n\nReview note lifecycle, organize semantic memory into topic folders, and progressively\nenrich sparse notes. Pruning, organizing, and nurturing the knowledge garden.\n\n**No information is ever deleted** â€” only reorganized, enriched, and connected.\n\n{{#if features.persona}}\n## Persona\n\n{{#if (eq persona \"analytical\")}}You are an **analytical** gardener. Focus on facts, data, and minimal interpretation. Be precise, structured, and evidence-based. Avoid speculation.{{/if}}\n{{#if (eq persona \"reflective\")}}You are a **reflective** gardener. Ask questions, explore deeper meaning, and surface connections. Balance structure with thoughtful commentary.{{/if}}\n{{#if (eq persona \"coach\")}}You are a **coaching** gardener. Be prescriptive and action-oriented. Frame observations as recommendations. Push for clarity and commitment.{{/if}}\n\n{{/if}}\n{{#if features.memory}}\n## Memory\n\nRead \\`.gardener/memory.md\\` if it exists. Use previous run context to:\n- Continue enrichment from where it left off\n- Avoid re-generating journals already created\n- Track enrichment queue progress across runs\n\n{{/if}}\n## Safety\n\n- **Never delete** â€” only reorganize, enrich, connect\n- **Skip recently modified** â€” if file modified in last 5 min, skip it\n- **Never touch protected paths**: {{#each protected}}\\`{{this}}/\\` {{/each}}\n\n## Instructions\n\nRead \\`.gardener/context.md\\` for vault structure and rules.\n\n---\n\n## Step 1 â€” Stale Note Review\n\nNon-destructive review. **Never auto-archive or delete.**\n\n| Condition | Action |\n|-----------|--------|\n| \\`seed\\` + 0 incoming links + >14 days old | Add review comment. Find 2-3 related notes and add WikiLinks. |\n| \\`seed\\` + >30 days old | Flag in summary: \"Needs attention â€” develop or connect.\" |\n| Event journal with all Store items processed | Set \\`status: consolidated\\`. |\n\n## Step 1.1 â€” Semantic Memory Organizer\n\nAuto-organize \\`{{folders.resources}}/\\` into topic subfolders.\n\n1. **Scan loose files** in \\`{{folders.resources}}/\\` root\n2. **Detect topic** from title, tags, content, \\`topic\\` frontmatter\n3. **Route to matching subfolder:**\n   - Subfolder exists â†’ move file, update \\`topic\\` frontmatter\n   - No subfolder but {{auto_grow.resources}}+ loose files share topic â†’ create subfolder + index note\n   - Topic unclear or < {{auto_grow.resources}} matches â†’ leave in root\n4. **Update index notes** with file links\n5. **Never move files OUT of existing subfolders**\n\n**Topic taxonomy:**\n{{#each topics}}\n- **{{@key}}**: {{#each this}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}\n{{/each}}\n\nNew topic categories auto-created when {{auto_grow.resources}}+ notes share keywords not covered above.\n\n**Batch limit:** Max {{limits.organize_per_run}} files organized per run.\n\n---\n\n## Step 2 â€” Journal Generation\n\nGenerate higher-level journal summaries when threshold data exists.\n\n### Weekly Summary\n- **Trigger**: 3+ daily entries exist for the week\n- **Location**: \\`{{folders.journal}}/YYYY/{{journal.journal_subfolders.weekly}}/YYYY-WNN.md\\`\n- **Style**: {{journal.style.weekly}}\n- **Sections**: Highlights, Decisions, Learnings, People, Open Items for Next Week\n- **Links**: Back-links to each daily + event journal\n\n**Additional weekly sections:**\n\n{{#if features.social_content}}\n\\`## Social Content\\` â€” Generate draft social media content targeting {{#each social_platforms}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}:\n- Source from that week's journals and newly created/modified notes\n- 2-3 post drafts per platform, adapted to platform style and length\n- **Exclude** personal/sensitive information, private names, health data, financial details\n- Focus on professional insights, learnings, and publicly shareable observations\n- Mark as \\`> [!social] Draft â€” review before posting\\`\n\n{{/if}}\n{{#if features.question_tracker}}\n\\`## Question Tracker Update\\` â€” Review open questions from this week's journals.\nFor each: is there evidence in subsequent entries that it was answered? If yes,\nmark resolved with link to the answering journal. Surface unresolved questions.\n\n{{/if}}\n### Monthly Summary\n- **Trigger**: 2+ weekly entries exist for the month\n- **Location**: \\`{{folders.journal}}/YYYY/{{journal.journal_subfolders.monthly}}/YYYY-MM.md\\`\n- **Style**: {{journal.style.monthly}}\n- **Sections**: Highlights, Goal Progress, Key Relationships, Knowledge Growth, Gardener Recommendations\n\n**Additional monthly sections:**\n\n{{#if features.belief_trajectory}}\n\\`## Belief Changes\\` (#15 Belief Trajectory) â€” Review the Consolidator's recent work.\nInclude only when there are recent belief changes:\n- Newly confirmed beliefs (with evidence links)\n- Emerging contradictions between beliefs\n- Retracted beliefs and why\n- Group by topic for readability\n\n{{/if}}\n{{#if features.theme_detection}}\n\\`## Emerging Themes\\` (#16 Monthly Theme Detection) â€” Analyze all daily/event journals\nfrom this month to detect recurring themes the user hasn't explicitly tagged:\n- What topics consumed the most writing energy?\n- What unexpected patterns emerged?\n- Example: \"This month's emerging theme: Convergence â€” multiple projects reached\n  critical milestones simultaneously.\"\n- Labels are suggestions, not permanent categories\n\n{{/if}}\n{{#if features.attention_allocation}}\n\\`## Attention Allocation\\` (#17) â€” Count journal entries referencing each role, project,\nand person. Present breakdown:\n- \"This month: 40% [[Engineering Lead]], 25% [[Website Redesign]], 15% [[Jane Smith]], 20% misc.\"\n- Compare to previous month if available\n- Include note view counts / modification frequency as additional signal\n- **Caveat note**: \"Based on journal mentions and note activity, not time spent.\"\n\n{{/if}}\n{{#if features.goal_tracking}}\n\\`## Goal Progress\\` (#21 Goal Tracking via Journal Evidence) â€” Scan yearly/quarterly\nnotes for goal definitions (e.g., \\`- [ ] Ship v2 by March\\`). For each goal:\n- Count journal entries mentioning it\n- Link to milestone journals as evidence\n- Identify blockers mentioned in journals\n- **Present evidence counts and links** â€” do NOT estimate percentages\n- Example: \"Ship v2: 4 mentions, 2 milestones ([[API Complete]], [[Frontend Draft]]),\n  1 blocker identified ([[Auth Issues]])\"\n\n{{/if}}\n### Quarterly Reflection\n- **Trigger**: 2+ monthly entries exist for the quarter\n- **Location**: \\`{{folders.journal}}/YYYY/{{journal.journal_subfolders.quarterly}}/YYYY-QN.md\\`\n- **Style**: {{journal.style.quarterly}}\n- **Sections**: Quarter in Review, Progress Against Themes, Goal Assessment, Key Learnings, Top Relationships, Gardener Recommendations\n\n**Additional quarterly sections:**\n\n{{#if features.seasonal_patterns}}\n\\`## Seasonal Patterns\\` (#20) â€” If 12+ months of journal data exists, compare current\nquarter's themes and attention allocation with the same quarter in previous years:\n- \"You tend to focus on hiring in Q1\"\n- \"Journaling frequency drops in Q3\"\n- Even weak 2-year patterns are interesting hypotheses â€” present as observations\n- If insufficient data (<12 months), skip this section entirely\n\n{{/if}}\n{{#if features.commitment_tracker}}\n\\`## Commitment Review\\` (#24) â€” Summarize commitment tracking from person notes:\n- Total commitments made this quarter\n- Completion rate\n- Overdue items with links\n- People with most outstanding commitments\n\n{{/if}}\n### Yearly Review\n- **Trigger**: User sets themes in yearly note\n- **Location**: \\`{{folders.journal}}/YYYY/{{journal.journal_subfolders.yearly}}/YYYY.md\\`\n- **Style**: {{journal.style.yearly}}\n- **Sections**: Themes, Goals & Plans, Progress Tracker, Key Events, Key Learnings, Gardener Recommendations\n- **Lifecycle**: Created on Jan 1st (or init). Updated monthly. Comprehensive Q4 review.\n\n**Additional yearly sections:**\n\n{{#if features.seasonal_patterns}}\n\\`## Seasonal Patterns\\` (#20) â€” Full year pattern analysis. Compare month-by-month\nattention allocation. Surface rhythms: when do you write most? Which themes peak when?\n\n{{/if}}\n{{#if features.goal_tracking}}\n\\`## Annual Goal Evidence\\` (#21) â€” Comprehensive evidence-based goal review using all\nmonthly summaries and quarterly reflections. Link to key milestone journals.\n\n{{/if}}\n---\n\n## Step 3 â€” Progressive Enrichment Queue\n\nProcess sparse notes for enrichment.\n\n{{#if features.adaptive_batch_sizing}}\n### Adaptive Batch Sizing (#36)\n\nAdjust enrichment limits based on vault size:\n| Vault Notes | enrich_per_run | Reasoning |\n|-------------|---------------|-----------|\n| < 100       | {{limits.enrich_per_run}} Ã— 2 | Small vault, process more aggressively |\n| 100-500     | {{limits.enrich_per_run}} | Standard limits |\n| 500+        | max({{limits.enrich_per_run}} Ã· 2, 3) | Large vault, be selective |\n\n{{/if}}\n### Candidate Selection\n\n1. Scan vault for candidates:\n   - Notes with \\`status: seed\\` and content < 200 words\n   - Notes with 0 outgoing WikiLinks\n   - Resource notes missing \\`## Key Takeaways\\`\n   - Notes >1000 words without a \\`## TL;DR\\` section\n\n{{#if features.enrichment_priority}}\n### Priority Scoring (#37)\n\nRank candidates using **multi-factor priority** (not just journal references):\n\n| Factor | Weight | Description |\n|--------|--------|-------------|\n| Journal references | High | More journals mention it â†’ higher priority |\n| Goal alignment | High | Connected to active goals in yearly/quarterly notes |\n| Salience tags | Medium | Has \\`#salient\\` or \\`#notable\\` |\n| Project activity | Medium | Referenced by active projects (not archived) |\n| Connectivity | Medium | Orphan notes (0 incoming links) get priority boost |\n| Recency | Low | More recently created notes slightly preferred |\n\n{{/if}}\n### Enrichment Actions\n\nProcess top candidates (adjusted by adaptive batch sizing):\n\n**For all sparse notes (<200 words):**\n- Extract key concepts and create/link resource notes\n- Add 3-5 WikiLinks to related notes\n- Expand thin sections\n- Promote \\`seed\\` â†’ \\`growing\\` if substantially enriched\n\n{{#if features.context_anchoring}}\n**Context Anchoring for sparse notes (#4):**\nWhen enriching a sparse note, scan the vault for *when and why* it was created.\nFind journal entries from the same week, identify what the user was working on.\nAdd \\`## Origin Context\\`:\n\\`\\`\\`markdown\n## Origin Context\n> [!context] Auto-generated by vault-gardener\n> You likely created this during the week you were working on [[Project X]],\n> after meeting with [[Person Y]]. Related journals: [[2026-01-15]], [[2026-01-17]].\n\\`\\`\\`\nUse confidence language: \"likely related to\" when temporal correlation is strong,\n\"created during the same period as\" when weaker.\n\n{{/if}}\n{{#if features.auto_summary}}\n**Auto-Summary for long notes (#8):**\nAny note >1000 words without a \\`## TL;DR\\` gets an auto-generated 2-3 sentence summary\nplaced after frontmatter:\n\\`\\`\\`markdown\n> [!summary] Auto-generated by vault-gardener\n> {2-3 sentence summary capturing the key point and main conclusion}\n\\`\\`\\`\n\n{{/if}}\n4. Report: \"Enriched {count} notes, {remaining} remaining in queue\"\n\n---\n\n## Commit (if git available)\n\n\\`\\`\\`bash\ngit add -A && git commit -m \"vault-gardener tend: {date} ({enriched} enriched, {organized} organized)\"\n\\`\\`\\`\n\n---\n\n{{#if features.changelog}}\n## Vault Changelog\n\nAppend a human-readable summary of this tend run to \\`.gardener/changelog.md\\`:\n\n\\`\\`\\`markdown\n### {YYYY-MM-DD HH:MM} â€” Tend\n- {1-line summary of lifecycle/enrichment work}\n- Journals generated: {weekly} weekly, {monthly} monthly, {quarterly} quarterly\n- Notes enriched: {count} ({remaining} remaining)\n- Summaries added: {count}\n- Context anchors: {count}\n\\`\\`\\`\n\nKeep only the last 50 entries in the changelog file.\n\n{{/if}}\n---\n\n{{#if features.memory}}\n## Memory Update\n\nUpdate \\`.gardener/memory.md\\` with tend phase results:\n\n\\`\\`\\`markdown\n## Tend Phase\n- Enriched {count} notes, {remaining} in queue\n- Next enrichment candidates: {top 3 by priority score}\n- Journals generated: {list}\n- {observations about vault health for next run}\n## Vault Stats\n- Total notes: {count}\n- Seed notes: {count}\n- Orphan notes: {count}\n- Last full run: {date}\n\\`\\`\\`\n\nThis is the final phase â€” consolidate all memory sections into a clean file.\n\n---\n\n{{/if}}\n## Run Report\n\nAfter completing all steps, write a JSON file to \\`.gardener/run-report.json\\`:\n\n\\\\\\`\\\\\\`\\\\\\`json\n{\n  \"version\": 1,\n  \"timestamp\": \"{ISO-8601 timestamp}\",\n  \"phases\": [{\n    \"phase\": \"tend\",\n    \"started\": true,\n    \"features\": [\n      { \"feature\": \"{key}\", \"status\": \"executed|skipped|error\", \"counts\": { ... }, \"reason\": \"{if skipped/error}\" }\n    ]\n  }],\n  \"summary\": \"{1-2 sentence summary of what was done}\",\n  \"warnings\": []\n}\n\\\\\\`\\\\\\`\\\\\\`\n\nReport these features (only report enabled features listed here):\n{{#if features.memory}}- \\`memory\\` â€” counts: \\`{ \"read\": 0|1, \"updated\": 0|1 }\\`\n{{/if}}{{#if features.changelog}}- \\`changelog\\` â€” counts: \\`{ \"entries_written\": 0|1 }\\`\n{{/if}}{{#if features.persona}}- \\`persona\\` â€” counts: \\`{ \"applied\": 0|1 }\\`\n{{/if}}{{#if features.social_content}}- \\`social_content\\` â€” counts: \\`{ \"drafts_generated\": {n} }\\`\n{{/if}}{{#if features.belief_trajectory}}- \\`belief_trajectory\\` â€” counts: \\`{ \"trajectories_tracked\": {n} }\\`\n{{/if}}{{#if features.theme_detection}}- \\`theme_detection\\` â€” counts: \\`{ \"themes_detected\": {n} }\\`\n{{/if}}{{#if features.attention_allocation}}- \\`attention_allocation\\` â€” counts: \\`{ \"allocations_tracked\": {n} }\\`\n{{/if}}{{#if features.goal_tracking}}- \\`goal_tracking\\` â€” counts: \\`{ \"goals_tracked\": {n} }\\`\n{{/if}}{{#if features.seasonal_patterns}}- \\`seasonal_patterns\\` â€” counts: \\`{ \"patterns_found\": {n} }\\`\n{{/if}}{{#if features.adaptive_batch_sizing}}- \\`adaptive_batch_sizing\\` â€” counts: \\`{ \"adjusted\": 0|1 }\\`\n{{/if}}{{#if features.enrichment_priority}}- \\`enrichment_priority\\` â€” counts: \\`{ \"candidates_scored\": {n} }\\`\n{{/if}}{{#if features.context_anchoring}}- \\`context_anchoring\\` â€” counts: \\`{ \"anchors_added\": {n} }\\`\n{{/if}}{{#if features.auto_summary}}- \\`auto_summary\\` â€” counts: \\`{ \"summaries_added\": {n} }\\`\n{{/if}}{{#if features.question_tracker}}- \\`question_tracker\\` â€” counts: \\`{ \"questions_resolved\": {n}, \"questions_open\": {n} }\\`\n{{/if}}{{#if features.commitment_tracker}}- \\`commitment_tracker\\` â€” counts: \\`{ \"commitments_reviewed\": {n} }\\`\n{{/if}}\n\nAlso report core steps as features:\n- \\`stale_review\\` â€” counts: \\`{ \"flagged\": {n}, \"consolidated\": {n} }\\`\n- \\`organizer\\` â€” counts: \\`{ \"files_organized\": {n} }\\`\n- \\`journal_generation\\` â€” counts: \\`{ \"weekly\": {n}, \"monthly\": {n}, \"quarterly\": {n} }\\`\n- \\`enrichment\\` â€” counts: \\`{ \"notes_enriched\": {n}, \"remaining\": {n} }\\`\n\n**Rules:**\n- Report EVERY listed feature, even if skipped (use status \"skipped\" with a reason)\n- The \\`phase\\` field MUST be exactly one of: \\`\"seed\"\\`, \\`\"nurture\"\\`, or \\`\"tend\"\\` â€” no other values\n- Write valid JSON â€” no trailing commas, no comments\n- If \\`.gardener/run-report.json\\` already exists (multi-phase run), read it first and APPEND your phase to the \\`phases\\` array\n\n---\n\n## Output\n\nSummary:\n- **Stale review**: {flagged} notes flagged, {consolidated} journals consolidated\n- **Organization**: {organized} files organized into topic subfolders\n- **Journals**: {weekly} weekly, {monthly} monthly, {quarterly} quarterly generated\n- **Enrichment**: {enriched} notes enriched, {remaining} remaining in queue\n- **Summaries**: {count} TL;DR sections added to long notes\n- **Context**: {count} origin context sections added to sparse notes\n- **Social**: {count} draft posts generated for {{#each social_platforms}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}`,\n};\n\n// ---------------------------------------------------------------------------\n// Template accessor\n// ---------------------------------------------------------------------------\n\nfunction getTemplate(name: string): string {\n  const template = TEMPLATES[name];\n  if (!template) {\n    const available = Object.keys(TEMPLATES).join(', ');\n    throw new Error(`Unknown template \"${name}\". Available: ${available}`);\n  }\n  return template;\n}\n\n// ---------------------------------------------------------------------------\n// Compile cache â€” avoid recompiling the same template on repeated calls\n// ---------------------------------------------------------------------------\n\nconst compiled = new Map<string, HandlebarsTemplateDelegate>();\n\nfunction compile(name: string): HandlebarsTemplateDelegate {\n  let fn = compiled.get(name);\n  if (!fn) {\n    fn = Handlebars.compile(getTemplate(name), { noEscape: true });\n    compiled.set(name, fn);\n  }\n  return fn;\n}\n\n// ---------------------------------------------------------------------------\n// Public API\n// ---------------------------------------------------------------------------\n\n/** Phase prompt names (written to .gardener/prompts/{name}.md) */\nconst PHASE_NAMES = ['garden', 'seed', 'nurture', 'tend'] as const;\n\n/**\n * Render phase prompts (garden, seed, nurture, tend) to `{gardenerDir}/prompts/`.\n */\nexport async function renderPrompts(\n  gardenerDir: string,\n  config: GardenerConfig,\n): Promise<void> {\n  const promptsDir = join(gardenerDir, 'prompts');\n  await mkdir(promptsDir, { recursive: true });\n\n  await Promise.all(\n    PHASE_NAMES.map(async (name) => {\n      const render = compile(name);\n      const output = render(config);\n      await writeFile(join(promptsDir, `${name}.md`), output, 'utf-8');\n    }),\n  );\n}\n\n/**\n * Render the context file to `{gardenerDir}/context.md`.\n */\nexport async function renderContext(\n  gardenerDir: string,\n  config: GardenerConfig,\n): Promise<void> {\n  await mkdir(gardenerDir, { recursive: true });\n\n  const render = compile('context');\n  const output = render(config);\n  await writeFile(join(gardenerDir, 'context.md'), output, 'utf-8');\n}\n\n/**\n * Render all templates: context + phase prompts.\n */\nexport async function renderAll(\n  gardenerDir: string,\n  config: GardenerConfig,\n): Promise<void> {\n  await Promise.all([\n    renderContext(gardenerDir, config),\n    renderPrompts(gardenerDir, config),\n  ]);\n}\n","import { validate as cronValidate } from 'node-cron';\nimport type { ProviderName, Tier } from '../providers/types.js';\n\nexport interface JournalConfig {\n  style: {\n    weekly: 'structured' | 'narrative';\n    monthly: 'structured' | 'narrative';\n    quarterly: 'structured' | 'narrative';\n    yearly: 'structured' | 'narrative';\n  };\n  journal_subfolders: {\n    yearly: string;\n    quarterly: string;\n    monthly: string;\n    weekly: string;\n    daily: string;\n  };\n}\n\nexport interface ResilienceConfig {\n  queue_enabled: boolean;\n  queue_max_size: number;\n  queue_max_age_hours: number;\n  metrics_timeout_seconds: number;\n  metrics_max_files: number;\n  lock_heartbeat_interval_seconds: number;\n  lock_stale_threshold_seconds: number;\n  provider_kill_grace_seconds: number;\n  log_max_size_mb: number;\n  log_max_backups: number;\n  daemon_max_consecutive_failures: number;\n  vault_quiet_seconds: number;\n  preflight_enabled: boolean;\n}\n\nexport const DEFAULT_RESILIENCE: ResilienceConfig = {\n  queue_enabled: true,\n  queue_max_size: 10,\n  queue_max_age_hours: 24,\n  metrics_timeout_seconds: 30,\n  metrics_max_files: 50_000,\n  lock_heartbeat_interval_seconds: 30,\n  lock_stale_threshold_seconds: 300,\n  provider_kill_grace_seconds: 10,\n  log_max_size_mb: 10,\n  log_max_backups: 3,\n  daemon_max_consecutive_failures: 5,\n  vault_quiet_seconds: 30,\n  preflight_enabled: true,\n};\n\nexport interface FeaturesConfig {\n  memory: boolean;\n  entity_auto_linking: boolean;\n  question_tracker: boolean;\n  context_anchoring: boolean;\n  meeting_enhancement: boolean;\n  auto_summary: boolean;\n  backlink_context: boolean;\n  transitive_links: boolean;\n  co_mention_network: boolean;\n  belief_trajectory: boolean;\n  theme_detection: boolean;\n  attention_allocation: boolean;\n  knowledge_gaps: boolean;\n  seasonal_patterns: boolean;\n  goal_tracking: boolean;\n  commitment_tracker: boolean;\n  this_time_last_year: boolean;\n  tag_normalization: boolean;\n  persona: boolean;\n  changelog: boolean;\n  adaptive_batch_sizing: boolean;\n  enrichment_priority: boolean;\n  social_content: boolean;\n}\n\nexport const FEATURE_KEYS = Object.keys({\n  memory: true,\n  entity_auto_linking: true,\n  question_tracker: true,\n  context_anchoring: true,\n  meeting_enhancement: true,\n  auto_summary: true,\n  backlink_context: true,\n  transitive_links: true,\n  co_mention_network: true,\n  belief_trajectory: true,\n  theme_detection: true,\n  attention_allocation: true,\n  knowledge_gaps: true,\n  seasonal_patterns: true,\n  goal_tracking: true,\n  commitment_tracker: true,\n  this_time_last_year: true,\n  tag_normalization: true,\n  persona: true,\n  changelog: true,\n  adaptive_batch_sizing: true,\n  enrichment_priority: true,\n  social_content: true,\n} satisfies FeaturesConfig) as (keyof FeaturesConfig)[];\n\nexport const DEFAULT_FEATURES: FeaturesConfig = {\n  memory: true,\n  entity_auto_linking: true,\n  question_tracker: true,\n  context_anchoring: true,\n  meeting_enhancement: true,\n  auto_summary: true,\n  backlink_context: true,\n  transitive_links: true,\n  co_mention_network: true,\n  belief_trajectory: true,\n  theme_detection: true,\n  attention_allocation: true,\n  knowledge_gaps: true,\n  seasonal_patterns: true,\n  goal_tracking: true,\n  commitment_tracker: true,\n  this_time_last_year: true,\n  tag_normalization: true,\n  persona: true,\n  changelog: true,\n  adaptive_batch_sizing: true,\n  enrichment_priority: true,\n  social_content: true,\n};\n\nexport type Persona = 'analytical' | 'reflective' | 'coach';\n\nexport interface GardenerConfig {\n  version: number;\n  provider: ProviderName;\n  tier: Tier;\n  persona: Persona;\n  folders: Record<string, string>;\n  topics: Record<string, string[]>;\n  frontmatter: {\n    required: string[];\n    statuses: string[];\n    types: string[];\n  };\n  schedule: {\n    enabled: boolean;\n    cron: string;\n  };\n  auto_grow: Record<string, number>;\n  limits: Record<string, number>;\n  claude: { power_model: string; fast_model: string; timeout: number; max_turns: number };\n  codex: { power_model: string; fast_model: string; timeout: number };\n  gemini: { power_model: string; fast_model: string; timeout: number };\n  journal: JournalConfig;\n  social_platforms: string[];\n  protected: string[];\n  resilience: ResilienceConfig;\n  features: FeaturesConfig;\n}\n\nexport function validateConfig(\n  config: Partial<GardenerConfig>,\n): { valid: boolean; errors: string[]; warnings: string[] } {\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  const c = config as Record<string, unknown>;\n\n  // Required top-level keys\n  for (const key of ['version', 'provider', 'tier', 'folders']) {\n    if (c[key] == null) {\n      errors.push(`Missing required key: ${key}`);\n    }\n  }\n\n  // Provider validation\n  if (config.provider && !['claude', 'codex', 'gemini'].includes(config.provider)) {\n    errors.push(`Invalid provider \"${config.provider}\". Must be: claude, codex, gemini`);\n  }\n\n  // Persona validation\n  if (config.persona && !['analytical', 'reflective', 'coach'].includes(config.persona)) {\n    errors.push(`Invalid persona \"${config.persona}\". Must be: analytical, reflective, coach`);\n  }\n\n  // Tier validation\n  if (config.tier && !['power', 'fast'].includes(config.tier)) {\n    errors.push(`Invalid tier \"${config.tier}\". Must be: power, fast`);\n  }\n\n  // Folders validation\n  if (config.folders && typeof config.folders === 'object') {\n    if (!config.folders.inbox) {\n      errors.push('Missing required folder: inbox');\n    }\n  }\n\n  // Protected validation\n  if (config.protected != null && !Array.isArray(config.protected)) {\n    errors.push('protected must be an array');\n  }\n\n  // Limits validation\n  if (config.limits && typeof config.limits === 'object') {\n    for (const [key, val] of Object.entries(config.limits)) {\n      if (typeof val !== 'number' || val < 1 || !Number.isInteger(val)) {\n        warnings.push(`limits.${key} should be a positive integer (got ${val})`);\n      }\n    }\n  }\n\n  // Features validation\n  if (config.features && typeof config.features === 'object') {\n    for (const [key, val] of Object.entries(config.features)) {\n      if (typeof val !== 'boolean') {\n        warnings.push(`features.${key} should be a boolean (got ${typeof val})`);\n      }\n    }\n  }\n\n  // Schedule cron validation\n  if (config.schedule?.cron) {\n    if (!cronValidate(config.schedule.cron)) {\n      errors.push(`Invalid cron expression: \"${config.schedule.cron}\"`);\n    }\n  }\n\n  return { valid: errors.length === 0, errors, warnings };\n}\n\nexport function buildDefaultConfig(overrides: Partial<GardenerConfig> = {}): GardenerConfig {\n  return {\n    version: 1,\n    provider: 'claude',\n    tier: 'fast',\n    persona: 'reflective',\n    folders: {\n      inbox: '00-inbox',\n      journal: '01-journal',\n      projects: '02-projects',\n      roles: '03-roles',\n      resources: '04-resources',\n      people: '05-people',\n      orgs: '06-orgs',\n      playbooks: '07-playbooks',\n      sources: '08-sources',\n      mocs: '09-mocs',\n      archive: '99-archive',\n      templates: 'templates',\n    },\n    topics: {\n      ideas: ['ideas', 'concepts', 'brainstorm', 'innovation', 'creativity'],\n      finance: ['investing', 'portfolio', 'markets', 'stocks', 'economics', 'money', 'budget'],\n      learning: ['learning', 'education', 'courses', 'books', 'research', 'science'],\n      health: ['health', 'wellness', 'fitness', 'nutrition', 'sleep', 'exercise', 'mental-health'],\n      travel: ['travel', 'trips', 'destinations', 'itinerary', 'places'],\n    },\n    frontmatter: {\n      required: ['created', 'updated', 'tags', 'status', 'type'],\n      statuses: ['seed', 'growing', 'evergreen', 'archived', 'consolidated'],\n      types: ['journal', 'project', 'role', 'resource', 'person', 'org', 'meeting', 'idea', 'playbook', 'moc'],\n    },\n    schedule: {\n      enabled: false,\n      cron: '0 */4 * * *',\n    },\n    auto_grow: {\n      projects: 5,\n      roles: 3,\n      resources: 3,\n      people: 5,\n      orgs: 8,\n      playbooks: 5,\n      sources: 5,\n    },\n    limits: {\n      beliefs_per_run: 10,\n      playbooks_per_run: 2,\n      mocs_per_run: 2,\n      links_per_run: 10,\n      organize_per_run: 10,\n      enrich_per_run: 5,\n    },\n    claude: {\n      power_model: 'opus',\n      fast_model: 'sonnet',\n      timeout: 1500,\n      max_turns: 200,\n    },\n    codex: {\n      power_model: 'gpt-5.3-codex',\n      fast_model: 'gpt-5.3-codex-spark',\n      timeout: 1500,\n    },\n    gemini: {\n      power_model: 'gemini-3.1-pro-preview',\n      fast_model: 'gemini-3-flash-preview',\n      timeout: 1500,\n    },\n    journal: {\n      style: {\n        weekly: 'structured',\n        monthly: 'structured',\n        quarterly: 'structured',\n        yearly: 'structured',\n      },\n      journal_subfolders: {\n        yearly: 'yearly',\n        quarterly: 'quarterly',\n        monthly: 'monthly',\n        weekly: 'weekly',\n        daily: 'daily',\n      },\n    },\n    social_platforms: ['twitter', 'linkedin'],\n    protected: [\n      '.gardener',\n      '.obsidian',\n      '.logseq',\n      '.foam',\n      '.dendron',\n      '.vscode',\n      '.git',\n      'node_modules',\n      'templates',\n    ],\n    resilience: { ...DEFAULT_RESILIENCE },\n    features: { ...DEFAULT_FEATURES },\n    ...overrides,\n  };\n}\n","import { readFile, writeFile, mkdir, copyFile, rename } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport { parse, stringify } from 'yaml';\nimport chalk from 'chalk';\nimport { validateConfig, buildDefaultConfig, DEFAULT_RESILIENCE, DEFAULT_FEATURES } from './schema.js';\nimport type { GardenerConfig } from './schema.js';\n\nconst GARDENER_DIR = '.gardener';\nconst CONFIG_FILE = 'config.yaml';\n\nexport function getGardenerDir(cwd?: string): string {\n  return join(cwd ?? process.cwd(), GARDENER_DIR);\n}\n\nexport function getConfigPath(cwd?: string): string {\n  return join(getGardenerDir(cwd), CONFIG_FILE);\n}\n\n/** Deep merge: defaults as base, user config on top, merging nested objects */\nexport function deepMerge(defaults: Record<string, unknown>, user: Record<string, unknown>): Record<string, unknown> {\n  const result = { ...defaults };\n  for (const key of Object.keys(user)) {\n    if (\n      user[key] != null &&\n      typeof user[key] === 'object' &&\n      !Array.isArray(user[key]) &&\n      typeof defaults[key] === 'object' &&\n      !Array.isArray(defaults[key])\n    ) {\n      result[key] = deepMerge(defaults[key] as Record<string, unknown>, user[key] as Record<string, unknown>);\n    } else {\n      result[key] = user[key];\n    }\n  }\n  return result;\n}\n\nexport async function loadConfig(cwd?: string): Promise<GardenerConfig> {\n  const configPath = getConfigPath(cwd);\n  const bakPath = configPath + '.bak';\n\n  let raw: string;\n  let loadedFromBackup = false;\n  try {\n    raw = await readFile(configPath, 'utf-8');\n  } catch {\n    // Primary config missing â€” try backup\n    try {\n      raw = await readFile(bakPath, 'utf-8');\n      loadedFromBackup = true;\n      console.error(chalk.yellow('Config restored from .bak'));\n    } catch {\n      throw new Error('No config.yaml found');\n    }\n  }\n\n  let config: GardenerConfig;\n  try {\n    config = parse(raw) as GardenerConfig;\n  } catch {\n    // YAML parse failed â€” try backup\n    try {\n      const bakRaw = await readFile(bakPath, 'utf-8');\n      config = parse(bakRaw) as GardenerConfig;\n      loadedFromBackup = true;\n      console.error(chalk.yellow('Config corrupted â€” restored from .bak'));\n    } catch {\n      throw new Error('config.yaml is corrupted and no valid .bak available');\n    }\n  }\n\n  // Validate and auto-repair with deep merge\n  const { valid, errors, warnings } = validateConfig(config);\n  if (!valid) {\n    for (const err of errors) console.error(chalk.yellow(`[config auto-repair] ${err}`));\n    const defaults = buildDefaultConfig();\n    config = deepMerge(\n      defaults as unknown as Record<string, unknown>,\n      config as unknown as Record<string, unknown>,\n    ) as unknown as GardenerConfig;\n  }\n  for (const w of warnings) console.error(chalk.dim(`[config] ${w}`));\n\n  // Fill missing resilience fields with defaults\n  config.resilience = { ...DEFAULT_RESILIENCE, ...config.resilience };\n\n  // Fill missing feature flags with defaults\n  config.features = { ...DEFAULT_FEATURES, ...config.features };\n\n  // Restore primary config if loaded from backup\n  if (loadedFromBackup) {\n    await writeFile(configPath, stringify(config, { lineWidth: 0 }), 'utf-8').catch(() => {});\n  }\n\n  // Write backup\n  await copyFile(configPath, bakPath).catch(() => {});\n\n  return config;\n}\n\nexport async function saveConfig(config: GardenerConfig, cwd?: string): Promise<void> {\n  const gardenerDir = getGardenerDir(cwd);\n  await mkdir(gardenerDir, { recursive: true });\n  const configPath = getConfigPath(cwd);\n  const tmpPath = configPath + '.tmp';\n  const bakPath = configPath + '.bak';\n\n  // Atomic write: write to .tmp, rename into place\n  await writeFile(tmpPath, stringify(config, { lineWidth: 0 }), 'utf-8');\n  await rename(tmpPath, configPath);\n\n  // Write backup\n  await copyFile(configPath, bakPath).catch(() => {});\n}\n\nexport function resolveModel(config: GardenerConfig): string {\n  const providerConfig = config[config.provider];\n  return config.tier === 'power' ? providerConfig.power_model : providerConfig.fast_model;\n}\n\nexport function resolveTimeout(config: GardenerConfig): number {\n  return config[config.provider].timeout;\n}\n","export {\n  type GardenerConfig,\n  type JournalConfig,\n  type ResilienceConfig,\n  type FeaturesConfig,\n  DEFAULT_RESILIENCE,\n  DEFAULT_FEATURES,\n  FEATURE_KEYS,\n  validateConfig,\n  buildDefaultConfig,\n} from './schema.js';\n\nexport {\n  getGardenerDir,\n  getConfigPath,\n  loadConfig,\n  saveConfig,\n  resolveModel,\n  resolveTimeout,\n  deepMerge,\n} from './loader.js';\n","import { stringify } from 'yaml';\nimport chalk from 'chalk';\nimport {\n  loadConfig,\n  saveConfig,\n  getGardenerDir,\n  validateConfig,\n} from '../config/index.js';\n\n// Re-export config types and functions for backward compatibility\nexport {\n  type GardenerConfig,\n  type JournalConfig,\n  type ResilienceConfig,\n  DEFAULT_RESILIENCE,\n  validateConfig,\n  buildDefaultConfig,\n  getGardenerDir,\n  getConfigPath,\n  loadConfig,\n  saveConfig,\n  resolveModel,\n  resolveTimeout,\n  deepMerge,\n} from '../config/index.js';\n\n// Fields that should always be parsed as strings, never auto-cast\nconst STRING_FIELDS = new Set([\n  'provider', 'tier', 'schedule.cron',\n  'folders.inbox', 'folders.journal', 'folders.projects', 'folders.roles',\n  'folders.resources', 'folders.people', 'folders.orgs', 'folders.playbooks',\n  'folders.sources', 'folders.mocs', 'folders.archive', 'folders.templates',\n  'claude.power_model', 'claude.fast_model', 'codex.power_model', 'codex.fast_model',\n  'gemini.power_model', 'gemini.fast_model',\n]);\n\nfunction getNestedValue(obj: Record<string, unknown>, key: string): unknown {\n  const parts = key.split('.');\n  let current: unknown = obj;\n  for (const part of parts) {\n    if (current == null || typeof current !== 'object') return undefined;\n    current = (current as Record<string, unknown>)[part];\n  }\n  return current;\n}\n\nfunction setNestedValue(obj: Record<string, unknown>, key: string, value: unknown): void {\n  const parts = key.split('.');\n  let current: Record<string, unknown> = obj;\n  for (let i = 0; i < parts.length - 1; i++) {\n    if (current[parts[i]] == null || typeof current[parts[i]] !== 'object') {\n      current[parts[i]] = {};\n    }\n    current = current[parts[i]] as Record<string, unknown>;\n  }\n  current[parts[parts.length - 1]] = value;\n}\n\nexport async function configGet(key: string): Promise<void> {\n  try {\n    const config = await loadConfig();\n    const value = getNestedValue(config as unknown as Record<string, unknown>, key);\n    if (value === undefined) {\n      console.error(chalk.red(`Key \"${key}\" not found in config`));\n      process.exit(1);\n    }\n    if (typeof value === 'object') {\n      console.log(stringify(value));\n    } else {\n      console.log(String(value));\n    }\n  } catch {\n    console.error(chalk.red('No .gardener/config.yaml found. Run `vault-gardener init` first.'));\n    process.exit(1);\n  }\n}\n\nexport async function configSet(key: string, value: string): Promise<void> {\n  try {\n    const config = await loadConfig();\n\n    // Auto-parse booleans and numbers, but only for non-string fields\n    let parsed: unknown = value;\n    if (!STRING_FIELDS.has(key)) {\n      if (value === 'true') parsed = true;\n      else if (value === 'false') parsed = false;\n      else if (/^\\d+$/.test(value)) parsed = parseInt(value, 10);\n    }\n\n    setNestedValue(config as unknown as Record<string, unknown>, key, parsed);\n\n    // Validate after setting\n    const { valid, errors } = validateConfig(config);\n    if (!valid) {\n      for (const err of errors) {\n        console.error(chalk.red(`Validation error: ${err}`));\n      }\n      process.exit(1);\n    }\n\n    await saveConfig(config);\n    console.log(chalk.green(`Set ${key} = ${value}`));\n  } catch {\n    console.error(chalk.red('No .gardener/config.yaml found. Run `vault-gardener init` first.'));\n    process.exit(1);\n  }\n}\n\nexport async function configRegen(): Promise<void> {\n  try {\n    const config = await loadConfig();\n    const { renderAll } = await import('../prompts/render.js');\n    await renderAll(getGardenerDir(), config);\n    console.log(chalk.green('Prompts regenerated in .gardener/prompts/'));\n  } catch {\n    console.error(chalk.red('No .gardener/config.yaml found. Run `vault-gardener init` first.'));\n    process.exit(1);\n  }\n}\n","import { readFile, writeFile, rename, unlink } from 'node:fs/promises';\nimport { join } from 'node:path';\n\nexport interface QueueEntry {\n  phase: string;\n  provider: string;\n  tier: string;\n  queuedAt: string;\n  reason: string;\n}\n\nexport interface QueueConfig {\n  maxSize?: number;\n  maxAgeHours?: number;\n}\n\nconst QUEUE_FILE = 'queue.json';\nconst DEFAULT_MAX_SIZE = 10;\nconst DEFAULT_MAX_AGE_HOURS = 24;\n\nfunction queuePath(gardenerDir: string): string {\n  return join(gardenerDir, QUEUE_FILE);\n}\n\nfunction tmpPath(gardenerDir: string): string {\n  return join(gardenerDir, QUEUE_FILE + '.tmp');\n}\n\nasync function readQueue(gardenerDir: string): Promise<QueueEntry[]> {\n  try {\n    const raw = await readFile(queuePath(gardenerDir), 'utf-8');\n    return JSON.parse(raw) as QueueEntry[];\n  } catch {\n    return [];\n  }\n}\n\nasync function writeQueue(gardenerDir: string, entries: QueueEntry[]): Promise<void> {\n  const tmp = tmpPath(gardenerDir);\n  await writeFile(tmp, JSON.stringify(entries, null, 2), 'utf-8');\n  await rename(tmp, queuePath(gardenerDir));\n}\n\nfunction isStale(entry: QueueEntry, maxAgeHours: number): boolean {\n  const age = Date.now() - new Date(entry.queuedAt).getTime();\n  return age > maxAgeHours * 60 * 60 * 1000;\n}\n\nexport async function enqueue(\n  gardenerDir: string,\n  entry: QueueEntry,\n  config?: QueueConfig,\n): Promise<void> {\n  const maxSize = config?.maxSize ?? DEFAULT_MAX_SIZE;\n  const maxAgeHours = config?.maxAgeHours ?? DEFAULT_MAX_AGE_HOURS;\n\n  let entries = await readQueue(gardenerDir);\n\n  // Purge stale entries\n  entries = entries.filter((e) => !isStale(e, maxAgeHours));\n\n  entries.push(entry);\n\n  // Drop oldest if over max size\n  while (entries.length > maxSize) {\n    entries.shift();\n  }\n\n  await writeQueue(gardenerDir, entries);\n}\n\nexport async function dequeue(gardenerDir: string): Promise<QueueEntry | null> {\n  const entries = await readQueue(gardenerDir);\n  if (entries.length === 0) return null;\n\n  const first = entries.shift()!;\n  await writeQueue(gardenerDir, entries);\n  return first;\n}\n\nexport async function peekQueue(gardenerDir: string): Promise<QueueEntry | null> {\n  const entries = await readQueue(gardenerDir);\n  return entries[0] ?? null;\n}\n\nexport async function drainQueue(\n  gardenerDir: string,\n  runFn: (entry: QueueEntry) => Promise<void>,\n): Promise<void> {\n  let entry = await dequeue(gardenerDir);\n  while (entry) {\n    await runFn(entry);\n    entry = await dequeue(gardenerDir);\n  }\n}\n\nexport async function getQueueDepth(gardenerDir: string): Promise<number> {\n  const entries = await readQueue(gardenerDir);\n  return entries.length;\n}\n\nexport async function purgeStale(\n  gardenerDir: string,\n  maxAgeHours: number = DEFAULT_MAX_AGE_HOURS,\n): Promise<number> {\n  const entries = await readQueue(gardenerDir);\n  const fresh = entries.filter((e) => !isStale(e, maxAgeHours));\n  const purged = entries.length - fresh.length;\n\n  if (purged > 0) {\n    await writeQueue(gardenerDir, fresh);\n  }\n\n  return purged;\n}\n","import { readFile, writeFile, unlink, rename, open, constants } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport { hostname } from 'node:os';\nimport { enqueue } from '../queue/index.js';\nimport type { QueueEntry } from '../queue/index.js';\nimport type { Logger } from '../logging/index.js';\n\nexport interface LockInfo {\n  pid: number;\n  startedAt: string;\n  hostname: string;\n}\n\nexport interface LockHandle {\n  release(): Promise<void>;\n  startHeartbeat(): void;\n  stopHeartbeat(): void;\n}\n\nconst LOCK_FILE = '.lock';\nconst HEARTBEAT_FILE = '.lock-heartbeat';\nconst STALE_THRESHOLD_MS = 300_000; // 5 minutes\nconst HEARTBEAT_INTERVAL_MS = 30_000; // 30 seconds\nconst HEARTBEAT_STALE_MS = 90_000; // 90 seconds\n\nfunction lockPath(gardenerDir: string): string {\n  return join(gardenerDir, LOCK_FILE);\n}\n\nfunction heartbeatPath(gardenerDir: string): string {\n  return join(gardenerDir, HEARTBEAT_FILE);\n}\n\nexport function isPidAlive(pid: number): boolean {\n  try {\n    process.kill(pid, 0);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nasync function getHeartbeat(gardenerDir: string): Promise<{ pid: number; timestamp: string } | null> {\n  try {\n    const raw = await readFile(heartbeatPath(gardenerDir), 'utf-8');\n    return JSON.parse(raw);\n  } catch {\n    return null;\n  }\n}\n\nfunction isStale(info: LockInfo): boolean {\n  const age = Date.now() - new Date(info.startedAt).getTime();\n  return age > STALE_THRESHOLD_MS;\n}\n\nasync function isStaleWithHeartbeat(info: LockInfo, gardenerDir: string): Promise<boolean> {\n  if (!isPidAlive(info.pid)) return true;\n\n  const hb = await getHeartbeat(gardenerDir);\n  if (hb) {\n    const hbAge = Date.now() - new Date(hb.timestamp).getTime();\n    if (hbAge > HEARTBEAT_STALE_MS) return true;\n  }\n\n  // PID is alive â€” trust it even if heartbeat is missing or lock is old\n  return false;\n}\n\nasync function writeHeartbeat(gardenerDir: string): Promise<void> {\n  const data = JSON.stringify({ pid: process.pid, timestamp: new Date().toISOString() });\n  const tmpFile = heartbeatPath(gardenerDir) + '.tmp';\n  await writeFile(tmpFile, data, 'utf-8');\n  await rename(tmpFile, heartbeatPath(gardenerDir));\n}\n\nasync function removeFiles(gardenerDir: string): Promise<void> {\n  await unlink(lockPath(gardenerDir)).catch(() => {});\n  await unlink(heartbeatPath(gardenerDir)).catch(() => {});\n}\n\nexport async function acquireLock(gardenerDir: string, logger?: Logger): Promise<LockHandle> {\n  const path = lockPath(gardenerDir);\n  const info: LockInfo = {\n    pid: process.pid,\n    startedAt: new Date().toISOString(),\n    hostname: hostname(),\n  };\n\n  try {\n    // O_CREAT | O_EXCL = atomic create-if-not-exists (kernel-level)\n    const fd = await open(path, constants.O_CREAT | constants.O_EXCL | constants.O_WRONLY);\n    await fd.writeFile(JSON.stringify(info, null, 2), 'utf-8');\n    await fd.close();\n  } catch (err) {\n    if ((err as NodeJS.ErrnoException).code === 'EEXIST') {\n      // Lock file exists â€” check staleness\n      const existing = await getLockInfo(gardenerDir);\n      if (existing && await isStaleWithHeartbeat(existing, gardenerDir)) {\n        logger?.warn('lock.stale_removed', { context: { stalePid: existing.pid, staleHost: existing.hostname } });\n        await removeFiles(gardenerDir);\n        // Retry with exclusive create\n        return acquireLock(gardenerDir, logger);\n      }\n      throw new Error(`Gardener is already running (PID: ${existing?.pid})`);\n    }\n    throw err;\n  }\n\n  // Write initial heartbeat\n  await writeHeartbeat(gardenerDir);\n\n  let heartbeatTimer: ReturnType<typeof setInterval> | null = null;\n\n  const handle: LockHandle = {\n    startHeartbeat() {\n      if (heartbeatTimer) return;\n      heartbeatTimer = setInterval(() => {\n        writeHeartbeat(gardenerDir).catch(() => {});\n      }, HEARTBEAT_INTERVAL_MS);\n      heartbeatTimer.unref();\n    },\n\n    stopHeartbeat() {\n      if (heartbeatTimer) {\n        clearInterval(heartbeatTimer);\n        heartbeatTimer = null;\n      }\n    },\n\n    async release() {\n      handle.stopHeartbeat();\n      await removeFiles(gardenerDir);\n    },\n  };\n\n  return handle;\n}\n\nexport async function acquireOrQueue(\n  gardenerDir: string,\n  queueEntry: QueueEntry,\n  logger?: Logger,\n): Promise<LockHandle | null> {\n  try {\n    return await acquireLock(gardenerDir, logger);\n  } catch (err) {\n    if ((err as Error).message.startsWith('Gardener is already running')) {\n      logger?.info('lock.queued', { context: { phase: queueEntry.phase } });\n      await enqueue(gardenerDir, queueEntry);\n      return null;\n    }\n    throw err;\n  }\n}\n\nexport async function forceRelease(gardenerDir: string, logger?: Logger): Promise<void> {\n  logger?.warn('lock.force_release');\n  await removeFiles(gardenerDir);\n}\n\n/** @deprecated Use acquireLock() which returns a LockHandle */\nexport async function releaseLock(gardenerDir: string): Promise<void> {\n  const info = await getLockInfo(gardenerDir);\n  if (!info) return;\n\n  if (info.pid === process.pid) {\n    await removeFiles(gardenerDir);\n  }\n}\n\nexport async function isLocked(gardenerDir: string): Promise<boolean> {\n  const info = await getLockInfo(gardenerDir);\n  if (!info) return false;\n\n  return !(await isStaleWithHeartbeat(info, gardenerDir));\n}\n\nexport async function getLockInfo(gardenerDir: string): Promise<LockInfo | null> {\n  try {\n    const raw = await readFile(lockPath(gardenerDir), 'utf-8');\n    return JSON.parse(raw) as LockInfo;\n  } catch {\n    return null;\n  }\n}\n","import { appendFile, stat, rename, mkdir } from 'node:fs/promises';\nimport { join } from 'node:path';\n\nexport interface LogEntry {\n  timestamp: string;\n  level: 'info' | 'warn' | 'error' | 'fatal';\n  event: string;\n  phase?: string;\n  provider?: string;\n  model?: string;\n  duration_seconds?: number;\n  exitCode?: number;\n  error?: { message: string; code?: string; stack?: string };\n  context?: Record<string, unknown>;\n}\n\nexport interface Logger {\n  info(event: string, data?: Partial<LogEntry>): void;\n  warn(event: string, data?: Partial<LogEntry>): void;\n  error(event: string, data?: Partial<LogEntry>): void;\n  fatal(event: string, data?: Partial<LogEntry>): void;\n  flush(): Promise<void>;\n}\n\nconst DEFAULT_MAX_LOG_BYTES = 10 * 1024 * 1024; // 10 MB\nconst DEFAULT_MAX_BACKUPS = 3;\nconst LOG_DIR = 'logs';\nconst LOG_FILE = 'gardener.log';\n\nfunction buildEntry(level: LogEntry['level'], event: string, data?: Partial<LogEntry>): LogEntry {\n  return {\n    timestamp: new Date().toISOString(),\n    level,\n    event,\n    ...data,\n  };\n}\n\nasync function rotateIfNeeded(logPath: string, maxBytes: number, maxBackups: number): Promise<void> {\n  try {\n    const info = await stat(logPath);\n    if (info.size > maxBytes) {\n      // Shift existing backups: .2 -> .3, .1 -> .2, etc.\n      for (let i = maxBackups - 1; i >= 1; i--) {\n        await rename(`${logPath}.${i}`, `${logPath}.${i + 1}`).catch(() => {});\n      }\n      await rename(logPath, `${logPath}.1`);\n    }\n  } catch {\n    // file doesn't exist yet, nothing to rotate\n  }\n}\n\nexport async function createLogger(\n  gardenerDir: string,\n  opts?: { verbose?: boolean; maxLogBytes?: number; maxBackups?: number },\n): Promise<Logger> {\n  const logsDir = join(gardenerDir, LOG_DIR);\n  await mkdir(logsDir, { recursive: true });\n\n  const logPath = join(logsDir, LOG_FILE);\n  const maxBytes = opts?.maxLogBytes ?? DEFAULT_MAX_LOG_BYTES;\n  const maxBackups = opts?.maxBackups ?? DEFAULT_MAX_BACKUPS;\n  await rotateIfNeeded(logPath, maxBytes, maxBackups);\n\n  const verbose = opts?.verbose ?? false;\n\n  // Per-instance pending writes â€” each logger tracks its own\n  let pendingWrites: Promise<void>[] = [];\n\n  function writeLine(entry: LogEntry): void {\n    const line = JSON.stringify(entry) + '\\n';\n    const p = appendFile(logPath, line, 'utf-8').catch(() => {\n      try {\n        process.stderr.write(`[gardener] ${entry.level}: ${entry.event}\\n`);\n      } catch {\n        // last resort: silently discard\n      }\n    });\n    pendingWrites.push(p);\n    // Clean up resolved promises periodically\n    if (pendingWrites.length > 50) {\n      pendingWrites = pendingWrites.filter((pw) => {\n        let resolved = false;\n        pw.then(() => { resolved = true; });\n        return !resolved;\n      });\n    }\n  }\n\n  function log(level: LogEntry['level'], event: string, data?: Partial<LogEntry>): void {\n    const entry = buildEntry(level, event, data);\n\n    // Strip stack from non-verbose unless it's already absent\n    if (!verbose && entry.error?.stack) {\n      const { stack: _stack, ...rest } = entry.error;\n      entry.error = rest;\n    }\n\n    writeLine(entry);\n  }\n\n  return {\n    info: (event, data) => log('info', event, data),\n    warn: (event, data) => log('warn', event, data),\n    error: (event, data) => log('error', event, data),\n    fatal: (event, data) => log('fatal', event, data),\n    async flush() {\n      await Promise.all(pendingWrites);\n      pendingWrites = [];\n    },\n  };\n}\n","import { readFile, writeFile, readdir, mkdir, stat, rename } from 'node:fs/promises';\nimport { join, extname } from 'node:path';\nimport { execFile } from 'node:child_process';\nimport { promisify } from 'node:util';\nimport { performance } from 'node:perf_hooks';\n\nconst execFileAsync = promisify(execFile);\n\nexport interface PreMetrics {\n  timestamp: string;\n  inboxItems: number;\n  totalNotes: number;\n  seedNotes: number;\n  totalLinks: number;\n}\n\nexport interface PostMetrics extends PreMetrics {\n  inboxProcessed: number;\n  linksAdded: number;\n  notesMoved: number;\n}\n\nexport interface RunMetrics {\n  date: string;\n  timestamp: string;\n  phase: string;\n  provider: string;\n  tier: string;\n  model: string;\n  duration_seconds: number;\n  exitCode: number;\n  metrics: {\n    inbox_before: number;\n    inbox_after: number;\n    inbox_processed: number;\n    links_added: number;\n    notes_moved: number;\n  };\n  vault_health: {\n    total_notes: number;\n    inbox_items: number;\n    seed_notes: number;\n  };\n}\n\nexport interface WalkOptions {\n  maxFiles?: number;\n  timeout?: number;\n}\n\nexport interface WalkResult {\n  files: string[];\n  approximate: boolean;\n  timedOut: boolean;\n}\n\nconst SKIP_DIRS = new Set(['.git', '.obsidian', '.gardener', 'node_modules', '.trash']);\nconst DEFAULT_MAX_FILES = 50_000;\nconst MAX_FILE_SIZE = 1_048_576; // 1 MB\nconst COUNT_LINKS_TIMEOUT_MS = 30_000; // 30 seconds\nconst BATCH_SIZE = 100;\nconst SEED_DETECTION_TIMEOUT_MS = 30_000; // 30 seconds\n\n/** Recursively walk a directory and collect .md file paths. */\nasync function walkMd(dir: string, opts?: WalkOptions): Promise<WalkResult> {\n  const maxFiles = opts?.maxFiles ?? DEFAULT_MAX_FILES;\n  const timeoutMs = opts?.timeout;\n  const startTime = timeoutMs != null ? performance.now() : 0;\n  const results: string[] = [];\n  let approximate = false;\n  let timedOut = false;\n\n  async function walk(d: string): Promise<void> {\n    if (approximate || timedOut) return;\n\n    if (timeoutMs != null && performance.now() - startTime > timeoutMs) {\n      timedOut = true;\n      approximate = true;\n      return;\n    }\n\n    let entries;\n    try {\n      entries = await readdir(d, { withFileTypes: true });\n    } catch {\n      return; // individual dir failure doesn't kill walk\n    }\n\n    for (const entry of entries) {\n      if (approximate || timedOut) return;\n\n      if (entry.name.startsWith('.') || SKIP_DIRS.has(entry.name)) continue;\n\n      // Skip symlinks\n      if (entry.isSymbolicLink()) continue;\n\n      const full = join(d, entry.name);\n\n      if (entry.isDirectory()) {\n        await walk(full);\n      } else if (entry.isFile() && extname(entry.name) === '.md') {\n        results.push(full);\n        if (results.length >= maxFiles) {\n          approximate = true;\n          return;\n        }\n      }\n    }\n  }\n\n  await walk(dir);\n  return { files: results, approximate, timedOut };\n}\n\n/** Count .md files in a single directory (non-recursive). */\nexport async function countInbox(dir: string): Promise<number> {\n  try {\n    const entries = await readdir(dir, { withFileTypes: true });\n    return entries.filter((e) => e.isFile() && extname(e.name) === '.md').length;\n  } catch {\n    return 0;\n  }\n}\n\n/** Check if the first N lines of a file contain a pattern. */\nasync function matchesInHead(filePath: string, pattern: string, lines: number): Promise<boolean> {\n  try {\n    const info = await stat(filePath);\n    if (info.size > MAX_FILE_SIZE) return false;\n\n    const content = await readFile(filePath, 'utf-8');\n    const head = content.split('\\n').slice(0, lines).join('\\n');\n    return head.includes(pattern);\n  } catch {\n    return false;\n  }\n}\n\n/** Count WikiLink occurrences across all .md files. */\nasync function countLinks(files: string[], timeout?: number): Promise<number> {\n  const timeoutMs = timeout ?? COUNT_LINKS_TIMEOUT_MS;\n  const startTime = performance.now();\n  let total = 0;\n  const linkPattern = /\\[\\[/g;\n\n  for (let i = 0; i < files.length; i += BATCH_SIZE) {\n    if (performance.now() - startTime > timeoutMs) break;\n\n    const batch = files.slice(i, i + BATCH_SIZE);\n    const batchResults = await Promise.all(\n      batch.map(async (file) => {\n        try {\n          const info = await stat(file);\n          if (info.size > MAX_FILE_SIZE) return 0;\n\n          const content = await readFile(file, 'utf-8');\n          const matches = content.match(linkPattern);\n          return matches ? matches.length : 0;\n        } catch {\n          return 0;\n        }\n      }),\n    );\n    for (const count of batchResults) total += count;\n  }\n\n  return total;\n}\n\n/** Count notes moved via git rename detection. */\nasync function countMoved(cwd: string): Promise<number> {\n  try {\n    const { stdout } = await execFileAsync('git', ['diff', '--name-only', '--diff-filter=R'], {\n      cwd,\n    });\n    return stdout.trim().split('\\n').filter(Boolean).length;\n  } catch {\n    return 0;\n  }\n}\n\n/** Count seed notes in batches with a timeout. */\nasync function countSeeds(files: string[], timeout?: number): Promise<number> {\n  const timeoutMs = timeout ?? SEED_DETECTION_TIMEOUT_MS;\n  const startTime = performance.now();\n  let total = 0;\n\n  for (let i = 0; i < files.length; i += BATCH_SIZE) {\n    if (performance.now() - startTime > timeoutMs) break;\n\n    const batch = files.slice(i, i + BATCH_SIZE);\n    const results = await Promise.all(\n      batch.map((f) => matchesInHead(f, 'status: seed', 10)),\n    );\n    total += results.filter(Boolean).length;\n  }\n\n  return total;\n}\n\nexport async function collectPreMetrics(\n  vaultPath: string,\n  config: { folders: Record<string, string> },\n  opts?: WalkOptions,\n): Promise<PreMetrics> {\n  const inboxDir = join(vaultPath, config.folders.inbox ?? '00-inbox');\n  const walkResult = await walkMd(vaultPath, opts);\n\n  const seedCount = await countSeeds(walkResult.files);\n  const linkCount = await countLinks(walkResult.files);\n\n  return {\n    timestamp: new Date().toISOString(),\n    inboxItems: await countInbox(inboxDir),\n    totalNotes: walkResult.files.length,\n    seedNotes: seedCount,\n    totalLinks: linkCount,\n  };\n}\n\nexport async function collectPostMetrics(\n  vaultPath: string,\n  config: { folders: Record<string, string> },\n  pre: PreMetrics,\n  opts?: WalkOptions,\n): Promise<PostMetrics> {\n  const inboxDir = join(vaultPath, config.folders.inbox ?? '00-inbox');\n  const walkResult = await walkMd(vaultPath, opts);\n\n  const seedCount = await countSeeds(walkResult.files);\n  const linkCount = await countLinks(walkResult.files);\n  const inboxItems = await countInbox(inboxDir);\n  const notesMoved = await countMoved(vaultPath);\n\n  return {\n    timestamp: new Date().toISOString(),\n    inboxItems,\n    totalNotes: walkResult.files.length,\n    seedNotes: seedCount,\n    totalLinks: linkCount,\n    inboxProcessed: pre.inboxItems - inboxItems,\n    linksAdded: linkCount - pre.totalLinks,\n    notesMoved,\n  };\n}\n\nexport async function writeMetrics(gardenerDir: string, metrics: RunMetrics): Promise<void> {\n  const metricsDir = join(gardenerDir, 'metrics');\n  await mkdir(metricsDir, { recursive: true });\n\n  const filename = `${metrics.date}.json`;\n  const filePath = join(metricsDir, filename);\n\n  let runs: RunMetrics[] = [];\n\n  try {\n    const raw = await readFile(filePath, 'utf-8');\n    const parsed = JSON.parse(raw);\n    if (Array.isArray(parsed)) {\n      runs = parsed as RunMetrics[];\n    }\n  } catch {\n    // file doesn't exist or corrupt JSON â€” start fresh\n  }\n\n  runs.push(metrics);\n\n  // Atomic write: write to tmp, then rename\n  const tmpFile = filePath + '.tmp';\n  await writeFile(tmpFile, JSON.stringify(runs, null, 2), 'utf-8');\n  await rename(tmpFile, filePath);\n}\n\nexport async function readMetrics(gardenerDir: string, days?: number): Promise<RunMetrics[]> {\n  const metricsDir = join(gardenerDir, 'metrics');\n  let files: string[];\n\n  try {\n    const entries = await readdir(metricsDir);\n    files = entries.filter((f) => f.endsWith('.json')).sort();\n  } catch {\n    return [];\n  }\n\n  if (days && days > 0) {\n    const cutoff = new Date();\n    cutoff.setDate(cutoff.getDate() - days);\n    const cutoffStr = cutoff.toISOString().slice(0, 10);\n    files = files.filter((f) => f.replace('.json', '') >= cutoffStr);\n  }\n\n  const allRuns: RunMetrics[] = [];\n\n  for (const file of files) {\n    try {\n      const raw = await readFile(join(metricsDir, file), 'utf-8');\n      const runs = JSON.parse(raw) as RunMetrics[];\n      allRuns.push(...runs);\n    } catch {\n      // skip corrupted files\n    }\n  }\n\n  return allRuns.sort((a, b) => b.timestamp.localeCompare(a.timestamp));\n}\n","import { execFile } from 'node:child_process';\nimport { promisify } from 'node:util';\n\nconst execFileAsync = promisify(execFile);\n\n/**\n * Lightweight YAML frontmatter parser â€” extracts top-level key-value pairs\n * from a --- delimited block. Handles values containing colons (e.g. timestamps).\n */\nexport function parseFrontmatter(content: string): Record<string, string> {\n  const match = content.match(/^---\\n([\\s\\S]*?)\\n---/);\n  if (!match) return {};\n  const result: Record<string, string> = {};\n  for (const line of match[1].split('\\n')) {\n    // Match key: value where key has no leading whitespace (top-level only)\n    // Use first colon followed by space (or end of line) as the separator\n    // to correctly handle values containing colons like \"2026-03-15T00:00:00\"\n    const sepMatch = line.match(/^([a-zA-Z_-]+)\\s*:\\s*(.*)/);\n    if (sepMatch) {\n      result[sepMatch[1]] = sepMatch[2].trim();\n    }\n  }\n  return result;\n}\n\n/** Run a git command with a 5-second timeout, returning empty string on failure. */\nexport function gitCommand(cwd: string, args: string[]): Promise<string> {\n  return execFileAsync('git', args, { cwd, timeout: 5000 })\n    .then(r => r.stdout.trim())\n    .catch(() => '');\n}\n","import { readdir, readFile, stat } from 'node:fs/promises';\nimport { join, extname } from 'node:path';\nimport { parseFrontmatter } from './utils.js';\n\ninterface SuggestionOptions {\n  vaultPath: string;\n  folders: Record<string, string>;\n}\n\n/**\n * Scan vault for actionable suggestions:\n * 1. Old inbox items (>7 days by mtime)\n * 2. Stale growing notes (>30 days since `updated` frontmatter)\n * 3. Approaching deadlines (<14 days from `deadline` frontmatter)\n */\nexport async function generateSuggestions(opts: SuggestionOptions): Promise<string[]> {\n  const suggestions: string[] = [];\n  const { vaultPath, folders } = opts;\n\n  // 1. Old inbox items\n  try {\n    const inboxPath = join(vaultPath, folders.inbox ?? '00-inbox');\n    const entries = await readdir(inboxPath, { withFileTypes: true });\n    const mdFiles = entries.filter(e => e.isFile() && extname(e.name) === '.md');\n    const now = Date.now();\n    let oldCount = 0;\n\n    for (const file of mdFiles) {\n      try {\n        const s = await stat(join(inboxPath, file.name));\n        if ((now - s.mtimeMs) / (1000 * 60 * 60 * 24) > 7) oldCount++;\n      } catch { continue; }\n    }\n\n    if (oldCount > 0) {\n      suggestions.push(`${oldCount} item${oldCount > 1 ? 's have' : ' has'} been in inbox for over 7 days`);\n    }\n  } catch { /* inbox doesn't exist */ }\n\n  // 2. Stale growing notes\n  const growingFolders = ['projects', 'roles', 'resources']\n    .map(k => folders[k])\n    .filter((v): v is string => typeof v === 'string' && v.length > 0);\n  let staleGrowing = 0;\n\n  for (const folder of growingFolders) {\n    try {\n      const folderPath = join(vaultPath, folder);\n      const entries = await readdir(folderPath, { recursive: true });\n      const mdFiles = (entries as string[]).filter(e => e.endsWith('.md'));\n\n      for (const file of mdFiles.slice(0, 50)) {\n        try {\n          const content = await readFile(join(folderPath, file), 'utf-8');\n          const fm = parseFrontmatter(content);\n          if (fm.status !== 'growing') continue;\n          const updated = fm.updated ? new Date(fm.updated) : null;\n          if (updated && (Date.now() - updated.getTime()) / (1000 * 60 * 60 * 24) > 30) {\n            staleGrowing++;\n          }\n        } catch { continue; }\n      }\n    } catch { continue; }\n  }\n\n  if (staleGrowing > 0) {\n    suggestions.push(`${staleGrowing} growing note${staleGrowing > 1 ? 's haven\\'t' : ' hasn\\'t'} been updated in 30+ days`);\n  }\n\n  // 3. Approaching deadlines\n  try {\n    const projectsPath = join(vaultPath, folders.projects ?? '02-projects');\n    const entries = await readdir(projectsPath, { recursive: true });\n    const mdFiles = (entries as string[]).filter(e => e.endsWith('.md'));\n    let approachingCount = 0;\n\n    for (const file of mdFiles) {\n      try {\n        const content = await readFile(join(projectsPath, file), 'utf-8');\n        const fm = parseFrontmatter(content);\n        if (!fm.deadline || fm.status === 'archived') continue;\n        const deadline = new Date(fm.deadline);\n        const daysLeft = (deadline.getTime() - Date.now()) / (1000 * 60 * 60 * 24);\n        if (daysLeft > 0 && daysLeft <= 14) approachingCount++;\n      } catch { continue; }\n    }\n\n    if (approachingCount > 0) {\n      suggestions.push(`${approachingCount} project${approachingCount > 1 ? 's have' : ' has'} deadline${approachingCount > 1 ? 's' : ''} in the next 14 days`);\n    }\n  } catch { /* no projects folder */ }\n\n  return suggestions;\n}\n","import { readdir, readFile } from 'node:fs/promises';\nimport { join, basename } from 'node:path';\nimport { parseFrontmatter, gitCommand } from './utils.js';\n\nexport interface WeeklyBrief {\n  vaultGrowth: number;\n  mostActiveAreas: string[];\n  approachingDeadlines: { title: string; deadline: string; daysLeft: number }[];\n  archiveSuggestions: string[];\n}\n\ninterface WeeklyBriefOptions {\n  vaultPath: string;\n  folders: Record<string, string>;\n}\n\nexport async function generateWeeklyBrief(opts: WeeklyBriefOptions): Promise<WeeklyBrief> {\n  const { vaultPath, folders } = opts;\n\n  // Count notes created this week via git (deduplicate by path)\n  const weekAgo = await gitCommand(vaultPath, ['log', '--since=7 days ago', '--diff-filter=A', '--name-only', '--format=', '--', '*.md']);\n  const newNotes = [...new Set(weekAgo.split('\\n').filter(Boolean))];\n\n  // Most active areas by commits per folder\n  const weekChanges = await gitCommand(vaultPath, ['log', '--since=7 days ago', '--name-only', '--format=', '--', '*.md']);\n  const areaActivity: Record<string, number> = {};\n  for (const line of weekChanges.split('\\n').filter(Boolean)) {\n    const folder = line.split('/')[0];\n    if (folder) areaActivity[folder] = (areaActivity[folder] || 0) + 1;\n  }\n  const mostActiveAreas = Object.entries(areaActivity)\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 3)\n    .map(([folder]) => folder);\n\n  // Approaching deadlines\n  const approachingDeadlines: WeeklyBrief['approachingDeadlines'] = [];\n  try {\n    const projectsPath = join(vaultPath, folders.projects ?? '02-projects');\n    const entries = await readdir(projectsPath, { recursive: true });\n    const mdFiles = (entries as string[]).filter(e => e.endsWith('.md'));\n\n    for (const file of mdFiles) {\n      try {\n        const content = await readFile(join(projectsPath, file), 'utf-8');\n        const fm = parseFrontmatter(content);\n        if (!fm.deadline || fm.status === 'archived') continue;\n        const deadline = new Date(fm.deadline);\n        const daysLeft = Math.ceil((deadline.getTime() - Date.now()) / (1000 * 60 * 60 * 24));\n        if (daysLeft > 0 && daysLeft <= 14) {\n          approachingDeadlines.push({\n            title: basename(file, '.md'),\n            deadline: fm.deadline,\n            daysLeft,\n          });\n        }\n      } catch { continue; }\n    }\n  } catch { /* no projects folder */ }\n  approachingDeadlines.sort((a, b) => a.daysLeft - b.daysLeft);\n\n  // Archive suggestions: seed notes >30 days\n  const archiveSuggestions: string[] = [];\n  const archiveFolders = ['projects', 'resources']\n    .map(k => folders[k])\n    .filter((v): v is string => typeof v === 'string' && v.length > 0);\n  for (const folder of archiveFolders) {\n    try {\n      const folderPath = join(vaultPath, folder);\n      const entries = await readdir(folderPath, { recursive: true });\n      for (const file of (entries as string[]).filter(e => e.endsWith('.md')).slice(0, 50)) {\n        try {\n          const content = await readFile(join(folderPath, file), 'utf-8');\n          const fm = parseFrontmatter(content);\n          if (fm.status !== 'seed') continue;\n          const created = fm.created ? new Date(fm.created) : null;\n          if (created && (Date.now() - created.getTime()) / (1000 * 60 * 60 * 24) > 30) {\n            archiveSuggestions.push(basename(file, '.md'));\n          }\n        } catch { continue; }\n      }\n    } catch { continue; }\n  }\n\n  return {\n    vaultGrowth: newNotes.length,\n    mostActiveAreas,\n    approachingDeadlines: approachingDeadlines.slice(0, 5),\n    archiveSuggestions: archiveSuggestions.slice(0, 5),\n  };\n}\n","import { basename } from 'node:path';\nimport { gitCommand } from './utils.js';\n\nexport interface EnrichedNote {\n  name: string;\n  path: string;\n}\n\nexport interface MovedNote {\n  name: string;\n  fromPath: string;\n  toPath: string;\n}\n\nexport interface ActivityData {\n  inboxProcessed: number;\n  linksCreated: number;\n  notesEnriched: EnrichedNote[];\n  notesMoved: MovedNote[];\n}\n\n/**\n * Analyze recent gardener activity from git history.\n * Looks at commits in the last 24 hours to find enriched/moved notes and link counts.\n */\nexport async function analyzeActivity(vaultPath: string): Promise<ActivityData> {\n  // Recently changed .md files (enriched) â€” use --name-only for clean paths\n  const recentNames = await gitCommand(vaultPath, [\n    'log', '--since=24 hours ago', '--author=gardener',\n    '--name-only', '--format=', '--', '*.md',\n  ]);\n  const notesEnriched = parseChangedNotes(recentNames);\n\n  // Moved notes (git rename detection)\n  const notesMoved = await parseMoved(vaultPath);\n\n  // Count WikiLinks added in diffs\n  const recentDiff = await gitCommand(vaultPath, [\n    'log', '--since=24 hours ago', '--author=gardener',\n    '-p', '--', '*.md',\n  ]);\n  const linksCreated = countLinksInDiff(recentDiff);\n\n  return {\n    inboxProcessed: 0, // filled by caller from metrics\n    linksCreated,\n    notesEnriched,\n    notesMoved,\n  };\n}\n\n/** Parse --name-only output into enriched notes list (no rename arrows). */\nfunction parseChangedNotes(nameOutput: string): EnrichedNote[] {\n  if (!nameOutput) return [];\n  const seen = new Set<string>();\n  return nameOutput\n    .split('\\n')\n    .filter(line => line.endsWith('.md'))\n    .map(line => {\n      const fullPath = line.trim().replace(/\\.md$/, '');\n      if (!fullPath || seen.has(fullPath)) return null;\n      seen.add(fullPath);\n      return { name: basename(fullPath), path: fullPath };\n    })\n    .filter((n): n is EnrichedNote => n !== null)\n    .slice(0, 10);\n}\n\nasync function parseMoved(vaultPath: string): Promise<MovedNote[]> {\n  const output = await gitCommand(vaultPath, [\n    'log', '--since=24 hours ago', '--author=gardener',\n    '--name-status', '--diff-filter=R', '--format=', '--', '*.md',\n  ]);\n  if (!output) return [];\n\n  return output\n    .split('\\n')\n    .filter(line => line.startsWith('R'))\n    .map(line => {\n      const parts = line.split('\\t');\n      if (parts.length < 3) return null;\n      const fromPath = parts[1].replace(/\\.md$/, '');\n      const toPath = parts[2].replace(/\\.md$/, '');\n      return { name: basename(toPath), fromPath, toPath };\n    })\n    .filter((n): n is MovedNote => n !== null)\n    .slice(0, 10);\n}\n\nfunction countLinksInDiff(diffOutput: string): number {\n  const linkPattern = /\\[\\[.+?\\]\\]/g;\n  let count = 0;\n  for (const line of diffOutput.split('\\n')) {\n    if (line.startsWith('+') && !line.startsWith('+++')) {\n      const matches = line.match(linkPattern);\n      if (matches) count += matches.length;\n    }\n  }\n  return count;\n}\n","import { readFile, writeFile, mkdir } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport chalk from 'chalk';\nimport { loadConfig, getGardenerDir } from './config.js';\nimport { readMetrics, countInbox } from '../metrics/collector.js';\nimport { generateSuggestions } from '../analysis/suggestions.js';\nimport { generateWeeklyBrief } from '../analysis/weekly-brief.js';\nimport { analyzeActivity } from '../analysis/activity.js';\nimport type { WeeklyBrief } from '../analysis/weekly-brief.js';\nimport type { ActivityData, EnrichedNote, MovedNote } from '../analysis/activity.js';\n\nexport interface VaultDigest {\n  generated: string;\n  summary: string;\n  lastRun: {\n    timestamp: string;\n    status: 'completed' | 'error' | 'skipped';\n    phase: string;\n    duration: number;\n    provider: string;\n  } | null;\n  activity: {\n    inboxProcessed: number;\n    linksCreated: number;\n    notesEnriched: EnrichedNote[];\n    notesMoved: MovedNote[];\n  };\n  suggestions: string[];\n  weeklyBrief?: WeeklyBrief;\n}\n\ninterface DigestOptions {\n  json?: boolean;\n  weekly?: boolean;\n}\n\nexport async function digestCommand(options: DigestOptions): Promise<void> {\n  const cwd = process.cwd();\n  const digest = await generateDigest(cwd, { ...options, writeToDisk: true });\n\n  if (options.json) {\n    console.log(JSON.stringify(digest, null, 2));\n  } else {\n    printDigest(digest);\n  }\n}\n\nexport async function generateDigest(\n  vaultPath: string,\n  options: { weekly?: boolean; writeToDisk?: boolean } = {},\n): Promise<VaultDigest> {\n  const gardenerDir = getGardenerDir(vaultPath);\n\n  let config;\n  try {\n    config = await loadConfig(vaultPath);\n  } catch {\n    // No config -- use defaults\n    config = { folders: { inbox: '00-inbox', projects: '02-projects', roles: '03-roles', resources: '04-resources' } };\n  }\n\n  // Read latest metrics\n  const metrics = await readMetrics(gardenerDir, 7);\n  const latest = metrics[0] ?? null;\n\n  // Build lastRun from metrics\n  const lastRun = latest\n    ? {\n        timestamp: latest.timestamp,\n        status: (latest.exitCode === 0 ? 'completed' : 'error') as 'completed' | 'error' | 'skipped',\n        phase: latest.phase,\n        duration: latest.duration_seconds,\n        provider: latest.provider,\n      }\n    : null;\n\n  // Analyze recent activity from git\n  const activity = await analyzeActivity(vaultPath);\n  if (latest) {\n    activity.inboxProcessed = latest.metrics.inbox_processed;\n  }\n\n  // Generate suggestions\n  const suggestions = await generateSuggestions({\n    vaultPath,\n    folders: config.folders,\n  });\n\n  // Build summary\n  const summaryParts: string[] = [];\n  if (activity.inboxProcessed > 0) summaryParts.push(`${activity.inboxProcessed} inbox items processed`);\n  if (activity.linksCreated > 0) summaryParts.push(`${activity.linksCreated} WikiLinks created`);\n  if (activity.notesEnriched.length > 0) summaryParts.push(`${activity.notesEnriched.length} notes enriched`);\n\n  const inboxCount = await countInbox(join(vaultPath, config.folders.inbox ?? '00-inbox'));\n  if (inboxCount > 0) summaryParts.push(`${inboxCount} item${inboxCount !== 1 ? 's' : ''} in inbox`);\n\n  const summary = summaryParts.length > 0 ? summaryParts.join(', ') : 'No recent gardener activity';\n\n  const digest: VaultDigest = {\n    generated: new Date().toISOString(),\n    summary,\n    lastRun,\n    activity,\n    suggestions,\n  };\n\n  // Include weekly brief if requested or if it's Sunday\n  const includeWeekly = options.weekly ?? new Date().getDay() === 0;\n  if (includeWeekly) {\n    digest.weeklyBrief = await generateWeeklyBrief({\n      vaultPath,\n      folders: config.folders,\n    });\n  }\n\n  // Write digest.json (only when explicitly requested or from post-run hook)\n  if (options.writeToDisk !== false) {\n    const digestPath = join(gardenerDir, 'digest.json');\n    await mkdir(gardenerDir, { recursive: true });\n    await writeFile(digestPath, JSON.stringify(digest, null, 2), 'utf-8');\n  }\n\n  return digest;\n}\n\nfunction printDigest(digest: VaultDigest): void {\n  console.log(chalk.bold('\\nvault-gardener digest\\n'));\n  console.log(chalk.cyan('Summary'));\n  console.log(`  ${digest.summary}`);\n\n  if (digest.lastRun) {\n    console.log(chalk.cyan('\\nLast Run'));\n    console.log(`  Phase: ${digest.lastRun.phase}`);\n    console.log(`  Status: ${digest.lastRun.status === 'completed' ? chalk.green('completed') : chalk.red(digest.lastRun.status)}`);\n    console.log(`  Duration: ${digest.lastRun.duration}s`);\n    console.log(`  Provider: ${digest.lastRun.provider}`);\n    console.log(`  Time: ${digest.lastRun.timestamp}`);\n  }\n\n  if (digest.suggestions.length > 0) {\n    console.log(chalk.cyan('\\nSuggestions'));\n    for (const s of digest.suggestions) {\n      console.log(`  ${chalk.yellow('!')} ${s}`);\n    }\n  }\n\n  if (digest.weeklyBrief) {\n    const wb = digest.weeklyBrief;\n    console.log(chalk.cyan('\\nWeekly Brief'));\n    console.log(`  New notes: ${wb.vaultGrowth}`);\n    if (wb.mostActiveAreas.length > 0) console.log(`  Active areas: ${wb.mostActiveAreas.join(', ')}`);\n    if (wb.approachingDeadlines.length > 0) {\n      console.log(`  Deadlines:`);\n      for (const d of wb.approachingDeadlines) {\n        console.log(`    ${d.title} -- ${d.daysLeft}d left`);\n      }\n    }\n    if (wb.archiveSuggestions.length > 0) {\n      console.log(`  Consider archiving: ${wb.archiveSuggestions.join(', ')}`);\n    }\n  }\n\n  console.log('');\n}\n","import { readFile, readdir, rename, rm, stat, unlink, access } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport { execFileSync } from 'node:child_process';\nimport chalk from 'chalk';\nimport { createLogger } from '../logging/index.js';\nimport { purgeStale } from '../queue/index.js';\nimport { isPidAlive } from '../lock/index.js';\nimport { getGardenerDir } from './config.js';\n\nexport async function recoverCommand(): Promise<void> {\n  const cwd = process.cwd();\n  const gardenerDir = getGardenerDir(cwd);\n  const logger = await createLogger(gardenerDir);\n\n  let fixed = 0;\n  let reported = 0;\n\n  console.log(chalk.bold('\\nvault-gardener recover\\n'));\n\n  // 1. Stale .lock file\n  const lockFile = join(gardenerDir, '.lock');\n  try {\n    const raw = await readFile(lockFile, 'utf-8');\n    let lockData: { pid?: number };\n    try {\n      lockData = JSON.parse(raw);\n    } catch {\n      // Orphan .lock with no valid JSON\n      await unlink(lockFile);\n      console.log(chalk.green('  [FIXED] Removed orphan .lock (invalid JSON)'));\n      logger.info('recover.orphan_lock_removed');\n      fixed++;\n      lockData = {};\n    }\n\n    if (lockData.pid != null) {\n      if (!isPidAlive(lockData.pid)) {\n        await unlink(lockFile);\n        console.log(chalk.green(`  [FIXED] Removed stale .lock (PID ${lockData.pid} dead)`));\n        logger.info('recover.stale_lock_removed', { context: { pid: lockData.pid } });\n        fixed++;\n      } else {\n        console.log(chalk.yellow(`  [REPORT] .lock held by PID ${lockData.pid} (alive)`));\n        reported++;\n      }\n    }\n  } catch {\n    // No lock file â€” fine\n  }\n\n  // 2. Stale .lock-heartbeat\n  const heartbeatFile = join(gardenerDir, '.lock-heartbeat');\n  try {\n    await access(heartbeatFile);\n    // If no lock exists, heartbeat is orphan\n    try {\n      await access(lockFile);\n    } catch {\n      await unlink(heartbeatFile);\n      console.log(chalk.green('  [FIXED] Removed orphan .lock-heartbeat'));\n      logger.info('recover.orphan_heartbeat_removed');\n      fixed++;\n    }\n  } catch {\n    // No heartbeat file â€” fine\n  }\n\n  // 3. Staged-but-uncommitted git changes\n  try {\n    const staged = execFileSync('git', ['diff', '--cached', '--name-only'], {\n      cwd,\n      encoding: 'utf-8',\n      stdio: ['ignore', 'pipe', 'pipe'],\n    });\n    if (staged.trim()) {\n      const files = staged.trim().split('\\n');\n      console.log(chalk.yellow(`  [REPORT] ${files.length} staged-but-uncommitted file(s)`));\n      for (const f of files.slice(0, 5)) {\n        console.log(chalk.dim(`           ${f}`));\n      }\n      if (files.length > 5) console.log(chalk.dim(`           ... and ${files.length - 5} more`));\n      reported++;\n    }\n  } catch {\n    // Not a git repo or git unavailable\n  }\n\n  // 4. Orphan .gardener.tmp/\n  const tmpDir = join(gardenerDir, '.gardener.tmp');\n  try {\n    const info = await stat(tmpDir);\n    if (info.isDirectory()) {\n      await rm(tmpDir, { recursive: true, force: true });\n      console.log(chalk.green('  [FIXED] Removed orphan .gardener.tmp/'));\n      logger.info('recover.orphan_tmp_removed');\n      fixed++;\n    }\n  } catch {\n    // No tmp dir â€” fine\n  }\n\n  // 5. Stale queue entries > 24h\n  try {\n    const purged = await purgeStale(gardenerDir, 24);\n    if (purged > 0) {\n      console.log(chalk.green(`  [FIXED] Purged ${purged} stale queue entry(ies) (>24h)`));\n      logger.info('recover.stale_queue_purged', { context: { purged } });\n      fixed++;\n    }\n  } catch {\n    // Queue file may not exist\n  }\n\n  // 6. Corrupted metrics JSON\n  const metricsDir = join(gardenerDir, 'metrics');\n  try {\n    const files = await readdir(metricsDir);\n    for (const file of files) {\n      if (!file.endsWith('.json')) continue;\n      const filePath = join(metricsDir, file);\n      try {\n        const raw = await readFile(filePath, 'utf-8');\n        JSON.parse(raw);\n      } catch {\n        const corruptPath = filePath + '.corrupt';\n        await rename(filePath, corruptPath);\n        console.log(chalk.green(`  [FIXED] Renamed corrupted metrics: ${file} â†’ ${file}.corrupt`));\n        logger.info('recover.corrupt_metrics', { context: { file } });\n        fixed++;\n      }\n    }\n  } catch {\n    // No metrics dir\n  }\n\n  // Summary\n  console.log('');\n  if (fixed === 0 && reported === 0) {\n    console.log(chalk.green('All clear â€” no issues found.'));\n  } else {\n    console.log(chalk.dim(`Fixed: ${fixed}  Reported: ${reported}`));\n  }\n}\n","import { createRequire } from 'node:module';\nimport { Command } from 'commander';\nimport { initCommand } from './init.js';\nimport { runCommand } from './run.js';\nimport { startCommand } from './start.js';\nimport { stopCommand } from './stop.js';\nimport { statusCommand } from './status.js';\n\nconst require = createRequire(import.meta.url);\nconst { version } = require('../../package.json');\n\nexport function run(argv: string[]): void {\n  const program = new Command();\n\n  program\n    .name('vault-gardener')\n    .description('AI-powered vault maintenance pipeline for markdown knowledge bases')\n    .version(version);\n\n  program\n    .command('init')\n    .description('Interactive setup â€” detect vault structure, pick provider, generate config')\n    .option('--preset <name>', 'Use a preset (para-plus, zettelkasten, flat)')\n    .option('--provider <name>', 'Set provider (claude, codex, gemini)')\n    .option('--tier <tier>', 'Set tier (power, fast)')\n    .option('--no-interactive', 'Skip interactive prompts, use defaults')\n    .action(initCommand);\n\n  program\n    .command('run')\n    .description('Run gardener pipeline')\n    .argument('[phase]', 'Phase to run: seed, nurture, tend, or all (default: all)')\n    .option('--provider <name>', 'Override config provider')\n    .option('--tier <tier>', 'Override tier (power, fast)')\n    .option('--dry-run', 'Show what would run without executing')\n    .option('--verbose', 'Stream LLM output to terminal')\n    .option('--force-unlock', 'Force-release lock before running')\n    .option('--no-queue', 'Fail immediately if locked (do not queue)')\n    .option('--force', 'Skip preflight checks')\n    .option('--validate', 'Run preflight only, then exit')\n    .action(runCommand);\n\n  program\n    .command('start')\n    .description('Start background daemon')\n    .option('--install', 'Install as system service (launchd/systemd)')\n    .action(startCommand);\n\n  program\n    .command('stop')\n    .description('Stop background daemon')\n    .action(stopCommand);\n\n  program\n    .command('status')\n    .description('Show TUI dashboard with run history and vault health')\n    .option('--json', 'Output as JSON instead of TUI')\n    .action(statusCommand);\n\n  program\n    .command('digest')\n    .description('Generate vault health digest and write .gardener/digest.json')\n    .option('--json', 'Output as JSON')\n    .option('--weekly', 'Include weekly brief')\n    .action(digestAction);\n\n  program\n    .command('recover')\n    .description('Diagnose and fix stale state (locks, queue, metrics)')\n    .action(recoverAction);\n\n  const config = program\n    .command('config')\n    .description('Manage configuration');\n\n  config\n    .command('get')\n    .description('Read a config value')\n    .argument('<key>', 'Config key (dot notation: provider, tier, folders.inbox)')\n    .action(configGetAction);\n\n  config\n    .command('set')\n    .description('Write a config value')\n    .argument('<key>', 'Config key')\n    .argument('<value>', 'Config value')\n    .action(configSetAction);\n\n  config\n    .command('regen')\n    .description('Regenerate prompts from config (overwrites .gardener/prompts/)')\n    .action(configRegenAction);\n\n  program.parse(argv);\n}\n\nasync function configGetAction(key: string): Promise<void> {\n  const { configGet } = await import('./config.js');\n  await configGet(key);\n}\n\nasync function configSetAction(key: string, value: string): Promise<void> {\n  const { configSet } = await import('./config.js');\n  await configSet(key, value);\n}\n\nasync function configRegenAction(): Promise<void> {\n  const { configRegen } = await import('./config.js');\n  await configRegen();\n}\n\nasync function digestAction(options: { json?: boolean; weekly?: boolean }): Promise<void> {\n  const { digestCommand } = await import('./digest.js');\n  await digestCommand(options);\n}\n\nasync function recoverAction(): Promise<void> {\n  const { recoverCommand } = await import('./recover.js');\n  await recoverCommand();\n}\n","import { mkdir, access, writeFile } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport { createInterface, type Interface } from 'node:readline';\nimport chalk from 'chalk';\nimport { scanVault } from '../scanner/detect.js';\nimport { getPreset, listPresets } from '../scanner/presets.js';\nimport { detectProviders } from '../providers/detect.js';\nimport { renderAll } from '../prompts/render.js';\nimport {\n  buildDefaultConfig,\n  saveConfig,\n  getGardenerDir,\n  type GardenerConfig,\n} from './config.js';\nimport type { ProviderName, Tier } from '../providers/types.js';\n\ninterface InitOptions {\n  preset?: string;\n  provider?: string;\n  tier?: string;\n  interactive?: boolean;\n}\n\nfunction ask(rl: Interface, question: string): Promise<string> {\n  return new Promise((resolve) => {\n    rl.question(question, (answer) => resolve(answer.trim()));\n  });\n}\n\nasync function choose(rl: Interface, prompt: string, options: string[], defaultIdx = 0): Promise<string> {\n  console.log(chalk.cyan(prompt));\n  for (let i = 0; i < options.length; i++) {\n    const marker = i === defaultIdx ? chalk.green('â†’') : ' ';\n    console.log(`  ${marker} ${i + 1}. ${options[i]}`);\n  }\n  const answer = await ask(rl, `Choice [${defaultIdx + 1}]: `);\n  const idx = answer ? parseInt(answer, 10) - 1 : defaultIdx;\n  if (idx < 0 || idx >= options.length) return options[defaultIdx];\n  return options[idx];\n}\n\nasync function choosePreset(rl: Interface): Promise<string> {\n  const presets = listPresets();\n  const choice = await choose(rl, 'Choose a vault preset:', [\n    'para-plus (PARA+ with 11 folders â€” recommended for Obsidian)',\n    'zettelkasten (Zettelkasten-style with inbox + notes)',\n    'flat (Minimal â€” inbox, notes, archive)',\n  ]);\n  if (choice.startsWith('zettelkasten')) return 'zettelkasten';\n  if (choice.startsWith('flat')) return 'flat';\n  return 'para-plus';\n}\n\nexport async function initCommand(options: InitOptions): Promise<void> {\n  const cwd = process.cwd();\n  const gardenerDir = getGardenerDir(cwd);\n  const interactive = options.interactive !== false;\n\n  const rl = interactive\n    ? createInterface({ input: process.stdin, output: process.stdout })\n    : null;\n\n  try {\n    await runInit(cwd, gardenerDir, interactive, options, rl);\n  } finally {\n    rl?.close();\n  }\n}\n\nasync function runInit(\n  cwd: string,\n  gardenerDir: string,\n  interactive: boolean,\n  options: InitOptions,\n  rl: Interface | null,\n): Promise<void> {\n  console.log(chalk.bold('\\nvault-gardener init\\n'));\n\n  // Check if .gardener already exists\n  try {\n    await access(gardenerDir);\n    if (interactive && rl) {\n      const answer = await ask(\n        rl,\n        chalk.yellow('.gardener/ already exists. Reset? (y/N): ')\n      );\n      if (answer.toLowerCase() !== 'y') {\n        console.log('Aborted.');\n        return;\n      }\n    }\n  } catch {\n    // Doesn't exist, continue\n  }\n\n  // Step 1: Scan vault\n  console.log(chalk.dim('Scanning vault...'));\n  const scan = await scanVault(cwd);\n  console.log(\n    chalk.dim(\n      `Found ${scan.totalNotes} notes` +\n        (scan.tool ? ` (${scan.tool} vault)` : '') +\n        (scan.preset ? ` â€” detected ${chalk.bold(scan.preset)} structure (${Math.round(scan.confidence * 100)}% confidence)` : '')\n    )\n  );\n\n  // Step 2: Determine folder structure\n  let config: GardenerConfig;\n\n  if (options.preset) {\n    // CLI flag preset\n    const preset = getPreset(options.preset);\n    config = buildDefaultConfig({\n      folders: preset.folders as Record<string, string>,\n      topics: preset.topics,\n      frontmatter: preset.frontmatter,\n    });\n    console.log(chalk.green(`Using preset: ${options.preset}`));\n  } else if (scan.preset && scan.confidence > 0.7) {\n    // Auto-detected with high confidence\n    if (interactive && rl) {\n      console.log(chalk.cyan('\\nDetected folder structure:'));\n      for (const [key, value] of Object.entries(scan.detected)) {\n        if (value) console.log(`  ${chalk.dim(key)}: ${value}/`);\n      }\n      const answer = await ask(rl, '\\nUse detected structure? (Y/n): ');\n      if (answer.toLowerCase() === 'n') {\n        const presetName = await choosePreset(rl);\n        const preset = getPreset(presetName);\n        config = buildDefaultConfig({\n          folders: preset.folders as Record<string, string>,\n          topics: preset.topics,\n          frontmatter: preset.frontmatter,\n        });\n      } else {\n        config = buildDefaultConfig({\n          folders: scan.detected as Record<string, string>,\n        });\n      }\n    } else {\n      config = buildDefaultConfig({\n        folders: scan.detected as Record<string, string>,\n      });\n    }\n  } else {\n    // No clear structure detected\n    if (interactive && rl) {\n      const presetName = await choosePreset(rl);\n      const preset = getPreset(presetName);\n      config = buildDefaultConfig({\n        folders: preset.folders as Record<string, string>,\n        topics: preset.topics,\n        frontmatter: preset.frontmatter,\n      });\n\n      const scaffold = await ask(\n        rl,\n        chalk.cyan('Scaffold folders now? (Y/n): ')\n      );\n      if (scaffold.toLowerCase() !== 'n') {\n        for (const folder of Object.values(config.folders)) {\n          await mkdir(join(cwd, folder), { recursive: true });\n        }\n        console.log(chalk.green('Folders created.'));\n      }\n    } else {\n      config = buildDefaultConfig();\n    }\n  }\n\n  // Apply journal structure from scan\n  if (scan.journalStructure.subfolders.daily) {\n    config.journal.journal_subfolders = {\n      ...config.journal.journal_subfolders,\n      ...scan.journalStructure.subfolders,\n    };\n  }\n\n  // Step 3: Detect and choose provider\n  console.log(chalk.dim('\\nDetecting LLM providers...'));\n  const providers = await detectProviders();\n\n  if (providers.available.length === 0) {\n    console.error(\n      chalk.red(\n        '\\nNo LLM CLI tools found. Install one of:\\n' +\n          '  claude  â€” https://docs.anthropic.com/en/docs/claude-code\\n' +\n          '  codex   â€” https://github.com/openai/codex\\n' +\n          '  gemini  â€” https://github.com/google-gemini/gemini-cli\\n'\n      )\n    );\n    process.exit(1);\n  }\n\n  console.log(\n    chalk.dim(`Available: ${providers.available.join(', ')}`)\n  );\n\n  if (options.provider) {\n    config.provider = options.provider as ProviderName;\n  } else if (interactive && rl && providers.available.length > 1) {\n    const providerChoice = await choose(\n      rl,\n      '\\nChoose LLM provider:',\n      providers.available.map(\n        (p) => `${p}${p === providers.recommended ? ' (recommended)' : ''}`\n      )\n    );\n    config.provider = providerChoice.replace(' (recommended)', '') as ProviderName;\n  } else {\n    config.provider = providers.recommended ?? providers.available[0];\n  }\n\n  // Choose tier\n  if (options.tier) {\n    config.tier = options.tier as Tier;\n  } else if (interactive && rl) {\n    const tierChoice = await choose(rl, '\\nChoose model tier:', [\n      'fast (recommended â€” quicker, cheaper)',\n      'power (thorough, slower)',\n    ]);\n    config.tier = tierChoice.startsWith('fast') ? 'fast' : 'power';\n  }\n\n  const model = config.tier === 'power'\n    ? config[config.provider].power_model\n    : config[config.provider].fast_model;\n\n  console.log(\n    chalk.dim(`\\nProvider: ${config.provider}, Tier: ${config.tier}, Model: ${model}`)\n  );\n\n  // Step 4: Write config and render prompts\n  await mkdir(gardenerDir, { recursive: true });\n  await mkdir(join(gardenerDir, 'prompts'), { recursive: true });\n  await mkdir(join(gardenerDir, 'metrics'), { recursive: true });\n  await mkdir(join(gardenerDir, 'logs'), { recursive: true });\n\n  await saveConfig(config, cwd);\n  console.log(chalk.dim('Wrote .gardener/config.yaml'));\n\n  await renderAll(gardenerDir, config);\n  console.log(chalk.dim('Generated .gardener/context.md and .gardener/prompts/'));\n\n  // Step 5: Suggest .gitignore additions\n  if (interactive) {\n    console.log(\n      chalk.dim(\n        '\\nConsider adding to .gitignore:\\n' +\n          '  .gardener/logs/\\n' +\n          '  .gardener/.lock\\n' +\n          '  .gardener/metrics/\\n'\n      )\n    );\n  }\n\n  console.log(\n    chalk.green.bold(\n      `\\nReady! Run ${chalk.cyan('vault-gardener run')} to start your first garden cycle.\\n`\n    )\n  );\n}\n","import { readdir, access } from 'node:fs/promises';\nimport { join, extname } from 'node:path';\n\nexport interface FolderMap {\n  inbox?: string;\n  journal?: string;\n  projects?: string;\n  roles?: string;\n  resources?: string;\n  people?: string;\n  orgs?: string;\n  playbooks?: string;\n  sources?: string;\n  mocs?: string;\n  archive?: string;\n  templates?: string;\n}\n\nexport interface JournalStructure {\n  hasYearFolders: boolean;\n  subfolders: {\n    yearly?: string;\n    quarterly?: string;\n    monthly?: string;\n    weekly?: string;\n    daily?: string;\n  };\n  namingPattern: 'iso-date' | 'custom' | 'unknown';\n}\n\nexport interface VaultScanResult {\n  preset: string | null;\n  confidence: number;\n  detected: FolderMap;\n  journalStructure: JournalStructure;\n  totalNotes: number;\n  tool: string | null;\n}\n\nconst PARA_PLUS_PATTERNS: Record<string, keyof FolderMap> = {\n  '00-inbox': 'inbox',\n  '01-journal': 'journal',\n  '02-projects': 'projects',\n  '03-roles': 'roles',\n  '04-resources': 'resources',\n  '05-people': 'people',\n  '06-orgs': 'orgs',\n  '07-playbooks': 'playbooks',\n  '08-sources': 'sources',\n  '09-mocs': 'mocs',\n  '99-archive': 'archive',\n};\n\nconst ZETTELKASTEN_FOLDERS = ['inbox', 'zettelkasten', 'references', 'templates'];\nconst FLAT_FOLDERS = ['inbox', 'notes', 'archive'];\n\nconst ISO_DATE_RE = /^\\d{4}-\\d{2}-\\d{2}\\.md$/;\nconst YEAR_RE = /^(20\\d{2})$/;\n\nconst SKIP_DIRS = new Set([\n  'node_modules',\n  '.git',\n  '.obsidian',\n  '.logseq',\n  '.foam',\n  '.trash',\n  '.gardener',\n]);\n\nasync function exists(path: string): Promise<boolean> {\n  try {\n    await access(path);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nconst COUNT_MAX_FILES = 50_000;\n\nasync function countMarkdownFiles(dir: string, state = { count: 0 }): Promise<number> {\n  if (state.count >= COUNT_MAX_FILES) return state.count;\n\n  let entries;\n  try {\n    entries = await readdir(dir, { withFileTypes: true });\n  } catch {\n    return state.count;\n  }\n\n  for (const entry of entries) {\n    if (state.count >= COUNT_MAX_FILES) break;\n    if (entry.name.startsWith('.') || SKIP_DIRS.has(entry.name)) continue;\n\n    const fullPath = join(dir, entry.name);\n    if (entry.isDirectory()) {\n      await countMarkdownFiles(fullPath, state);\n    } else if (entry.isFile() && extname(entry.name) === '.md') {\n      state.count++;\n    }\n  }\n\n  return state.count;\n}\n\nasync function detectTool(vaultPath: string): Promise<string | null> {\n  if (await exists(join(vaultPath, '.obsidian'))) return 'obsidian';\n  if (await exists(join(vaultPath, '.logseq'))) return 'logseq';\n  if (await exists(join(vaultPath, '.foam'))) return 'foam';\n  if (await exists(join(vaultPath, '.dendron.yml'))) return 'dendron';\n  return null;\n}\n\nfunction detectFolders(topLevelDirs: string[]): FolderMap {\n  const detected: FolderMap = {};\n  const lowerDirs = new Map(topLevelDirs.map((d) => [d.toLowerCase(), d]));\n\n  // Check PARA+ numbered prefixes first\n  for (const [pattern, key] of Object.entries(PARA_PLUS_PATTERNS)) {\n    const match = lowerDirs.get(pattern);\n    if (match) {\n      detected[key] = match;\n    }\n  }\n\n  // Check plain names as fallback\n  const plainMappings: Record<string, keyof FolderMap> = {\n    inbox: 'inbox',\n    journal: 'journal',\n    journals: 'journal',\n    projects: 'projects',\n    roles: 'roles',\n    resources: 'resources',\n    people: 'people',\n    orgs: 'orgs',\n    organizations: 'orgs',\n    playbooks: 'playbooks',\n    sources: 'sources',\n    references: 'sources',\n    mocs: 'mocs',\n    archive: 'archive',\n    archives: 'archive',\n    templates: 'templates',\n    notes: 'resources',\n    zettelkasten: 'resources',\n  };\n\n  for (const [name, key] of Object.entries(plainMappings)) {\n    if (!detected[key]) {\n      const match = lowerDirs.get(name);\n      if (match) {\n        detected[key] = match;\n      }\n    }\n  }\n\n  return detected;\n}\n\nfunction scorePreset(\n  detected: FolderMap,\n  topLevelDirs: string[],\n): { preset: string | null; confidence: number } {\n  const lowerDirs = new Set(topLevelDirs.map((d) => d.toLowerCase()));\n\n  // PARA+ score: count numbered prefix matches\n  const paraKeys = Object.keys(PARA_PLUS_PATTERNS);\n  const paraMatches = paraKeys.filter((p) => lowerDirs.has(p)).length;\n  const paraConfidence = paraMatches / paraKeys.length;\n\n  // Zettelkasten score\n  const zetMatches = ZETTELKASTEN_FOLDERS.filter((f) => lowerDirs.has(f)).length;\n  const zetConfidence = zetMatches / ZETTELKASTEN_FOLDERS.length;\n\n  // Flat score\n  const flatMatches = FLAT_FOLDERS.filter((f) => lowerDirs.has(f)).length;\n  const flatConfidence = flatMatches / FLAT_FOLDERS.length;\n\n  const scores = [\n    { preset: 'para-plus', confidence: paraConfidence },\n    { preset: 'zettelkasten', confidence: zetConfidence },\n    { preset: 'flat', confidence: flatConfidence },\n  ];\n\n  scores.sort((a, b) => b.confidence - a.confidence);\n  const best = scores[0];\n\n  if (best.confidence < 0.2) {\n    return { preset: null, confidence: 0 };\n  }\n\n  return { preset: best.preset, confidence: Math.round(best.confidence * 100) / 100 };\n}\n\nasync function detectJournalStructure(\n  vaultPath: string,\n  detected: FolderMap,\n): Promise<JournalStructure> {\n  const result: JournalStructure = {\n    hasYearFolders: false,\n    subfolders: {},\n    namingPattern: 'unknown',\n  };\n\n  const journalDir = detected.journal\n    ? join(vaultPath, detected.journal)\n    : null;\n\n  if (!journalDir || !(await exists(journalDir))) {\n    return result;\n  }\n\n  let entries;\n  try {\n    entries = await readdir(journalDir, { withFileTypes: true });\n  } catch {\n    return result;\n  }\n\n  // Check for year folders (2024/, 2025/, 2026/)\n  const yearFolders = entries.filter(\n    (e) => e.isDirectory() && YEAR_RE.test(e.name),\n  );\n  result.hasYearFolders = yearFolders.length > 0;\n\n  // Scan for subfolders: daily, weekly, monthly, quarterly, yearly\n  const subfoldersToCheck = ['yearly', 'quarterly', 'monthly', 'weekly', 'daily'] as const;\n  const searchDirs = result.hasYearFolders\n    ? yearFolders.map((yf) => join(journalDir, yf.name))\n    : [journalDir];\n\n  for (const searchDir of searchDirs) {\n    let subEntries;\n    try {\n      subEntries = await readdir(searchDir, { withFileTypes: true });\n    } catch {\n      continue;\n    }\n\n    for (const sub of subfoldersToCheck) {\n      if (!result.subfolders[sub]) {\n        const match = subEntries.find(\n          (e) => e.isDirectory() && e.name.toLowerCase() === sub,\n        );\n        if (match) {\n          result.subfolders[sub] = match.name;\n        }\n      }\n    }\n  }\n\n  // Detect naming pattern by scanning for .md files\n  const mdFiles = await collectJournalFiles(journalDir, 3);\n  if (mdFiles.length > 0) {\n    const isoCount = mdFiles.filter((f) => ISO_DATE_RE.test(f)).length;\n    if (isoCount / mdFiles.length > 0.5) {\n      result.namingPattern = 'iso-date';\n    } else if (mdFiles.length > 0) {\n      result.namingPattern = 'custom';\n    }\n  }\n\n  return result;\n}\n\nasync function collectJournalFiles(\n  dir: string,\n  maxDepth: number,\n  depth = 0,\n): Promise<string[]> {\n  if (depth > maxDepth) return [];\n\n  let entries;\n  try {\n    entries = await readdir(dir, { withFileTypes: true });\n  } catch {\n    return [];\n  }\n\n  const files: string[] = [];\n  for (const entry of entries) {\n    if (entry.name.startsWith('.')) continue;\n\n    if (entry.isDirectory()) {\n      const sub = await collectJournalFiles(\n        join(dir, entry.name),\n        maxDepth,\n        depth + 1,\n      );\n      files.push(...sub);\n    } else if (entry.isFile() && extname(entry.name) === '.md') {\n      files.push(entry.name);\n    }\n  }\n\n  return files;\n}\n\nexport async function scanVault(vaultPath: string): Promise<VaultScanResult> {\n  const entries = await readdir(vaultPath, { withFileTypes: true });\n  const topLevelDirs = entries\n    .filter((e) => e.isDirectory() && !e.name.startsWith('.'))\n    .map((e) => e.name);\n\n  const detected = detectFolders(topLevelDirs);\n  const { preset, confidence } = scorePreset(detected, topLevelDirs);\n  const tool = await detectTool(vaultPath);\n  const totalNotes = await countMarkdownFiles(vaultPath);\n  const journalStructure = await detectJournalStructure(vaultPath, detected);\n\n  return {\n    preset,\n    confidence,\n    detected,\n    journalStructure,\n    totalNotes,\n    tool,\n  };\n}\n","import type { FolderMap } from './detect.js';\n\nexport interface PresetConfig {\n  name: string;\n  folders: FolderMap;\n  topics: Record<string, string[]>;\n  frontmatter: {\n    required: string[];\n    statuses: string[];\n    types: string[];\n  };\n}\n\nconst PRESETS: Record<string, PresetConfig> = {\n  'para-plus': {\n    name: 'para-plus',\n    folders: {\n      inbox: '00-inbox',\n      journal: '01-journal',\n      projects: '02-projects',\n      roles: '03-roles',\n      resources: '04-resources',\n      people: '05-people',\n      orgs: '06-orgs',\n      playbooks: '07-playbooks',\n      sources: '08-sources',\n      mocs: '09-mocs',\n      archive: '99-archive',\n      templates: 'templates',\n    },\n    topics: {\n      'ai-tech': ['ai', 'machine-learning', 'llm', 'deep-learning', 'nlp', 'robotics'],\n      neuroscience: ['brain', 'cognition', 'consciousness', 'neuroplasticity'],\n      complexity: ['complex-systems', 'emergence', 'networks', 'chaos-theory'],\n      space: ['astronomy', 'astrophysics', 'space-exploration', 'cosmology'],\n      energy: ['renewable', 'nuclear', 'fusion', 'battery', 'grid'],\n      quantum: ['quantum-computing', 'quantum-mechanics', 'quantum-information'],\n      longevity: ['aging', 'lifespan', 'senescence', 'longevity-research'],\n      health: ['nutrition', 'exercise', 'sleep', 'mental-health', 'biohacking'],\n      psychology: ['behavior', 'motivation', 'decision-making', 'habits'],\n      philosophy: ['epistemology', 'ethics', 'metaphysics', 'stoicism'],\n      finance: ['investing', 'markets', 'economics', 'crypto', 'venture-capital'],\n      learning: ['pedagogy', 'spaced-repetition', 'meta-learning', 'memory'],\n      parenting: ['child-development', 'education', 'family'],\n      strategy: ['business-strategy', 'leadership', 'management', 'operations'],\n      music: ['piano', 'composition', 'music-theory', 'practice'],\n    },\n    frontmatter: {\n      required: ['created', 'updated', 'tags', 'status', 'type'],\n      statuses: ['seed', 'growing', 'evergreen', 'archived', 'consolidated'],\n      types: [\n        'journal',\n        'project',\n        'role',\n        'resource',\n        'person',\n        'org',\n        'meeting',\n        'idea',\n        'playbook',\n        'moc',\n        'source',\n      ],\n    },\n  },\n\n  zettelkasten: {\n    name: 'zettelkasten',\n    folders: {\n      inbox: 'inbox',\n      resources: 'zettelkasten',\n      sources: 'references',\n      projects: 'projects',\n      templates: 'templates',\n    },\n    topics: {\n      ideas: ['concept', 'hypothesis', 'insight'],\n      literature: ['book', 'paper', 'article'],\n      permanent: ['synthesis', 'principle', 'framework'],\n      projects: ['deliverable', 'output', 'milestone'],\n    },\n    frontmatter: {\n      required: ['created', 'updated', 'tags', 'status', 'type'],\n      statuses: ['fleeting', 'literature', 'permanent', 'archived'],\n      types: ['fleeting', 'literature', 'permanent', 'project', 'index'],\n    },\n  },\n\n  flat: {\n    name: 'flat',\n    folders: {\n      inbox: 'inbox',\n      archive: 'archive',\n    },\n    topics: {\n      ideas: ['idea', 'thought', 'brainstorm'],\n      reference: ['note', 'snippet', 'bookmark'],\n    },\n    frontmatter: {\n      required: ['created', 'tags'],\n      statuses: ['draft', 'done', 'archived'],\n      types: ['note', 'idea', 'reference'],\n    },\n  },\n};\n\nexport function getPreset(name: string): PresetConfig {\n  const preset = PRESETS[name];\n  if (!preset) {\n    const available = Object.keys(PRESETS).join(', ');\n    throw new Error(`Unknown preset \"${name}\". Available: ${available}`);\n  }\n  return preset;\n}\n\nexport function listPresets(): string[] {\n  return Object.keys(PRESETS);\n}\n","import type { ProviderName } from './types.js';\nimport { createClaudeProvider } from './claude.js';\nimport { createCodexProvider } from './codex.js';\nimport { createGeminiProvider } from './gemini.js';\n\nexport interface DetectResult {\n  available: ProviderName[];\n  recommended: ProviderName | null;\n}\n\nconst PRIORITY: ProviderName[] = ['claude', 'codex', 'gemini'];\n\nexport async function detectProviders(): Promise<DetectResult> {\n  const providers = [\n    createClaudeProvider(),\n    createCodexProvider(),\n    createGeminiProvider(),\n  ];\n\n  const checks = await Promise.all(\n    providers.map(async (p) => ({\n      name: p.name,\n      ok: await p.isAvailable(),\n    })),\n  );\n\n  const available = checks\n    .filter((c) => c.ok)\n    .map((c) => c.name);\n\n  const recommended = PRIORITY.find((name) => available.includes(name)) ?? null;\n\n  return { available, recommended };\n}\n","import { join } from 'node:path';\nimport { writeFile } from 'node:fs/promises';\nimport chalk from 'chalk';\nimport ora from 'ora';\nimport {\n  loadConfig,\n  getGardenerDir,\n  resolveModel,\n  resolveTimeout,\n} from './config.js';\nimport { renderAll } from '../prompts/render.js';\nimport { acquireLock, acquireOrQueue, forceRelease } from '../lock/index.js';\nimport type { LockHandle } from '../lock/index.js';\nimport type { QueueEntry } from '../queue/index.js';\nimport { createLogger } from '../logging/index.js';\nimport { runPreflight } from '../preflight/index.js';\nimport { notifyFailure } from '../notify/index.js';\nimport { collectPreMetrics, collectPostMetrics, writeMetrics } from '../metrics/collector.js';\nimport { formatSummary } from '../metrics/format.js';\nimport { parseRunReport, archiveReport, writeGardeningLog } from '../reports/index.js';\nimport type { ParsedReport } from '../reports/index.js';\nimport type { ProviderName, Tier, RunOptions } from '../providers/types.js';\nimport type { GardenerConfig } from '../config/index.js';\nimport type { RunMetrics } from '../metrics/collector.js';\n\ntype Phase = 'seed' | 'nurture' | 'tend' | 'all';\n\ninterface RunCommandOptions {\n  provider?: string;\n  tier?: string;\n  dryRun?: boolean;\n  verbose?: boolean;\n  forceUnlock?: boolean;\n  noQueue?: boolean;\n  force?: boolean;\n  validate?: boolean;\n}\n\nconst PHASE_PROMPTS: Record<string, string> = {\n  seed: 'seed.md',\n  nurture: 'nurture.md',\n  tend: 'tend.md',\n  all: 'garden.md',\n};\n\nexport async function runCommand(\n  phase: string | undefined,\n  options: RunCommandOptions\n): Promise<void> {\n  const cwd = process.cwd();\n  const gardenerDir = getGardenerDir(cwd);\n  const resolvedPhase: Phase = (phase as Phase) ?? 'all';\n\n  if (!['seed', 'nurture', 'tend', 'all'].includes(resolvedPhase)) {\n    console.error(\n      chalk.red(`Invalid phase \"${resolvedPhase}\". Use: seed, nurture, tend, or all`)\n    );\n    process.exit(1);\n  }\n\n  // Load config\n  let config;\n  try {\n    config = await loadConfig(cwd);\n  } catch {\n    console.error(\n      chalk.red('No .gardener/config.yaml found. Run `vault-gardener init` first.')\n    );\n    process.exit(1);\n  }\n\n  // Apply overrides\n  if (options.provider) config.provider = options.provider as ProviderName;\n  if (options.tier) config.tier = options.tier as Tier;\n\n  const model = resolveModel(config);\n  const timeout = resolveTimeout(config);\n  const promptFile = join(gardenerDir, 'prompts', PHASE_PROMPTS[resolvedPhase]);\n  const contextFile = join(gardenerDir, 'context.md');\n\n  // Create logger\n  const logger = await createLogger(gardenerDir, { verbose: options.verbose });\n  logger.info('run_start', { phase: resolvedPhase, provider: config.provider, model });\n\n  // Preflight checks â€” always run in validate mode, skip only with --force (non-validate)\n  if (options.validate || !options.force) {\n    const preflight = await runPreflight(cwd, gardenerDir, config, logger);\n\n    if (preflight.warnings.length > 0) {\n      for (const w of preflight.warnings) {\n        console.log(chalk.yellow(`  [warn] ${w}`));\n      }\n    }\n\n    if (!preflight.ok) {\n      for (const e of preflight.errors) {\n        console.error(chalk.red(`  [error] ${e}`));\n      }\n      process.exit(1);\n    }\n  }\n\n  // Validate-only mode\n  if (options.validate) {\n    console.log(chalk.green('Preflight checks passed.'));\n    process.exit(0);\n  }\n\n  console.log(\n    chalk.dim(\n      `\\nvault-gardener run ${resolvedPhase} â€” ${config.provider}/${model}\\n`\n    )\n  );\n\n  if (options.dryRun) {\n    console.log(chalk.yellow('Dry run â€” would execute:'));\n    console.log(chalk.dim(`  Provider: ${config.provider}`));\n    console.log(chalk.dim(`  Model: ${model}`));\n    console.log(chalk.dim(`  Prompt: ${promptFile}`));\n    console.log(chalk.dim(`  Context: ${contextFile}`));\n    console.log(chalk.dim(`  Timeout: ${timeout}s`));\n    console.log(chalk.dim(`  CWD: ${cwd}`));\n    return;\n  }\n\n  // Force-unlock if requested\n  if (options.forceUnlock) {\n    await forceRelease(gardenerDir, logger);\n  }\n\n  // Acquire lock (or queue)\n  let lockHandle: LockHandle;\n  try {\n    if (options.noQueue) {\n      lockHandle = await acquireLock(gardenerDir, logger);\n    } else {\n      const queueEntry: QueueEntry = {\n        phase: resolvedPhase,\n        provider: config.provider,\n        tier: config.tier,\n        queuedAt: new Date().toISOString(),\n        reason: 'lock_busy',\n      };\n      const handle = await acquireOrQueue(gardenerDir, queueEntry, logger);\n      if (!handle) {\n        console.log(chalk.yellow('Gardener busy â€” run queued for next invocation.'));\n        process.exit(0);\n      }\n      lockHandle = handle;\n    }\n  } catch (err) {\n    console.error(chalk.red(`${(err as Error).message}`));\n    process.exit(1);\n  }\n\n  lockHandle.startHeartbeat();\n\n  const startTime = Date.now();\n  let exitCode = 0;\n\n  try {\n    // Re-render prompts from config before each run\n    await renderAll(gardenerDir, config);\n\n    // Pre-metrics\n    const pre = await collectPreMetrics(cwd, config);\n\n    // Load provider\n    const provider = await loadProvider(config.provider, config);\n\n    const spinner = options.verbose\n      ? null\n      : ora({\n          text: `Running ${resolvedPhase} phase...`,\n          color: 'green',\n        }).start();\n\n    const runOpts: RunOptions = {\n      prompt: `Read ${contextFile} for vault context, then read ${promptFile} and execute all steps.`,\n      contextFile,\n      promptFile,\n      cwd,\n      timeout,\n      model,\n      verbose: options.verbose,\n      gardenerDir,\n    };\n\n    const result = await provider.run(runOpts);\n    exitCode = result.exitCode;\n\n    if (spinner) spinner.stop();\n\n    if (result.exitCode !== 0) {\n      console.error(chalk.red(`\\nProvider exited with code ${result.exitCode}`));\n      if (result.output) {\n        console.error(chalk.dim(result.output.slice(-500)));\n      }\n    }\n\n    // Post-metrics\n    const post = await collectPostMetrics(cwd, config, pre);\n    const duration = Math.round((Date.now() - startTime) / 1000);\n\n    // Parse LLM feature report + write gardening log\n    let report: ParsedReport | null = null;\n    try {\n      report = await parseRunReport(cwd, config.features);\n      if (report) {\n        for (const w of report._parsed.validationWarnings) {\n          logger.warn('report_validation', { context: { warning: w } });\n        }\n        if (report._parsed.missingFeatures.length > 0) {\n          logger.warn('report_missing_features', { context: { features: report._parsed.missingFeatures } });\n        }\n        await archiveReport(gardenerDir, report);\n      } else {\n        logger.warn('report_not_found');\n      }\n    } catch {\n      logger.warn('report_parse_failed');\n    }\n\n    // Write daily gardening log (works with or without LLM report)\n    try {\n      await writeGardeningLog(gardenerDir, report, {\n        pre,\n        post,\n        duration,\n        phase: resolvedPhase,\n        config,\n      });\n    } catch {\n      // Non-critical â€” don't fail the run\n    }\n\n    const metrics: RunMetrics = {\n      date: new Date().toISOString().split('T')[0],\n      timestamp: new Date().toISOString(),\n      phase: resolvedPhase,\n      provider: config.provider,\n      tier: config.tier,\n      model,\n      duration_seconds: duration,\n      exitCode,\n      metrics: {\n        inbox_before: pre.inboxItems,\n        inbox_after: post.inboxItems,\n        inbox_processed: post.inboxProcessed,\n        links_added: post.linksAdded,\n        notes_moved: post.notesMoved,\n      },\n      vault_health: {\n        total_notes: post.totalNotes,\n        inbox_items: post.inboxItems,\n        seed_notes: post.seedNotes,\n      },\n    };\n\n    await writeMetrics(gardenerDir, metrics);\n    console.log('\\n' + formatSummary(metrics));\n\n    // Post-run digest generation\n    try {\n      const { generateDigest } = await import('./digest.js');\n      await generateDigest(cwd, { weekly: new Date().getDay() === 0 });\n    } catch {\n      // Digest generation is non-critical -- don't fail the run\n    }\n\n    // Write last-run marker\n    const lastRunPath = join(gardenerDir, 'last-run.md');\n    const lastRunContent = `---\\ndate: ${metrics.date}\\ntimestamp: ${metrics.timestamp}\\nphase: ${resolvedPhase}\\nprovider: ${config.provider}\\nmodel: ${model}\\nduration: ${duration}s\\nexitCode: ${exitCode}\\n---\\n`;\n    await writeFile(lastRunPath, lastRunContent, 'utf-8').catch(() => {});\n  } finally {\n    lockHandle.stopHeartbeat();\n    await lockHandle.release();\n  }\n\n  // Notify on failure (exclude vault_path to avoid leaking local paths)\n  if (exitCode !== 0) {\n    const duration = Math.round((Date.now() - startTime) / 1000);\n    await notifyFailure(\n      {\n        phase: resolvedPhase,\n        duration_seconds: duration,\n        exit_code: exitCode,\n        reason: `Provider exited with code ${exitCode}`,\n        timestamp: new Date().toISOString(),\n      },\n      logger,\n    );\n    logger.error('run_failed', { phase: resolvedPhase, exitCode });\n  } else {\n    logger.info('run_complete', { phase: resolvedPhase });\n  }\n\n  // Queue entries are left for the next cron tick or manual run to pick up.\n  // Consuming them here without actually re-executing would silently discard work.\n\n  if (exitCode !== 0) process.exit(1);\n}\n\nasync function loadProvider(name: ProviderName, config: GardenerConfig) {\n  const providerConfig = config[name] as Record<string, unknown>;\n  switch (name) {\n    case 'claude': {\n      const { createClaudeProvider } = await import('../providers/claude.js');\n      return createClaudeProvider(providerConfig);\n    }\n    case 'codex': {\n      const { createCodexProvider } = await import('../providers/codex.js');\n      return createCodexProvider(providerConfig);\n    }\n    case 'gemini': {\n      const { createGeminiProvider } = await import('../providers/gemini.js');\n      return createGeminiProvider(providerConfig);\n    }\n    default:\n      throw new Error(`Unknown provider: ${name}`);\n  }\n}\n","import { readdir, stat, access } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport { execFileSync } from 'node:child_process';\nimport { performance } from 'node:perf_hooks';\nimport type { Logger } from '../logging/index.js';\nimport type { GardenerConfig } from '../config/index.js';\n\nexport interface PreflightResult {\n  ok: boolean;\n  errors: string[];\n  warnings: string[];\n}\n\nconst SYNC_CONFLICT_MAX_FILES = 10_000;\nconst SYNC_CONFLICT_TIMEOUT_MS = 5_000;\nconst SKIP_DIRS = new Set(['.git', '.obsidian', '.gardener', 'node_modules', '.trash']);\n\nfunction result(): PreflightResult {\n  return { ok: true, errors: [], warnings: [] };\n}\n\nasync function checkVaultAccessibility(\n  vaultPath: string,\n  r: PreflightResult,\n  timeout = 5000,\n): Promise<void> {\n  try {\n    await Promise.race([\n      readdir(vaultPath),\n      new Promise<never>((_, reject) =>\n        setTimeout(() => reject(new Error('Vault access timed out')), timeout),\n      ),\n    ]);\n  } catch (err) {\n    r.ok = false;\n    r.errors.push(`Vault inaccessible: ${(err as Error).message}`);\n  }\n}\n\nasync function checkVaultQuiet(\n  vaultPath: string,\n  config: GardenerConfig,\n  r: PreflightResult,\n): Promise<void> {\n  const quietSeconds = config.resilience?.vault_quiet_seconds ?? 30;\n  const inboxDir = join(vaultPath, config.folders?.inbox ?? '00-inbox');\n  const dirsToCheck = [vaultPath, inboxDir];\n\n  try {\n    const now = Date.now();\n    const threshold = quietSeconds * 1000;\n\n    for (const dir of dirsToCheck) {\n      let entries;\n      try {\n        entries = await readdir(dir, { withFileTypes: true });\n      } catch {\n        continue;\n      }\n\n      for (const entry of entries) {\n        if (!entry.isFile() || !entry.name.endsWith('.md')) continue;\n        const info = await stat(join(dir, entry.name));\n        if (now - info.mtimeMs < threshold) {\n          r.warnings.push(`Vault has recent edits (${entry.name} modified <${quietSeconds}s ago)`);\n          return;\n        }\n      }\n    }\n  } catch {\n    // If we can't check, skip this warning\n  }\n}\n\nasync function detectSyncConflicts(vaultPath: string, r: PreflightResult): Promise<void> {\n  const conflictPatterns = ['sync-conflict', '(conflict)', '.icloud'];\n  const startTime = performance.now();\n  let filesChecked = 0;\n\n  async function walk(dir: string): Promise<void> {\n    if (filesChecked >= SYNC_CONFLICT_MAX_FILES) return;\n    if (performance.now() - startTime > SYNC_CONFLICT_TIMEOUT_MS) return;\n\n    let entries;\n    try {\n      entries = await readdir(dir, { withFileTypes: true });\n    } catch {\n      return;\n    }\n\n    for (const entry of entries) {\n      if (filesChecked >= SYNC_CONFLICT_MAX_FILES) return;\n      if (performance.now() - startTime > SYNC_CONFLICT_TIMEOUT_MS) return;\n\n      const name = entry.name;\n      if (name.startsWith('.') && name !== '.icloud') continue;\n      if (SKIP_DIRS.has(name)) continue;\n\n      const full = join(dir, name);\n\n      if (entry.isDirectory()) {\n        await walk(full);\n      } else {\n        filesChecked++;\n        for (const pattern of conflictPatterns) {\n          if (name.includes(pattern)) {\n            r.warnings.push(`Sync conflict detected: ${full}`);\n          }\n        }\n      }\n    }\n  }\n\n  await walk(vaultPath);\n}\n\nfunction validateGitState(vaultPath: string, r: PreflightResult): void {\n  try {\n    // Check for detached HEAD\n    const headRef = execFileSync('git', ['symbolic-ref', '-q', 'HEAD'], {\n      cwd: vaultPath,\n      encoding: 'utf-8',\n      stdio: ['ignore', 'pipe', 'pipe'],\n    });\n    if (!headRef.trim()) {\n      r.warnings.push('Git is in detached HEAD state');\n    }\n  } catch {\n    r.warnings.push('Git is in detached HEAD state or not a git repo');\n  }\n\n  try {\n    // Check for merge conflicts\n    const mergeHead = execFileSync('git', ['rev-parse', '--verify', 'MERGE_HEAD'], {\n      cwd: vaultPath,\n      encoding: 'utf-8',\n      stdio: ['ignore', 'pipe', 'pipe'],\n    });\n    if (mergeHead.trim()) {\n      r.ok = false;\n      r.errors.push('Git has unresolved merge conflicts');\n    }\n  } catch {\n    // No MERGE_HEAD means no merge in progress â€” good\n  }\n\n  try {\n    // Check for staged but uncommitted changes\n    const staged = execFileSync('git', ['diff', '--cached', '--name-only'], {\n      cwd: vaultPath,\n      encoding: 'utf-8',\n      stdio: ['ignore', 'pipe', 'pipe'],\n    });\n    if (staged.trim()) {\n      r.warnings.push('Git has staged but uncommitted changes');\n    }\n  } catch {\n    // Not a git repo or git not available\n  }\n}\n\nfunction checkDiskSpace(vaultPath: string, r: PreflightResult, minMB = 100): void {\n  try {\n    // Use -Pk for POSIX format (prevents line wrapping on long filesystem names)\n    const output = execFileSync('df', ['-Pk', vaultPath], {\n      encoding: 'utf-8',\n      stdio: ['ignore', 'pipe', 'pipe'],\n    });\n\n    const lines = output.trim().split('\\n');\n    if (lines.length < 2) return;\n\n    // df -Pk output: Filesystem 1024-blocks Used Available Capacity Mounted\n    const parts = lines[1].split(/\\s+/);\n    const availableKB = parseInt(parts[3], 10);\n    if (isNaN(availableKB)) return;\n\n    const availableMB = availableKB / 1024;\n    if (availableMB < minMB) {\n      r.ok = false;\n      r.errors.push(`Low disk space: ${Math.round(availableMB)}MB available (minimum: ${minMB}MB)`);\n    }\n  } catch {\n    r.warnings.push('Could not check disk space');\n  }\n}\n\nasync function checkPreviousRunDirty(gardenerDir: string, r: PreflightResult): Promise<void> {\n  try {\n    const entries = await readdir(gardenerDir);\n    for (const name of entries) {\n      if (name === '.lock' || name.endsWith('.gardener.tmp')) {\n        r.warnings.push(`Stale artifact from previous run: ${name}`);\n      }\n    }\n  } catch {\n    // gardener dir may not exist yet\n  }\n}\n\nfunction checkProviderCli(provider: string, r: PreflightResult): void {\n  try {\n    execFileSync('which', [provider], {\n      encoding: 'utf-8',\n      stdio: ['ignore', 'pipe', 'pipe'],\n    });\n  } catch {\n    r.ok = false;\n    r.errors.push(`Provider CLI not found: ${provider}`);\n  }\n}\n\nasync function checkContextFiles(gardenerDir: string, r: PreflightResult): Promise<void> {\n  const promptsDir = join(gardenerDir, 'prompts');\n  try {\n    await access(promptsDir);\n  } catch {\n    r.ok = false;\n    r.errors.push('Missing prompts/ directory in gardener dir. Run `vault-gardener init` first.');\n  }\n}\n\nexport async function runPreflight(\n  vaultPath: string,\n  gardenerDir: string,\n  config: GardenerConfig,\n  logger: Logger,\n): Promise<PreflightResult> {\n  const r = result();\n\n  logger.info('preflight_start', { phase: 'preflight' });\n\n  await checkVaultAccessibility(vaultPath, r);\n  if (!r.ok) {\n    logger.error('preflight_fail', { phase: 'preflight', context: { errors: r.errors } });\n    return r;\n  }\n\n  await checkVaultQuiet(vaultPath, config, r);\n  await detectSyncConflicts(vaultPath, r);\n  validateGitState(vaultPath, r);\n  checkDiskSpace(vaultPath, r);\n  await checkPreviousRunDirty(gardenerDir, r);\n  checkProviderCli(config.provider, r);\n  await checkContextFiles(gardenerDir, r);\n\n  if (r.warnings.length > 0) {\n    logger.warn('preflight_warnings', {\n      phase: 'preflight',\n      context: { warnings: r.warnings },\n    });\n  }\n\n  if (!r.ok) {\n    logger.error('preflight_fail', { phase: 'preflight', context: { errors: r.errors } });\n  } else {\n    logger.info('preflight_pass', { phase: 'preflight' });\n  }\n\n  return r;\n}\n","import type { Logger } from '../logging/index.js';\n\nexport interface FailureMetrics {\n  phase: string;\n  duration_seconds: number;\n  exit_code: number;\n  reason: string;\n  timestamp: string;\n}\n\nexport async function notifyFailure(metrics: FailureMetrics, logger: Logger): Promise<void> {\n  const url = process.env.GARDENER_WEBHOOK_URL;\n\n  if (!url) {\n    logger.info('notify_skip', { context: { reason: 'GARDENER_WEBHOOK_URL not set' } });\n    return;\n  }\n\n  // Validate URL format\n  try {\n    new URL(url);\n  } catch {\n    logger.warn('notify_skip', { context: { reason: 'GARDENER_WEBHOOK_URL is not a valid URL' } });\n    return;\n  }\n\n  const controller = new AbortController();\n  const timer = setTimeout(() => controller.abort(), 5000);\n\n  try {\n    await fetch(url, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(metrics),\n      signal: controller.signal,\n    });\n\n    logger.info('notify_sent', { phase: metrics.phase });\n  } catch (err) {\n    logger.warn('notify_failed', {\n      phase: metrics.phase,\n      error: { message: (err as Error).message },\n    });\n  } finally {\n    clearTimeout(timer);\n  }\n}\n","import chalk from 'chalk';\nimport type { RunMetrics } from './collector.js';\n\nexport function formatSummary(metrics: RunMetrics): string {\n  const phase = chalk.cyan(metrics.phase.charAt(0).toUpperCase() + metrics.phase.slice(1));\n  const inbox = metrics.metrics.inbox_processed;\n  const links = metrics.metrics.links_added;\n  const moved = metrics.metrics.notes_moved;\n  const duration = metrics.duration_seconds;\n  const exit = metrics.exitCode;\n\n  const parts: string[] = [];\n\n  if (exit === 0) {\n    parts.push(`${phase} complete.`);\n  } else {\n    parts.push(`${phase} ${chalk.red('failed')} (exit ${exit}).`);\n  }\n\n  const details: string[] = [];\n  if (inbox > 0) details.push(`${chalk.green(String(inbox))} inbox items processed`);\n  if (links > 0) details.push(`${chalk.green(String(links))} links added`);\n  if (moved > 0) details.push(`${chalk.green(String(moved))} notes moved`);\n\n  if (details.length > 0) {\n    parts.push(details.join(', ') + '.');\n  }\n\n  parts.push(chalk.dim(`(${duration}s)`));\n\n  return parts.join(' ');\n}\n\nexport function formatMarkdownReport(metrics: RunMetrics[]): string {\n  if (metrics.length === 0) return '_No runs recorded._';\n\n  const lines: string[] = [\n    '| Date | Phase | Duration | Inbox Processed | Links Added | Notes |',\n    '|------|-------|----------|-----------------|-------------|-------|',\n  ];\n\n  for (const m of metrics) {\n    const date = m.date;\n    const phase = m.phase;\n    const duration = `${m.duration_seconds}s`;\n    const inbox = String(m.metrics.inbox_processed);\n    const links = String(m.metrics.links_added);\n    const notes = String(m.vault_health.total_notes);\n\n    lines.push(`| ${date} | ${phase} | ${duration} | ${inbox} | ${links} | ${notes} |`);\n  }\n\n  return lines.join('\\n');\n}\n","import type { FeaturesConfig } from '../config/schema.js';\n\nexport const FEATURE_PHASE_MAP: Record<string, string[]> = {\n  memory: ['seed', 'nurture', 'tend'],\n  changelog: ['seed', 'nurture', 'tend'],\n  persona: ['seed', 'nurture', 'tend'],\n  this_time_last_year: ['seed'],\n  meeting_enhancement: ['seed'],\n  question_tracker: ['seed', 'tend'],\n  commitment_tracker: ['seed', 'nurture', 'tend'],\n  tag_normalization: ['nurture'],\n  co_mention_network: ['nurture'],\n  knowledge_gaps: ['nurture'],\n  entity_auto_linking: ['nurture'],\n  backlink_context: ['nurture'],\n  transitive_links: ['nurture'],\n  social_content: ['tend'],\n  belief_trajectory: ['tend'],\n  theme_detection: ['tend'],\n  attention_allocation: ['tend'],\n  goal_tracking: ['tend'],\n  seasonal_patterns: ['tend'],\n  adaptive_batch_sizing: ['tend'],\n  enrichment_priority: ['tend'],\n  context_anchoring: ['tend'],\n  auto_summary: ['tend'],\n};\n\n/** Return feature keys that are enabled and belong to the given phase. */\nexport function featuresForPhase(\n  phase: string,\n  enabledFeatures: FeaturesConfig,\n): string[] {\n  const flags = enabledFeatures as unknown as Record<string, boolean>;\n  return Object.entries(FEATURE_PHASE_MAP)\n    .filter(([key, phases]) => phases.includes(phase) && flags[key])\n    .map(([key]) => key);\n}\n","import { readFile } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport type { RunReport, ParsedReport, PhaseReport, FeatureReport } from './schema.js';\nimport { featuresForPhase } from './features.js';\nimport type { FeaturesConfig } from '../config/schema.js';\n\nconst REPORT_FILENAME = 'run-report.json';\n\n/**\n * Parse and validate the LLM-written run-report.json.\n * Returns null if the file doesn't exist.\n */\nexport async function parseRunReport(\n  cwd: string,\n  enabledFeatures: FeaturesConfig,\n): Promise<ParsedReport | null> {\n  const gardenerDir = join(cwd, '.gardener');\n  const reportPath = join(gardenerDir, REPORT_FILENAME);\n\n  let raw: string;\n  try {\n    raw = await readFile(reportPath, 'utf-8');\n  } catch {\n    return null;\n  }\n\n  const parseErrors: string[] = [];\n  const validationWarnings: string[] = [];\n  const missingFeatures: string[] = [];\n  const unexpectedFeatures: string[] = [];\n\n  let report: RunReport;\n  try {\n    report = JSON.parse(raw) as RunReport;\n  } catch (err) {\n    parseErrors.push(`Invalid JSON: ${(err as Error).message}`);\n    // Return a minimal parsed report with errors\n    return {\n      version: 1,\n      timestamp: new Date().toISOString(),\n      phases: [],\n      _parsed: {\n        reportPath,\n        parseErrors,\n        validationWarnings,\n        missingFeatures,\n        unexpectedFeatures,\n      },\n    };\n  }\n\n  // Validate top-level fields\n  if (report.version !== 1) {\n    validationWarnings.push(`Unexpected version: ${report.version}`);\n  }\n  if (!report.timestamp) {\n    validationWarnings.push('Missing timestamp');\n  }\n  if (!Array.isArray(report.phases)) {\n    parseErrors.push('phases must be an array');\n    report.phases = [];\n  }\n\n  // Validate each phase and cross-reference features\n  for (const phase of report.phases) {\n    validatePhase(phase, enabledFeatures, validationWarnings, missingFeatures, unexpectedFeatures);\n  }\n\n  return {\n    ...report,\n    _parsed: {\n      reportPath,\n      parseErrors,\n      validationWarnings,\n      missingFeatures,\n      unexpectedFeatures,\n    },\n  };\n}\n\nfunction validatePhase(\n  phase: PhaseReport,\n  enabledFeatures: FeaturesConfig,\n  validationWarnings: string[],\n  missingFeatures: string[],\n  unexpectedFeatures: string[],\n): void {\n  if (!['seed', 'nurture', 'tend'].includes(phase.phase)) {\n    validationWarnings.push(`Unknown phase: ${phase.phase}`);\n    return;\n  }\n\n  if (!Array.isArray(phase.features)) {\n    validationWarnings.push(`${phase.phase}: features must be an array`);\n    phase.features = [];\n    return;\n  }\n\n  // Validate individual features\n  for (const f of phase.features) {\n    validateFeatureReport(f, phase.phase, validationWarnings);\n  }\n\n  // Cross-reference with enabled features for this phase\n  const expected = new Set(featuresForPhase(phase.phase, enabledFeatures));\n  const reported = new Set(phase.features.map((f) => f.feature));\n\n  for (const key of expected) {\n    if (!reported.has(key)) {\n      missingFeatures.push(`${phase.phase}/${key}`);\n    }\n  }\n\n  for (const key of reported) {\n    if (!expected.has(key)) {\n      unexpectedFeatures.push(`${phase.phase}/${key}`);\n    }\n  }\n}\n\nfunction validateFeatureReport(\n  f: FeatureReport,\n  phase: string,\n  warnings: string[],\n): void {\n  if (!f.feature) {\n    warnings.push(`${phase}: feature report missing 'feature' key`);\n  }\n  if (!['executed', 'skipped', 'error'].includes(f.status)) {\n    warnings.push(`${phase}/${f.feature}: invalid status \"${f.status}\"`);\n  }\n  if (f.status === 'error') {\n    warnings.push(`${phase}/${f.feature}: reported error â€” ${f.reason ?? 'no reason given'}`);\n  }\n  if (f.counts == null || typeof f.counts !== 'object') {\n    warnings.push(`${phase}/${f.feature}: missing or invalid counts`);\n  }\n}\n\n/**\n * Detect features that have been skipped in N+ consecutive reports.\n */\nexport function detectStaleFeatures(\n  reports: ParsedReport[],\n  threshold = 3,\n): string[] {\n  if (reports.length < threshold) return [];\n\n  // Collect all reported features and their recent statuses\n  const featureHistory = new Map<string, string[]>();\n\n  // Reports should be sorted newest-first; take the last `threshold`\n  const recent = reports.slice(0, threshold);\n\n  for (const report of recent) {\n    for (const phase of report.phases) {\n      for (const f of phase.features) {\n        const key = `${phase.phase}/${f.feature}`;\n        const history = featureHistory.get(key) ?? [];\n        history.push(f.status);\n        featureHistory.set(key, history);\n      }\n    }\n  }\n\n  const stale: string[] = [];\n  for (const [key, statuses] of featureHistory) {\n    if (statuses.length >= threshold && statuses.every((s) => s === 'skipped')) {\n      stale.push(key);\n    }\n  }\n\n  return stale;\n}\n","import { readFile, writeFile, readdir, mkdir, rename } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport type { ParsedReport, FeatureReport } from './schema.js';\nimport type { RunMetrics } from '../metrics/collector.js';\nimport type { GardenerConfig } from '../config/schema.js';\n\n// ---------------------------------------------------------------------------\n// JSON archive\n// ---------------------------------------------------------------------------\n\n/** Archive a parsed report to .gardener/reports/YYYY-MM-DD.json (append). */\nexport async function archiveReport(\n  gardenerDir: string,\n  report: ParsedReport,\n): Promise<void> {\n  const date = report.timestamp.slice(0, 10);\n  const reportsDir = join(gardenerDir, 'reports');\n  await mkdir(reportsDir, { recursive: true });\n\n  const filePath = join(reportsDir, `${date}.json`);\n  let existing: ParsedReport[] = [];\n\n  try {\n    const raw = await readFile(filePath, 'utf-8');\n    const parsed = JSON.parse(raw);\n    if (Array.isArray(parsed)) existing = parsed;\n  } catch {\n    // file doesn't exist or corrupt â€” start fresh\n  }\n\n  existing.push(report);\n\n  const tmpFile = filePath + '.tmp';\n  await writeFile(tmpFile, JSON.stringify(existing, null, 2), 'utf-8');\n  await rename(tmpFile, filePath);\n}\n\n/** Read archived reports from the last N days. */\nexport async function readReports(\n  gardenerDir: string,\n  days = 30,\n): Promise<ParsedReport[]> {\n  const reportsDir = join(gardenerDir, 'reports');\n  let files: string[];\n\n  try {\n    const entries = await readdir(reportsDir);\n    files = entries.filter((f) => f.endsWith('.json')).sort();\n  } catch {\n    return [];\n  }\n\n  if (days > 0) {\n    const cutoff = new Date();\n    cutoff.setDate(cutoff.getDate() - days);\n    const cutoffStr = cutoff.toISOString().slice(0, 10);\n    files = files.filter((f) => f.replace('.json', '') >= cutoffStr);\n  }\n\n  const all: ParsedReport[] = [];\n  for (const file of files) {\n    try {\n      const raw = await readFile(join(reportsDir, file), 'utf-8');\n      const reports = JSON.parse(raw) as ParsedReport[];\n      all.push(...reports);\n    } catch {\n      // skip corrupted files\n    }\n  }\n\n  return all.sort((a, b) => b.timestamp.localeCompare(a.timestamp));\n}\n\n/** Read the latest report (newest first). */\nexport async function readLatestReport(\n  gardenerDir: string,\n): Promise<ParsedReport | null> {\n  const reports = await readReports(gardenerDir, 7);\n  return reports[0] ?? null;\n}\n\n// ---------------------------------------------------------------------------\n// Markdown daily log\n// ---------------------------------------------------------------------------\n\nexport interface LogContext {\n  pre: { inboxItems: number; totalNotes: number; seedNotes: number };\n  post: { inboxItems: number; totalNotes: number; seedNotes: number };\n  duration: number;\n  phase: string;\n  config: GardenerConfig;\n}\n\n/**\n * Write/append a gardening log entry to .gardener/logs/YYYY/YYYY-MM-DD.md\n * Works with or without an LLM report.\n */\nexport async function writeGardeningLog(\n  gardenerDir: string,\n  report: ParsedReport | null,\n  ctx: LogContext,\n): Promise<void> {\n  const now = new Date();\n  const date = localDate(now);\n  const year = date.slice(0, 4);\n  const time = localTime(now);\n\n  const logsDir = join(gardenerDir, 'logs', year);\n  await mkdir(logsDir, { recursive: true });\n\n  const logPath = join(logsDir, `${date}.md`);\n\n  let existing = '';\n  try {\n    existing = await readFile(logPath, 'utf-8');\n  } catch {\n    // First run of the day â€” create header\n  }\n\n  const entry = renderLogEntry(report, ctx, time);\n\n  const content = existing\n    ? `${existing}\\n${entry}`\n    : `# Gardening Log â€” ${date}\\n\\n${entry}`;\n\n  await writeFile(logPath, content, 'utf-8');\n}\n\nfunction renderLogEntry(\n  report: ParsedReport | null,\n  ctx: LogContext,\n  time: string,\n): string {\n  const { phase, duration, config, pre, post } = ctx;\n  const model = resolveModelName(config);\n  const lines: string[] = [];\n\n  if (!report) {\n    // Minimal entry when no LLM report exists\n    lines.push(`## ${time} â€” ${capitalize(phase)} (${config.provider}/${model}, ${duration}s)`);\n    lines.push('');\n    lines.push('> No feature report â€” LLM did not write run-report.json');\n    lines.push('');\n    lines.push('### Vault Health');\n    lines.push(renderVaultHealth(pre, post));\n    lines.push('');\n    lines.push('---');\n    return lines.join('\\n');\n  }\n\n  // Full entry with report data\n  const hasErrors = report._parsed.parseErrors.length > 0;\n  const marker = hasErrors ? 'âš ' : 'âœ“';\n\n  lines.push(`## ${time} â€” ${capitalize(phase)} (${config.provider}/${model}, ${duration}s) ${marker}`);\n  lines.push('');\n\n  // Features table per phase\n  for (const phaseReport of report.phases) {\n    if (report.phases.length > 1) {\n      lines.push(`### ${capitalize(phaseReport.phase)} Phase`);\n      lines.push('');\n    }\n\n    if (phaseReport.features.length > 0) {\n      lines.push('### Features');\n      lines.push('| Feature | Status | Details |');\n      lines.push('|---------|--------|---------|');\n\n      for (const f of phaseReport.features) {\n        const statusIcon = featureStatusIcon(f.status);\n        const details = formatFeatureDetails(f);\n        lines.push(`| ${f.feature} | ${statusIcon} | ${details} |`);\n      }\n      lines.push('');\n    }\n  }\n\n  // Vault Health\n  lines.push('### Vault Health');\n  lines.push(renderVaultHealth(pre, post));\n  lines.push('');\n\n  // Warnings\n  const allWarnings = [\n    ...report._parsed.validationWarnings,\n    ...report._parsed.missingFeatures.map((f) => `${f} enabled but not reported`),\n  ];\n  if (allWarnings.length > 0) {\n    lines.push('### Warnings');\n    for (const w of allWarnings) {\n      lines.push(`- âš  ${w}`);\n    }\n    lines.push('');\n  }\n\n  // Summary\n  if (report.summary) {\n    lines.push(`> ${report.summary}`);\n    lines.push('');\n  }\n\n  lines.push('---');\n  return lines.join('\\n');\n}\n\nfunction renderVaultHealth(\n  pre: { inboxItems: number; totalNotes: number; seedNotes: number },\n  post: { inboxItems: number; totalNotes: number; seedNotes: number },\n): string {\n  const lines: string[] = [];\n  lines.push(formatDelta('Notes', pre.totalNotes, post.totalNotes));\n  lines.push(formatDelta('Inbox', pre.inboxItems, post.inboxItems));\n  lines.push(formatDelta('Seed', pre.seedNotes, post.seedNotes));\n  return lines.join('\\n');\n}\n\nfunction formatDelta(label: string, before: number, after: number): string {\n  const diff = after - before;\n  const sign = diff >= 0 ? '+' : '';\n  return `- ${label}: ${before.toLocaleString()} â†’ ${after.toLocaleString()} (${sign}${diff})`;\n}\n\nfunction featureStatusIcon(status: string): string {\n  switch (status) {\n    case 'executed': return 'âœ“';\n    case 'skipped': return 'â€“';\n    case 'error': return 'âœ—';\n    default: return '?';\n  }\n}\n\nfunction formatFeatureDetails(f: FeatureReport): string {\n  if (f.status === 'skipped' && f.reason) return `skipped: ${f.reason}`;\n  if (f.status === 'error' && f.reason) return `error: ${f.reason}`;\n  if (f.notes) return f.notes;\n\n  // Format counts\n  const entries = Object.entries(f.counts ?? {});\n  if (entries.length === 0) return f.status;\n  return entries.map(([k, v]) => `${v} ${k.replace(/_/g, ' ')}`).join(', ');\n}\n\nfunction capitalize(s: string): string {\n  return s.charAt(0).toUpperCase() + s.slice(1);\n}\n\nfunction resolveModelName(config: GardenerConfig): string {\n  const providerConfig = config[config.provider] as Record<string, unknown>;\n  const key = config.tier === 'power' ? 'power_model' : 'fast_model';\n  return (providerConfig?.[key] as string) ?? config.tier;\n}\n\n/** Format date as YYYY-MM-DD in local timezone. */\nfunction localDate(d: Date): string {\n  const y = d.getFullYear();\n  const m = String(d.getMonth() + 1).padStart(2, '0');\n  const day = String(d.getDate()).padStart(2, '0');\n  return `${y}-${m}-${day}`;\n}\n\n/** Format time as HH:MM in local timezone. */\nfunction localTime(d: Date): string {\n  const h = String(d.getHours()).padStart(2, '0');\n  const min = String(d.getMinutes()).padStart(2, '0');\n  return `${h}:${min}`;\n}\n","import { readFile } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport chalk from 'chalk';\nimport { getGardenerDir, loadConfig } from './config.js';\nimport { startDaemon } from '../scheduler/daemon.js';\nimport { generateLaunchdPlist } from '../scheduler/launchd.js';\nimport { generateSystemdUnit } from '../scheduler/systemd.js';\n\ninterface StartOptions {\n  install?: boolean;\n}\n\nexport async function startCommand(options: StartOptions): Promise<void> {\n  const cwd = process.cwd();\n  const gardenerDir = getGardenerDir(cwd);\n\n  let config;\n  try {\n    config = await loadConfig(cwd);\n  } catch {\n    console.error(chalk.red('No .gardener/config.yaml found. Run `vault-gardener init` first.'));\n    process.exit(1);\n  }\n\n  if (!config.schedule.enabled) {\n    console.log(chalk.yellow('Schedule is disabled in config. Enabling...'));\n    config.schedule.enabled = true;\n  }\n\n  if (options.install) {\n    const platform = process.platform;\n    if (platform === 'darwin') {\n      const plistPath = await generateLaunchdPlist(cwd, config.schedule.cron);\n      console.log(chalk.green(`Installed launchd plist: ${plistPath}`));\n      console.log(chalk.dim('Run: launchctl load ' + plistPath));\n    } else if (platform === 'linux') {\n      const unitPath = await generateSystemdUnit(cwd, config.schedule.cron);\n      console.log(chalk.green(`Generated systemd unit: ${unitPath}`));\n      const unitName = unitPath.split('/').pop()!.replace('.service', '');\n      console.log(chalk.dim(`Run: systemctl --user enable ${unitName} && systemctl --user start ${unitName}`));\n    } else {\n      console.error(chalk.red(`Platform ${platform} not supported for --install. Use the daemon instead.`));\n      process.exit(1);\n    }\n    return;\n  }\n\n  // Check if daemon is already running\n  const pidFile = join(gardenerDir, '.daemon-pid');\n  try {\n    const pid = parseInt(await readFile(pidFile, 'utf-8'), 10);\n    process.kill(pid, 0); // Check if alive\n    console.log(chalk.yellow(`Daemon already running (PID: ${pid})`));\n    return;\n  } catch {\n    // Not running, start it\n  }\n\n  const pid = await startDaemon(cwd, config.schedule.cron);\n  console.log(\n    chalk.green(`Gardener started. Cron: ${config.schedule.cron}. PID: ${pid}`)\n  );\n}\n","import { writeFile, readFile, unlink, rename } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport { fork } from 'node:child_process';\nimport { fileURLToPath } from 'node:url';\n\nexport interface DaemonHealth {\n  pid: number;\n  lastCheck: string;\n  lastRun: string | null;\n  status: 'running' | 'idle' | 'errored' | 'shutdown';\n  consecutiveFailures: number;\n}\n\nconst HEALTH_FILE = '.daemon-health';\nconst HEALTH_STALE_MS = 5 * 60 * 1000; // 5 minutes\n\nfunction healthPath(gardenerDir: string): string {\n  return join(gardenerDir, HEALTH_FILE);\n}\n\nexport async function writeDaemonHealth(\n  gardenerDir: string,\n  health: DaemonHealth,\n): Promise<void> {\n  const tmpFile = healthPath(gardenerDir) + '.tmp';\n  await writeFile(tmpFile, JSON.stringify(health, null, 2), 'utf-8');\n  await rename(tmpFile, healthPath(gardenerDir));\n}\n\nexport async function readDaemonHealth(\n  gardenerDir: string,\n): Promise<DaemonHealth | null> {\n  try {\n    const raw = await readFile(healthPath(gardenerDir), 'utf-8');\n    return JSON.parse(raw) as DaemonHealth;\n  } catch {\n    return null;\n  }\n}\n\nexport async function isDaemonHealthy(gardenerDir: string): Promise<boolean> {\n  const health = await readDaemonHealth(gardenerDir);\n  if (!health) return false;\n\n  const age = Date.now() - new Date(health.lastCheck).getTime();\n  return age < HEALTH_STALE_MS;\n}\n\n/**\n * Start a detached daemon that runs vault-gardener on a cron schedule.\n * Returns the PID of the daemon process.\n */\nexport async function startDaemon(\n  vaultPath: string,\n  cronExpression: string\n): Promise<number> {\n  const daemonScript = join(\n    fileURLToPath(import.meta.url),\n    '..',\n    '..',\n    '..',\n    'dist',\n    'src',\n    'scheduler',\n    'daemon-worker.js'\n  );\n\n  // Fork a detached worker process\n  const child = fork(daemonScript, [vaultPath, cronExpression], {\n    detached: true,\n    stdio: 'ignore',\n    cwd: vaultPath,\n  });\n\n  child.unref();\n\n  const pid = child.pid!;\n  const gardenerDir = join(vaultPath, '.gardener');\n  const pidFile = join(gardenerDir, '.daemon-pid');\n  await writeFile(pidFile, String(pid), 'utf-8');\n\n  // Write initial health\n  await writeDaemonHealth(gardenerDir, {\n    pid,\n    lastCheck: new Date().toISOString(),\n    lastRun: null,\n    status: 'idle',\n    consecutiveFailures: 0,\n  });\n\n  return pid;\n}\n\n/**\n * Check if the daemon is running.\n */\nexport async function isDaemonRunning(vaultPath: string): Promise<boolean> {\n  const pidFile = join(vaultPath, '.gardener', '.daemon-pid');\n  try {\n    const pid = parseInt(await readFile(pidFile, 'utf-8'), 10);\n    process.kill(pid, 0);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Stop the daemon. Validates health file matches PID to avoid killing unrelated processes.\n */\nexport async function stopDaemon(vaultPath: string): Promise<void> {\n  const gardenerDir = join(vaultPath, '.gardener');\n  const pidFile = join(gardenerDir, '.daemon-pid');\n  try {\n    const pid = parseInt(await readFile(pidFile, 'utf-8'), 10);\n    // Verify this PID is actually our daemon by checking health file\n    const health = await readDaemonHealth(gardenerDir);\n    if (health && health.pid === pid && health.status !== 'shutdown') {\n      process.kill(pid, 'SIGTERM');\n    }\n  } catch {\n    // Already dead or PID mismatch\n  }\n  await unlink(pidFile).catch(() => {});\n}\n","import { writeFile } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport { homedir } from 'node:os';\nimport { createHash } from 'node:crypto';\n\n/**\n * Generate a macOS launchd plist for vault-gardener.\n * Returns the path to the generated plist file.\n */\nexport async function generateLaunchdPlist(\n  vaultPath: string,\n  cronExpression: string\n): Promise<string> {\n  // Parse cron to launchd interval (simplified: extract hour interval)\n  const interval = parseCronToSeconds(cronExpression);\n\n  const plist = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n<dict>\n  <key>Label</key>\n  <string>com.vault-gardener.${vaultHash(vaultPath)}</string>\n  <key>ProgramArguments</key>\n  <array>\n    <string>npx</string>\n    <string>vault-gardener</string>\n    <string>run</string>\n    <string>all</string>\n  </array>\n  <key>WorkingDirectory</key>\n  <string>${vaultPath}</string>\n  <key>StartInterval</key>\n  <integer>${interval}</integer>\n  <key>StandardOutPath</key>\n  <string>${join(vaultPath, '.gardener', 'logs', 'launchd-stdout.log')}</string>\n  <key>StandardErrorPath</key>\n  <string>${join(vaultPath, '.gardener', 'logs', 'launchd-stderr.log')}</string>\n  <key>RunAtLoad</key>\n  <true/>\n</dict>\n</plist>`;\n\n  const plistPath = join(\n    homedir(),\n    'Library',\n    'LaunchAgents',\n    `com.vault-gardener.${vaultHash(vaultPath)}.plist`\n  );\n\n  await writeFile(plistPath, plist, 'utf-8');\n  return plistPath;\n}\n\n/** Short hash of vault path to make service names unique per vault. */\nfunction vaultHash(vaultPath: string): string {\n  return createHash('sha256').update(vaultPath).digest('hex').slice(0, 8);\n}\n\nfunction parseCronToSeconds(cron: string): number {\n  // Simple parser: \"0 */4 * * *\" â†’ 4 hours = 14400s\n  const parts = cron.split(' ');\n  if (parts.length >= 2) {\n    const hourPart = parts[1];\n    const match = hourPart.match(/\\*\\/(\\d+)/);\n    if (match) return parseInt(match[1], 10) * 3600;\n  }\n  // Default: 4 hours\n  return 14400;\n}\n","import { writeFile, mkdir } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport { homedir } from 'node:os';\nimport { createHash } from 'node:crypto';\n\n/**\n * Generate a Linux systemd unit + timer for vault-gardener.\n * Returns the path to the generated service file.\n */\nexport async function generateSystemdUnit(\n  vaultPath: string,\n  cronExpression: string\n): Promise<string> {\n  const interval = parseCronToOnCalendar(cronExpression);\n  const unitDir = join(homedir(), '.config', 'systemd', 'user');\n  await mkdir(unitDir, { recursive: true });\n\n  const service = `[Unit]\nDescription=Vault Gardener â€” AI-powered vault maintenance\nAfter=network.target\n\n[Service]\nType=oneshot\nWorkingDirectory=${vaultPath}\nExecStart=npx vault-gardener run all\nStandardOutput=append:${join(vaultPath, '.gardener', 'logs', 'systemd.log')}\nStandardError=append:${join(vaultPath, '.gardener', 'logs', 'systemd-error.log')}\n\n[Install]\nWantedBy=default.target\n`;\n\n  const timer = `[Unit]\nDescription=Vault Gardener Timer\n\n[Timer]\nOnCalendar=${interval}\nPersistent=true\n\n[Install]\nWantedBy=timers.target\n`;\n\n  const suffix = vaultHash(vaultPath);\n  const servicePath = join(unitDir, `vault-gardener-${suffix}.service`);\n  const timerPath = join(unitDir, `vault-gardener-${suffix}.timer`);\n\n  await writeFile(servicePath, service, 'utf-8');\n  await writeFile(timerPath, timer, 'utf-8');\n\n  return servicePath;\n}\n\n/** Short hash of vault path to make service names unique per vault. */\nfunction vaultHash(vaultPath: string): string {\n  return createHash('sha256').update(vaultPath).digest('hex').slice(0, 8);\n}\n\nfunction parseCronToOnCalendar(cron: string): string {\n  // Simple parser: \"0 */4 * * *\" â†’ \"*-*-* 0/4:00:00\"\n  const parts = cron.split(' ');\n  if (parts.length >= 2) {\n    const minutePart = parts[0];\n    const hourPart = parts[1];\n    const match = hourPart.match(/\\*\\/(\\d+)/);\n    if (match) {\n      return `*-*-* 0/${match[1]}:${minutePart.padStart(2, '0')}:00`;\n    }\n  }\n  // Default: every 4 hours\n  return '*-*-* 0/4:00:00';\n}\n","import { readFile, unlink } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport chalk from 'chalk';\nimport { getGardenerDir } from './config.js';\n\nexport async function stopCommand(): Promise<void> {\n  const gardenerDir = getGardenerDir(process.cwd());\n  const pidFile = join(gardenerDir, '.daemon-pid');\n\n  try {\n    const pid = parseInt(await readFile(pidFile, 'utf-8'), 10);\n\n    try {\n      process.kill(pid, 'SIGTERM');\n      console.log(chalk.green(`Gardener stopped (PID: ${pid})`));\n    } catch {\n      console.log(chalk.yellow(`Process ${pid} not found. Cleaning up stale PID file.`));\n    }\n\n    await unlink(pidFile).catch(() => {});\n  } catch {\n    console.log(chalk.yellow('No daemon running.'));\n  }\n}\n","import { readFile } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport type { VaultDigest } from './digest.js';\nimport chalk from 'chalk';\nimport { getGardenerDir, loadConfig } from './config.js';\nimport { readMetrics } from '../metrics/collector.js';\nimport { isLocked } from '../lock/index.js';\nimport { readLatestReport } from '../reports/index.js';\nimport type { ParsedReport } from '../reports/index.js';\n\ninterface StatusOptions {\n  json?: boolean;\n}\n\nexport async function statusCommand(options: StatusOptions): Promise<void> {\n  const cwd = process.cwd();\n  const gardenerDir = getGardenerDir(cwd);\n\n  let config;\n  try {\n    config = await loadConfig(cwd);\n  } catch {\n    console.error(chalk.red('No .gardener/config.yaml found. Run `vault-gardener init` first.'));\n    process.exit(1);\n  }\n\n  const metrics = await readMetrics(gardenerDir, 30);\n  const locked = await isLocked(gardenerDir);\n  const latestReport = await readLatestReport(gardenerDir);\n\n  // Check daemon\n  let daemonPid: number | null = null;\n  try {\n    const pidFile = join(gardenerDir, '.daemon-pid');\n    const pid = parseInt(await readFile(pidFile, 'utf-8'), 10);\n    process.kill(pid, 0);\n    daemonPid = pid;\n  } catch {\n    // Not running\n  }\n\n  if (options.json) {\n    // Compute vault health for JSON output\n    let vaultHealth = null;\n    if (metrics.length > 0) {\n      const latest = metrics[0];\n      // Try to read suggestions from digest.json\n      let suggestions: string[] = [];\n      let lastDigest: string | null = null;\n      try {\n        const digestPath = join(gardenerDir, 'digest.json');\n        const digestRaw = await readFile(digestPath, 'utf-8');\n        const digest = JSON.parse(digestRaw) as VaultDigest;\n        suggestions = digest.suggestions ?? [];\n        lastDigest = digest.generated ?? null;\n      } catch { /* no digest yet */ }\n\n      vaultHealth = {\n        totalNotes: latest.vault_health.total_notes,\n        inboxItems: latest.vault_health.inbox_items,\n        seedNotes: latest.vault_health.seed_notes,\n        suggestions,\n        lastDigest,\n      };\n    }\n\n    console.log(\n      JSON.stringify(\n        {\n          config: {\n            provider: config.provider,\n            tier: config.tier,\n            schedule: config.schedule,\n          },\n          daemon: daemonPid ? { pid: daemonPid, running: true } : { running: false },\n          locked,\n          recentRuns: metrics.slice(0, 10),\n          vaultHealth,\n          featureActivity: latestReport ? formatReportJson(latestReport) : null,\n        },\n        null,\n        2\n      )\n    );\n    return;\n  }\n\n  // TUI-lite output (non-interactive for now)\n  console.log(chalk.bold('\\nvault-gardener status\\n'));\n\n  // Config\n  console.log(chalk.cyan('Configuration'));\n  console.log(`  Provider: ${config.provider} / ${config.tier}`);\n  console.log(`  Schedule: ${config.schedule.enabled ? config.schedule.cron : 'disabled'}`);\n  console.log(`  Daemon: ${daemonPid ? chalk.green(`running (PID: ${daemonPid})`) : chalk.dim('stopped')}`);\n  console.log(`  Lock: ${locked ? chalk.yellow('active') : chalk.dim('free')}`);\n\n  // Recent runs\n  if (metrics.length === 0) {\n    console.log(chalk.dim('\\nNo runs yet. Run `vault-gardener run` to start.\\n'));\n    return;\n  }\n\n  console.log(chalk.cyan('\\nRecent Runs'));\n  console.log(\n    chalk.dim(\n      '  Date                Phase     Duration  Inbox  Links  Status'\n    )\n  );\n\n  for (const m of metrics.slice(0, 10)) {\n    const date = m.timestamp.slice(0, 16).replace('T', ' ');\n    const phase = m.phase.padEnd(9);\n    const duration = `${m.duration_seconds}s`.padStart(8);\n    const inbox = `${m.metrics.inbox_processed}`.padStart(5);\n    const links = `${m.metrics.links_added}`.padStart(5);\n    const status = m.exitCode === 0 ? chalk.green('ok') : chalk.red('fail');\n\n    console.log(`  ${date}  ${phase}  ${duration}  ${inbox}  ${links}  ${status}`);\n  }\n\n  // Vault health from most recent run\n  const latest = metrics[0];\n  if (latest) {\n    console.log(chalk.cyan('\\nVault Health'));\n    console.log(`  Total notes: ${latest.vault_health.total_notes}`);\n    console.log(`  Inbox items: ${latest.vault_health.inbox_items}`);\n    console.log(`  Seed notes: ${latest.vault_health.seed_notes}`);\n\n    // Sparkline of inbox over last 7 runs\n    const inboxHistory = metrics\n      .slice(0, 7)\n      .reverse()\n      .map((m) => m.vault_health.inbox_items);\n\n    if (inboxHistory.length > 1) {\n      const sparkChars = 'â–â–‚â–ƒâ–„â–…â–†â–‡â–ˆ';\n      const max = Math.max(...inboxHistory, 1);\n      const spark = inboxHistory\n        .map((v) => sparkChars[Math.min(Math.floor((v / max) * 8), 7)])\n        .join('');\n      console.log(`  Inbox trend: ${spark} (last ${inboxHistory.length} runs)`);\n    }\n  }\n\n  // Feature Activity from latest report\n  if (latestReport) {\n    printFeatureActivity(latestReport);\n  }\n\n  console.log('');\n}\n\nfunction printFeatureActivity(report: ParsedReport): void {\n  const phases = report.phases;\n  if (phases.length === 0) return;\n\n  const phaseNames = phases.map((p) => p.phase).join(', ');\n  const time = new Date(report.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });\n\n  console.log(chalk.cyan(`\\nFeature Activity (last run â€” ${phaseNames}, ${time})`));\n\n  for (const phase of phases) {\n    for (const f of phase.features) {\n      const icon = f.status === 'executed' ? chalk.green('âœ“')\n        : f.status === 'error' ? chalk.red('âœ—')\n        : chalk.dim('â€“');\n      const detail = formatFeatureDetail(f);\n      console.log(`  ${icon} ${f.feature}${detail ? ` (${detail})` : ''}`);\n    }\n  }\n\n  // Warnings\n  const warnings = [\n    ...report._parsed.validationWarnings,\n    ...report._parsed.missingFeatures.map((f) => `${f} enabled but not reported`),\n  ];\n  if (warnings.length > 0) {\n    console.log('');\n    console.log(chalk.cyan('  Warnings:'));\n    for (const w of warnings) {\n      console.log(chalk.yellow(`  âš  ${w}`));\n    }\n  }\n}\n\nfunction formatFeatureDetail(f: { status: string; reason?: string; notes?: string; counts: Record<string, number> }): string {\n  if (f.status === 'skipped' && f.reason) return `skipped: ${f.reason}`;\n  if (f.status === 'error' && f.reason) return `error: ${f.reason}`;\n  if (f.notes) return f.notes;\n\n  const entries = Object.entries(f.counts ?? {});\n  if (entries.length === 0) return '';\n  return entries.map(([k, v]) => `${v} ${k.replace(/_/g, ' ')}`).join(', ');\n}\n\nfunction formatReportJson(report: ParsedReport) {\n  return {\n    timestamp: report.timestamp,\n    phases: report.phases.map((p) => ({\n      phase: p.phase,\n      started: p.started,\n      features: p.features.map((f) => ({\n        feature: f.feature,\n        status: f.status,\n        reason: f.reason,\n        counts: f.counts,\n        notes: f.notes,\n      })),\n    })),\n    summary: report.summary,\n    warnings: [\n      ...(report.warnings ?? []),\n      ...report._parsed.validationWarnings,\n      ...report._parsed.missingFeatures.map((f) => `${f} enabled but not reported`),\n    ],\n  };\n}\n","import { run } from '../src/cli/index.js';\n\nrun(process.argv);\n"],"mappings":"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A;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAgJT,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAoER,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA0VN,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA8WT,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA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","names":["join","result","DEFAULT_CONFIG","DEFAULT_CONFIG","writeFile","mkdir","join","readFile","writeFile","mkdir","join","result","tmpPath","stringify","chalk","renderAll","init_config","readFile","writeFile","rename","join","readFile","writeFile","unlink","rename","join","rename","mkdir","join","readFile","writeFile","readdir","mkdir","stat","rename","join","extname","performance","SKIP_DIRS","execFile","promisify","result","execFileAsync","readdir","readFile","stat","join","extname","readdir","readFile","join","basename","writeFile","mkdir","join","chalk","init_config","readFile","readdir","rename","stat","unlink","access","join","execFileSync","chalk","init_config","mkdir","access","join","chalk","result","init_config","chalk","access","mkdir","join","init_config","join","writeFile","chalk","readdir","stat","access","join","SKIP_DIRS","chalk","readFile","join","join","readFile","readFile","writeFile","readdir","mkdir","rename","join","chalk","join","result","generateDigest","writeFile","createClaudeProvider","createCodexProvider","createGeminiProvider","init_config","readFile","join","chalk","writeFile","readFile","unlink","rename","join","join","writeFile","writeFile","join","writeFile","mkdir","join","homedir","createHash","vaultHash","chalk","join","pid","readFile","init_config","readFile","unlink","join","chalk","init_config","readFile","join","chalk","chalk","join","readFile","latest","require","configGet","configSet","configRegen","digestCommand","recoverCommand"]}